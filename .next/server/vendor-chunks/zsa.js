"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/zsa";
exports.ids = ["vendor-chunks/zsa"];
exports.modules = {

/***/ "(action-browser)/./node_modules/zsa/dist/index.mjs":
/*!*****************************************!*\
  !*** ./node_modules/zsa/dist/index.mjs ***!
  \*****************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CompleteProcedure: () => (/* binding */ CompleteProcedure),\n/* harmony export */   DefaultOmitted: () => (/* binding */ DefaultOmitted),\n/* harmony export */   ShapeErrorNotSet: () => (/* binding */ ShapeErrorNotSet),\n/* harmony export */   TOptsSource: () => (/* binding */ TOptsSource),\n/* harmony export */   ZSAError: () => (/* binding */ ZSAError),\n/* harmony export */   ZSAResponseMeta: () => (/* binding */ ZSAResponseMeta),\n/* harmony export */   ZodSafeFunction: () => (/* binding */ ZodSafeFunction),\n/* harmony export */   addToNullishArray: () => (/* binding */ addToNullishArray),\n/* harmony export */   canDataBeUndefinedForSchema: () => (/* binding */ canDataBeUndefinedForSchema),\n/* harmony export */   chainServerActionProcedures: () => (/* binding */ chainServerActionProcedures),\n/* harmony export */   createServerAction: () => (/* binding */ createServerAction),\n/* harmony export */   createServerActionProcedure: () => (/* binding */ createServerActionProcedure),\n/* harmony export */   createZodSafeFunction: () => (/* binding */ createZodSafeFunction),\n/* harmony export */   formDataToJson: () => (/* binding */ formDataToJson),\n/* harmony export */   instanceofZodTypeArray: () => (/* binding */ instanceofZodTypeArray),\n/* harmony export */   instanceofZodTypeBoolean: () => (/* binding */ instanceofZodTypeBoolean),\n/* harmony export */   instanceofZodTypeKind: () => (/* binding */ instanceofZodTypeKind),\n/* harmony export */   instanceofZodTypeLikeVoid: () => (/* binding */ instanceofZodTypeLikeVoid),\n/* harmony export */   instanceofZodTypeObject: () => (/* binding */ instanceofZodTypeObject),\n/* harmony export */   isKeyABooleanInZodSchema: () => (/* binding */ isKeyABooleanInZodSchema),\n/* harmony export */   isKeyAnArrayInZodSchema: () => (/* binding */ isKeyAnArrayInZodSchema),\n/* harmony export */   mergeArraysAndRemoveDuplicates: () => (/* binding */ mergeArraysAndRemoveDuplicates),\n/* harmony export */   unwrapZodType: () => (/* binding */ unwrapZodType)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(action-browser)/./node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zod */ \"(action-browser)/./node_modules/zod/v3/ZodError.js\");\n// src/errors.ts\nvar ERROR_CODES = {\n  INPUT_PARSE_ERROR: \"INPUT_PARSE_ERROR\",\n  OUTPUT_PARSE_ERROR: \"OUTPUT_PARSE_ERROR\",\n  ERROR: \"ERROR\",\n  NOT_AUTHORIZED: \"NOT_AUTHORIZED\",\n  TIMEOUT: \"TIMEOUT\",\n  INTERNAL_SERVER_ERROR: \"INTERNAL_SERVER_ERROR\",\n  FORBIDDEN: \"FORBIDDEN\",\n  NOT_FOUND: \"NOT_FOUND\",\n  CONFLICT: \"CONFLICT\",\n  PRECONDITION_FAILED: \"PRECONDITION_FAILED\",\n  PAYLOAD_TOO_LARGE: \"PAYLOAD_TOO_LARGE\",\n  METHOD_NOT_SUPPORTED: \"METHOD_NOT_SUPPORTED\",\n  UNPROCESSABLE_CONTENT: \"UNPROCESSABLE_CONTENT\",\n  TOO_MANY_REQUESTS: \"TOO_MANY_REQUESTS\",\n  CLIENT_CLOSED_REQUEST: \"CLIENT_CLOSED_REQUEST\",\n  INSUFFICIENT_CREDITS: \"INSUFFICIENT_CREDITS\",\n  PAYMENT_REQUIRED: \"PAYMENT_REQUIRED\"\n};\nvar ZSAError = class extends Error {\n  /** the Error object thrown */\n  data;\n  /** the error code */\n  code;\n  inputParseErrors;\n  outputParseErrors;\n  constructor(code = ERROR_CODES.ERROR, data, more) {\n    super();\n    this.data = data;\n    this.code = code;\n    if (data instanceof Error) {\n      this.message = data.message;\n      this.stack = data.stack;\n      this.name = data.name;\n      this.cause = data.cause;\n    }\n    if (!this.message && typeof this.data === \"string\") {\n      this.message = this.data;\n    }\n    this.inputParseErrors = more?.inputParseErrors;\n    this.outputParseErrors = more?.outputParseErrors;\n  }\n};\n\n// src/utils.ts\n\nvar instanceofZodTypeKind = (type, zodTypeKind) => {\n  return type?._def?.typeName === zodTypeKind;\n};\nvar unwrapZodType = (type, unwrapPreprocess) => {\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodOptional)) {\n    return unwrapZodType(type.unwrap(), unwrapPreprocess);\n  }\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodDefault)) {\n    return unwrapZodType(type.removeDefault(), unwrapPreprocess);\n  }\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodLazy)) {\n    return unwrapZodType(type._def.getter(), unwrapPreprocess);\n  }\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodEffects)) {\n    if (type._def.effect.type === \"refinement\") {\n      return unwrapZodType(type._def.schema, unwrapPreprocess);\n    }\n    if (type._def.effect.type === \"transform\") {\n      return unwrapZodType(type._def.schema, unwrapPreprocess);\n    }\n    if (unwrapPreprocess && type._def.effect.type === \"preprocess\") {\n      return unwrapZodType(type._def.schema, unwrapPreprocess);\n    }\n  }\n  return type;\n};\nvar instanceofZodTypeObject = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodObject);\n};\nvar instanceofZodTypeArray = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodArray);\n};\nvar instanceofZodTypeBoolean = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodBoolean);\n};\nvar unwrapKeyInZodSchema = (key, schema) => {\n  const unwrapped = unwrapZodType(schema, true);\n  const isObject = instanceofZodTypeObject(unwrapped);\n  if (!isObject)\n    return null;\n  const shape = unwrapped.shape;\n  if (!(key in shape))\n    return null;\n  const value = shape[key];\n  if (!value)\n    return null;\n  return unwrapZodType(value, true);\n};\nvar isKeyAnArrayInZodSchema = (key, schema) => {\n  const unwrappedValue = unwrapKeyInZodSchema(key, schema);\n  if (unwrappedValue === null)\n    return false;\n  const isArray = instanceofZodTypeArray(unwrappedValue);\n  return isArray;\n};\nvar isKeyABooleanInZodSchema = (key, schema) => {\n  const unwrappedValue = unwrapKeyInZodSchema(key, schema);\n  if (unwrappedValue === null)\n    return false;\n  const isArray = instanceofZodTypeBoolean(unwrappedValue);\n  return isArray;\n};\nvar formDataToJson = (formData, inputSchema) => {\n  const json = {};\n  formData.forEach((value, key) => {\n    const isArraySchema = isKeyAnArrayInZodSchema(key, inputSchema);\n    const isBooleanSchema = isKeyABooleanInZodSchema(key, inputSchema);\n    if (!Reflect.has(json, key)) {\n      json[key] = isArraySchema ? [value] : value;\n      if (isBooleanSchema) {\n        if (json[key] === \"true\")\n          json[key] = true;\n        if (json[key] === \"false\")\n          json[key] = false;\n      }\n      return;\n    }\n    if (!Array.isArray(json[key])) {\n      json[key] = [json[key]];\n    }\n    json[key].push(value);\n  });\n  return json;\n};\nvar addToNullishArray = (array, value) => {\n  if (!array && !value)\n    return void 0;\n  if (!value)\n    return array;\n  const temp = [...array || []];\n  temp.push(value);\n  return temp;\n};\nvar mergeArraysAndRemoveDuplicates = (array1, array2) => {\n  if (!array1 && !array2)\n    return void 0;\n  if (!array2)\n    return array1;\n  if (!array1)\n    return array2;\n  const temp = [...array1 || [], ...array2 || []];\n  return [...new Set(temp)];\n};\nvar instanceofZodTypeLikeVoid = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodVoid) || instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodUndefined) || instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodNever);\n};\nvar canDataBeUndefinedForSchema = (schema) => {\n  if (!schema)\n    return true;\n  if (instanceofZodTypeLikeVoid(schema))\n    return true;\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodOptional)) {\n    return true;\n  }\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodDefault)) {\n    return true;\n  }\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodLazy)) {\n    return canDataBeUndefinedForSchema(schema._def.getter());\n  }\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodEffects)) {\n    if (schema._def.effect.type === \"refinement\") {\n      return canDataBeUndefinedForSchema(schema._def.schema);\n    }\n    if (schema._def.effect.type === \"transform\") {\n      return canDataBeUndefinedForSchema(schema._def.schema);\n    }\n    if (schema._def.effect.type === \"preprocess\") {\n      return canDataBeUndefinedForSchema(schema._def.schema);\n    }\n  }\n  return false;\n};\n\n// src/zod-safe-function.ts\n\n\n// src/types.ts\nvar TOptsSource = class {\n  validate;\n  constructor(validate) {\n    this.validate = validate;\n  }\n};\nvar DefaultOmitted = {\n  $internals: 1,\n  handleError: 1,\n  onInputParseError: 1,\n  getTimeoutErrorPromise: 1,\n  getProcedureChainOutput: 1,\n  handleSuccess: 1,\n  handleStart: 1,\n  parseInputData: 1,\n  parseOutputData: 1,\n  onOutputParseError: 1,\n  checkTimeoutStatus: 1,\n  getRetryDelay: 1,\n  evaluateInputSchema: 1,\n  getFinalStaticInputSchema: 1\n};\nvar ZSAResponseMeta = class {\n  /**\n   * the headers of the response\n   */\n  headers;\n  /**\n   * the status code of the response\n   *\n   * @default 200\n   */\n  statusCode;\n  constructor() {\n    this.statusCode = 200;\n    this.headers = new Headers();\n  }\n};\nvar ShapeErrorNotSet = \"ShapeErrorNotSet\";\n\n// src/zod-safe-function.ts\nvar validateOpts = (opts) => {\n  if (opts && (!(opts.source instanceof TOptsSource) || !opts.source.validate())) {\n    throw new Error(\"Invalid opts, must originate from the server\");\n  }\n};\nvar ZodSafeFunction = class _ZodSafeFunction {\n  /** The internals of the Zod Safe Function */\n  $internals;\n  constructor(internals) {\n    this.$internals = internals;\n  }\n  /** Check if the timeout has triggered, if so, throw a ZSAError */\n  checkTimeoutStatus(timeoutStatus) {\n    if (timeoutStatus.isTimeout) {\n      throw new ZSAError(\n        \"TIMEOUT\",\n        `Exceeded timeout of ${this.$internals.timeout} ms`\n      );\n    }\n  }\n  /**\n   *\n   * Get the retry delay for the current retry attempt\n   *\n   * If there should be no retry, returns -1\n   */\n  getRetryDelay($err, currentAttempt) {\n    try {\n      const err = $err instanceof ZSAError ? $err : new ZSAError(\"ERROR\", $err);\n      if (err.code === \"TIMEOUT\") {\n        return -1;\n      }\n      const config = this.$internals.retryConfig;\n      if (!config)\n        return -1;\n      if (this.$internals.isProcedure)\n        return -1;\n      const shouldRetry = currentAttempt < config.maxAttempts;\n      let retryDelay = 0;\n      if (typeof config.delay === \"function\") {\n        retryDelay = config.delay(currentAttempt, err);\n      } else if (typeof config.delay === \"number\") {\n        retryDelay = config.delay;\n      }\n      if (shouldRetry)\n        return retryDelay;\n      return -1;\n    } catch {\n      return -1;\n    }\n  }\n  /**\n   *  Run through the procedure chain and get the final context\n   */\n  async getProcedureChainOutput($args) {\n    const {\n      args,\n      timeoutStatus,\n      request,\n      responseMeta,\n      onInputSchema,\n      previousState\n    } = $args;\n    let accData = void 0;\n    let inputSchema = void 0;\n    for (let i = 0; i < this.$internals.procedureHandlerChain.length; i += 1) {\n      this.checkTimeoutStatus(timeoutStatus);\n      const procedureHandler = this.$internals.procedureHandlerChain[i];\n      const [data, err] = await procedureHandler(args, void 0, {\n        ctx: accData,\n        request,\n        responseMeta,\n        previousState,\n        source: new TOptsSource(() => true),\n        previousInputSchema: inputSchema,\n        onInputSchema: (schema) => {\n          inputSchema = schema;\n        }\n      });\n      if (err) {\n        throw err;\n      }\n      accData = data;\n    }\n    onInputSchema?.(inputSchema);\n    return accData;\n  }\n  /**\n   *  Run through the procedure chain and get the final static input schema\n   */\n  async getFinalStaticInputSchema(args) {\n    let inputSchema = void 0;\n    if (this.$internals.isProcedure && args.opts) {\n      await this.evaluateInputSchema({\n        ctx: void 0,\n        opts: args.opts,\n        noFunctionsAllowed: true\n      });\n      return;\n    }\n    for (const procedureHandler of this.$internals.procedureHandlerChain) {\n      await procedureHandler(void 0, void 0, {\n        source: new TOptsSource(() => true),\n        previousInputSchema: inputSchema,\n        returnInputSchema: true,\n        onInputSchema: (schema) => {\n          inputSchema = schema;\n        }\n      });\n    }\n    if (!args.opts) {\n      args.opts = {\n        source: new TOptsSource(() => true)\n      };\n    }\n    args.opts.previousInputSchema = inputSchema;\n    return await this.evaluateInputSchema({\n      ctx: void 0,\n      opts: args.opts,\n      noFunctionsAllowed: true\n    }) || zod__WEBPACK_IMPORTED_MODULE_0__.undefined();\n  }\n  /** set a timeout on the server action */\n  timeout(milliseconds) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      timeout: milliseconds\n    });\n  }\n  /** set a retry mechanism on the server action */\n  retry(config) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      retryConfig: config\n    });\n  }\n  /**\n   * set the input schema for the server action\n   *\n   * @example\n   * ```ts\n   * .input(z.object({\n   *   message: z.string()\n   * }))\n   * ```\n   */\n  input(schema, opts) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      // @ts-expect-error\n      inputSchema: schema,\n      inputType: opts?.type,\n      skipInputParsing: opts?.skipInputParsing\n    });\n  }\n  /** set the output schema for the server action */\n  output(schema) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      // @ts-expect-error\n      outputSchema: schema\n    });\n  }\n  /** set a handler function for input parse errors */\n  onInputParseError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onInputParseError: fn\n    });\n  }\n  /** set a handler function for output parse errors */\n  onOutputParseError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onOutputParseError: fn\n    });\n  }\n  /** set a handler function for errors */\n  onError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onErrorFns: [...this.$internals.onErrorFns || [], fn]\n    });\n  }\n  /** set a handler function for when the server action starts */\n  onStart(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onStartFns: [...this.$internals.onStartFns || [], fn]\n    });\n  }\n  /** set a handler function for when the server action succeeds */\n  onSuccess(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onSuccessFns: [...this.$internals.onSuccessFns || [], fn]\n    });\n  }\n  /** set a handler function for when the server action completes (success or error) */\n  onComplete(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onCompleteFns: [...this.$internals.onCompleteFns || [], fn]\n    });\n  }\n  /** a helper function to parse output data given the active output schema */\n  async parseOutputData(data, ctx, timeoutStatus, opts) {\n    this.checkTimeoutStatus(timeoutStatus);\n    if (!this.$internals.outputSchema)\n      return data;\n    const schema = typeof this.$internals.outputSchema === \"function\" ? await this.$internals.outputSchema({\n      ctx,\n      unparsedData: data,\n      request: opts?.request,\n      responseMeta: opts?.responseMeta,\n      previousState: opts?.previousState\n    }) : this.$internals.outputSchema;\n    if (!(schema instanceof zod__WEBPACK_IMPORTED_MODULE_0__.ZodType)) {\n      throw new ZSAError(\"ERROR\", \"Output schema must be a ZodType\");\n    }\n    const safe = await schema.safeParseAsync(data);\n    if (!safe.success) {\n      if (this.$internals.onOutputParseError) {\n        await this.$internals.onOutputParseError(safe.error);\n      }\n      const flattenedErrors = safe.error.flatten();\n      const formattedErrors = safe.error.format();\n      throw new ZSAError(\"OUTPUT_PARSE_ERROR\", safe.error, {\n        outputParseErrors: {\n          fieldErrors: flattenedErrors?.fieldErrors,\n          formErrors: flattenedErrors?.formErrors,\n          formattedErrors\n        }\n      });\n    }\n    return safe.data;\n  }\n  /** helper function to handle start with timeout checkpoints */\n  async handleStart(args, timeoutStatus) {\n    this.checkTimeoutStatus(timeoutStatus);\n    if (this.$internals.isProcedure)\n      return;\n    for (const fn of this.$internals.onStartFns || []) {\n      await fn({ args });\n      this.checkTimeoutStatus(timeoutStatus);\n    }\n  }\n  /** helper function to handle success with timeout checkpoints */\n  async handleSuccess(args, data, timeoutStatus) {\n    this.checkTimeoutStatus(timeoutStatus);\n    if (this.$internals.isProcedure)\n      return;\n    for (const fn of this.$internals.onSuccessFns || []) {\n      await fn({ args, data });\n      this.checkTimeoutStatus(timeoutStatus);\n    }\n    this.checkTimeoutStatus(timeoutStatus);\n    for (const fn of this.$internals.onCompleteFns || []) {\n      await fn({\n        isSuccess: true,\n        isError: false,\n        status: \"success\",\n        args,\n        data\n      });\n      this.checkTimeoutStatus(timeoutStatus);\n    }\n  }\n  /** helper function to handle errors with timeout checkpoints */\n  async handleError(err, inputRaw, inputParsed) {\n    if (err.message === \"NEXT_REDIRECT\" || err.message === \"NEXT_NOT_FOUND\") {\n      throw err;\n    }\n    if (this.$internals.isProcedure)\n      return [null, err];\n    let customError;\n    if (this.$internals.shapeErrorFns !== void 0) {\n      let accData = void 0;\n      for (const fn of this.$internals.shapeErrorFns) {\n        accData = await fn({\n          err,\n          typedData: {\n            // @ts-expect-error\n            inputParseErrors: err instanceof ZSAError ? err.inputParseErrors : void 0,\n            // @ts-expect-error\n            outputParseErrors: err instanceof ZSAError ? err.outputParseErrors : void 0,\n            inputParsed,\n            inputRaw\n          },\n          ctx: accData\n        });\n      }\n      customError = accData;\n    } else {\n      customError = err instanceof ZSAError ? err : new ZSAError(\"ERROR\", err);\n    }\n    for (const fn of this.$internals.onErrorFns || []) {\n      await fn(customError);\n    }\n    for (const fn of this.$internals.onCompleteFns || []) {\n      await fn({\n        isSuccess: false,\n        isError: true,\n        status: \"error\",\n        error: customError\n      });\n    }\n    if (this.$internals.shapeErrorFns !== void 0) {\n      return [null, customError];\n    }\n    const stringifyIfNeeded = (data2) => typeof data2 === \"string\" ? data2 : JSON.stringify(data2);\n    let formattedErrors;\n    let flattenedErrors;\n    const data = err.data;\n    if (data instanceof zod__WEBPACK_IMPORTED_MODULE_1__.ZodError && customError.code === \"INPUT_PARSE_ERROR\") {\n      formattedErrors = data.format();\n      flattenedErrors = data.flatten();\n    }\n    return [\n      null,\n      {\n        data: stringifyIfNeeded(customError.data),\n        name: customError.name,\n        message: stringifyIfNeeded(customError.message),\n        code: customError.code,\n        fieldErrors: flattenedErrors?.fieldErrors,\n        formErrors: flattenedErrors?.formErrors,\n        formattedErrors\n      }\n    ];\n  }\n  async evaluateInputSchema(args) {\n    const { ctx, opts, noFunctionsAllowed } = args;\n    let inputSchema = this.$internals.inputSchema;\n    if (noFunctionsAllowed && typeof inputSchema === \"function\") {\n      throw new Error(\"Input functions are not suppported yet\");\n    }\n    if (typeof inputSchema === \"function\") {\n      inputSchema = await inputSchema({\n        ctx,\n        previousSchema: opts?.previousInputSchema || zod__WEBPACK_IMPORTED_MODULE_0__.undefined(),\n        request: opts?.request,\n        responseMeta: opts?.responseMeta,\n        previousState: opts?.previousState\n      });\n    }\n    if (inputSchema && !(inputSchema instanceof zod__WEBPACK_IMPORTED_MODULE_0__.ZodType)) {\n      throw new ZSAError(\"ERROR\", \"Input schema must be a ZodType\");\n    }\n    let final;\n    if (!opts?.previousInputSchema) {\n      final = inputSchema;\n    } else if (!inputSchema) {\n      final = opts.previousInputSchema;\n    } else if (instanceofZodTypeObject(opts.previousInputSchema) && instanceofZodTypeObject(inputSchema)) {\n      final = opts.previousInputSchema.merge(inputSchema);\n    } else {\n      final = inputSchema;\n    }\n    opts?.onInputSchema?.(final);\n    return final || zod__WEBPACK_IMPORTED_MODULE_0__.undefined();\n  }\n  /** helper function to parse input data given the active input schema */\n  async parseInputData($data, overrideData, timeoutStatus, ctx, opts) {\n    this.checkTimeoutStatus(timeoutStatus);\n    const inputSchema = await this.evaluateInputSchema({\n      ctx,\n      opts\n    });\n    if (this.$internals.skipInputParsing) {\n      return $data;\n    }\n    let data = $data;\n    if ($data instanceof FormData && this.$internals.inputType !== \"json\") {\n      data = {\n        ...formDataToJson(data, inputSchema),\n        ...this.$internals.inputType !== \"state\" ? overrideData || {} : {}\n      };\n    }\n    const canChangeToUndefined = ($data instanceof FormData || opts?.isFromOpenApiHandler) && canDataBeUndefinedForSchema(inputSchema);\n    if (canChangeToUndefined && data && typeof data === \"object\" && Object.keys(data).length === 0) {\n      data = void 0;\n    }\n    opts?.onArgs?.(data);\n    await this.handleStart(data, timeoutStatus);\n    if (!this.$internals.inputSchema && data !== void 0 && this.$internals.isProcedure) {\n      return void 0;\n    }\n    const safe = await inputSchema.safeParseAsync(data);\n    if (!safe.success) {\n      if (this.$internals.onInputParseError) {\n        await this.$internals.onInputParseError(safe.error);\n      }\n      const flattenedErrors = safe.error.flatten();\n      const formattedErrors = safe.error.format();\n      throw new ZSAError(\"INPUT_PARSE_ERROR\", safe.error, {\n        inputParseErrors: {\n          fieldErrors: flattenedErrors?.fieldErrors,\n          formErrors: flattenedErrors?.formErrors,\n          formattedErrors\n        }\n      });\n    }\n    return safe.data;\n  }\n  /** set a handler function for when the server action starts */\n  experimental_shapeError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      // @ts-expect-error\n      shapeErrorFns: [...this.$internals.shapeErrorFns || [], fn]\n    });\n  }\n  getTimeoutErrorPromise = (timeoutMs) => new Promise((_, reject) => {\n    setTimeout(() => {\n      reject(new ZSAError(\"TIMEOUT\", `Exceeded timeout of ${timeoutMs} ms`));\n    }, timeoutMs);\n  });\n  /** set the handler function for the server action */\n  handler(fn) {\n    const timeoutStatus = {\n      isTimeout: false\n    };\n    const wrapper = async ($args, overrideArgs, opts) => {\n      validateOpts(opts);\n      if (opts?.returnInputSchema) {\n        return await this.getFinalStaticInputSchema({\n          opts\n        });\n      } else if (opts?.returnOutputSchema) {\n        if (typeof this.$internals.outputSchema === \"function\") {\n          throw new Error(\n            \"Cannot return output schema from a function output schema\"\n          );\n        }\n        return this.$internals.outputSchema;\n      }\n      let args;\n      let parsedArgs;\n      if (this.$internals.inputType === \"state\") {\n        args = overrideArgs;\n      } else {\n        args = $args;\n      }\n      let previousState = opts?.previousState || void 0;\n      if (this.$internals.inputType === \"state\" && !this.$internals.isProcedure) {\n        previousState = $args;\n      }\n      try {\n        let ctx;\n        if (this.$internals.isProcedure && opts) {\n          ctx = opts.ctx;\n        } else {\n          ctx = await this.getProcedureChainOutput({\n            // @ts-expect-error\n            args,\n            timeoutStatus,\n            request: opts?.request,\n            responseMeta: opts?.responseMeta,\n            onInputSchema: (schema) => {\n              if (!opts) {\n                opts = {\n                  source: new TOptsSource(() => true)\n                };\n              }\n              opts.previousInputSchema = schema;\n            },\n            previousState\n          });\n        }\n        const input = await this.parseInputData(\n          args,\n          overrideArgs,\n          timeoutStatus,\n          ctx,\n          opts\n        );\n        opts?.onParsedArgs?.(input);\n        parsedArgs = input;\n        this.checkTimeoutStatus(timeoutStatus);\n        const data = await fn({\n          input,\n          ctx,\n          request: opts?.request,\n          responseMeta: opts?.responseMeta,\n          previousState\n        });\n        const parsed = await this.parseOutputData(\n          data,\n          ctx,\n          timeoutStatus,\n          opts\n        );\n        await this.handleSuccess(input, parsed, timeoutStatus);\n        return [parsed, null];\n      } catch (err) {\n        const retryDelay = this.getRetryDelay(err, opts?.attempts || 1);\n        if (retryDelay >= 0) {\n          await new Promise((r) => setTimeout(r, retryDelay));\n          return await wrapper($args, overrideArgs, {\n            ...opts || {},\n            attempts: (opts?.attempts || 1) + 1,\n            source: new TOptsSource(() => true)\n          });\n        }\n        return await this.handleError(err, args, parsedArgs);\n      }\n    };\n    const withTimeout = async (args, overrideArgs, opts) => {\n      const timeoutMs = this.$internals.timeout;\n      if (!timeoutMs)\n        return await wrapper(args, overrideArgs, opts);\n      validateOpts(opts);\n      let gotArgs = void 0;\n      let gotParsedArgs = void 0;\n      return await Promise.race([\n        wrapper(args, overrideArgs, {\n          ...opts || {},\n          onArgs: (args2) => {\n            gotArgs = args2;\n          },\n          onParsedArgs: (parsedArgs) => {\n            gotParsedArgs = parsedArgs;\n          },\n          source: new TOptsSource(() => true)\n        }),\n        this.getTimeoutErrorPromise(timeoutMs)\n      ]).then((r) => r).catch((err) => {\n        timeoutStatus.isTimeout = true;\n        return this.handleError(err, gotArgs, gotParsedArgs);\n      });\n    };\n    if (this.$internals.isProcedure) {\n      const handler = this.$internals.timeout ? withTimeout : wrapper;\n      return new CompleteProcedure({\n        inputSchema: this.$internals.inputSchema,\n        handlerChain: [...this.$internals.procedureHandlerChain, handler],\n        shapeErrorFns: this.$internals.shapeErrorFns,\n        lastHandler: handler,\n        onCompleteFns: this.$internals.onCompleteFns,\n        onErrorFns: this.$internals.onErrorFns,\n        onStartFns: this.$internals.onStartFns,\n        onSuccessFns: this.$internals.onSuccessFns,\n        timeout: this.$internals.timeout,\n        retryConfig: this.$internals.retryConfig\n      });\n    }\n    if (this.$internals.timeout) {\n      return withTimeout;\n    }\n    return wrapper;\n  }\n};\nfunction createZodSafeFunction(isProcedure, parentProcedure) {\n  return new ZodSafeFunction({\n    inputSchema: parentProcedure?.$internals.inputSchema || void 0,\n    outputSchema: void 0,\n    shapeErrorFns: parentProcedure?.$internals.shapeErrorFns || void 0,\n    isChained: parentProcedure !== void 0,\n    isProcedure: isProcedure === true,\n    procedureHandlerChain: parentProcedure?.$internals.handlerChain || [],\n    onCompleteFns: parentProcedure?.$internals.onCompleteFns,\n    onErrorFns: parentProcedure?.$internals.onErrorFns,\n    onStartFns: parentProcedure?.$internals.onStartFns,\n    onSuccessFns: parentProcedure?.$internals.onSuccessFns\n  });\n}\nfunction createServerAction() {\n  return new ZodSafeFunction({\n    inputSchema: void 0,\n    outputSchema: void 0,\n    shapeErrorFns: void 0,\n    procedureHandlerChain: []\n  });\n}\n\n// src/procedure.ts\nvar CompleteProcedure = class {\n  $internals;\n  constructor(params) {\n    this.$internals = params;\n  }\n  /** make a server action with the current procedure */\n  createServerAction() {\n    return new ZodSafeFunction({\n      inputSchema: this.$internals.inputSchema,\n      outputSchema: void 0,\n      procedureHandlerChain: this.$internals.handlerChain,\n      onErrorFns: this.$internals.onErrorFns,\n      onStartFns: this.$internals.onStartFns,\n      onSuccessFns: this.$internals.onSuccessFns,\n      onCompleteFns: this.$internals.onCompleteFns,\n      timeout: this.$internals.timeout,\n      retryConfig: this.$internals.retryConfig,\n      shapeErrorFns: this.$internals.shapeErrorFns\n    });\n  }\n};\nvar createServerActionProcedure = (parent) => {\n  return createZodSafeFunction(true, parent);\n};\nvar chainServerActionProcedures = (first, second) => {\n  return new CompleteProcedure({\n    inputSchema: second.$internals.inputSchema,\n    handlerChain: [\n      ...first.$internals.handlerChain,\n      second.$internals.lastHandler\n    ],\n    lastHandler: second.$internals.lastHandler,\n    timeout: second.$internals.timeout || first.$internals.timeout,\n    retryConfig: second.$internals.retryConfig || first.$internals.retryConfig,\n    shapeErrorFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.shapeErrorFns,\n      second.$internals.shapeErrorFns\n    ),\n    onErrorFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onErrorFns,\n      second.$internals.onErrorFns\n    ),\n    onStartFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onStartFns,\n      second.$internals.onStartFns\n    ),\n    onSuccessFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onSuccessFns,\n      second.$internals.onSuccessFns\n    ),\n    onCompleteFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onCompleteFns,\n      second.$internals.onCompleteFns\n    )\n  });\n};\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL25vZGVfbW9kdWxlcy96c2EvZGlzdC9pbmRleC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0Msc0RBQXVCO0FBQ3pEO0FBQ0E7QUFDQSxrQ0FBa0Msc0RBQXVCO0FBQ3pEO0FBQ0E7QUFDQSxrQ0FBa0Msc0RBQXVCO0FBQ3pEO0FBQ0E7QUFDQSxrQ0FBa0Msc0RBQXVCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLHNEQUF1QjtBQUM1RDtBQUNBO0FBQ0EscUNBQXFDLHNEQUF1QjtBQUM1RDtBQUNBO0FBQ0EscUNBQXFDLHNEQUF1QjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLHNEQUF1Qix5Q0FBeUMsc0RBQXVCLDhDQUE4QyxzREFBdUI7QUFDak07QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLHNEQUF1QjtBQUMzRDtBQUNBO0FBQ0Esb0NBQW9DLHNEQUF1QjtBQUMzRDtBQUNBO0FBQ0Esb0NBQW9DLHNEQUF1QjtBQUMzRDtBQUNBO0FBQ0Esb0NBQW9DLHNEQUF1QjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDOEI7O0FBRTlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IseUJBQXlCO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLG9CQUFvQixrREFBa0Q7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSyxLQUFLLDBDQUFZO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLDRCQUE0Qix3Q0FBVTtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLE1BQU07QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLFlBQVk7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix5Q0FBVztBQUNuQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxnQ0FBZ0M7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQsMENBQVk7QUFDakU7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0EsZ0RBQWdELHdDQUFVO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDBDQUFZO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0VBQXNFO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsNERBQTRELFdBQVc7QUFDdkUsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBeUJFIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXHphaW51bGFhYmFpZGluXFxEb3dubG9hZHNcXEZpbmFsUHJvamVjdC1tYWluXFxGaW5hbFByb2plY3QtbWFpblxcbm9kZV9tb2R1bGVzXFx6c2FcXGRpc3RcXGluZGV4Lm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvZXJyb3JzLnRzXG52YXIgRVJST1JfQ09ERVMgPSB7XG4gIElOUFVUX1BBUlNFX0VSUk9SOiBcIklOUFVUX1BBUlNFX0VSUk9SXCIsXG4gIE9VVFBVVF9QQVJTRV9FUlJPUjogXCJPVVRQVVRfUEFSU0VfRVJST1JcIixcbiAgRVJST1I6IFwiRVJST1JcIixcbiAgTk9UX0FVVEhPUklaRUQ6IFwiTk9UX0FVVEhPUklaRURcIixcbiAgVElNRU9VVDogXCJUSU1FT1VUXCIsXG4gIElOVEVSTkFMX1NFUlZFUl9FUlJPUjogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgRk9SQklEREVOOiBcIkZPUkJJRERFTlwiLFxuICBOT1RfRk9VTkQ6IFwiTk9UX0ZPVU5EXCIsXG4gIENPTkZMSUNUOiBcIkNPTkZMSUNUXCIsXG4gIFBSRUNPTkRJVElPTl9GQUlMRUQ6IFwiUFJFQ09ORElUSU9OX0ZBSUxFRFwiLFxuICBQQVlMT0FEX1RPT19MQVJHRTogXCJQQVlMT0FEX1RPT19MQVJHRVwiLFxuICBNRVRIT0RfTk9UX1NVUFBPUlRFRDogXCJNRVRIT0RfTk9UX1NVUFBPUlRFRFwiLFxuICBVTlBST0NFU1NBQkxFX0NPTlRFTlQ6IFwiVU5QUk9DRVNTQUJMRV9DT05URU5UXCIsXG4gIFRPT19NQU5ZX1JFUVVFU1RTOiBcIlRPT19NQU5ZX1JFUVVFU1RTXCIsXG4gIENMSUVOVF9DTE9TRURfUkVRVUVTVDogXCJDTElFTlRfQ0xPU0VEX1JFUVVFU1RcIixcbiAgSU5TVUZGSUNJRU5UX0NSRURJVFM6IFwiSU5TVUZGSUNJRU5UX0NSRURJVFNcIixcbiAgUEFZTUVOVF9SRVFVSVJFRDogXCJQQVlNRU5UX1JFUVVJUkVEXCJcbn07XG52YXIgWlNBRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgLyoqIHRoZSBFcnJvciBvYmplY3QgdGhyb3duICovXG4gIGRhdGE7XG4gIC8qKiB0aGUgZXJyb3IgY29kZSAqL1xuICBjb2RlO1xuICBpbnB1dFBhcnNlRXJyb3JzO1xuICBvdXRwdXRQYXJzZUVycm9ycztcbiAgY29uc3RydWN0b3IoY29kZSA9IEVSUk9SX0NPREVTLkVSUk9SLCBkYXRhLCBtb3JlKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgIHRoaXMuY29kZSA9IGNvZGU7XG4gICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgdGhpcy5tZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xuICAgICAgdGhpcy5zdGFjayA9IGRhdGEuc3RhY2s7XG4gICAgICB0aGlzLm5hbWUgPSBkYXRhLm5hbWU7XG4gICAgICB0aGlzLmNhdXNlID0gZGF0YS5jYXVzZTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLm1lc3NhZ2UgJiYgdHlwZW9mIHRoaXMuZGF0YSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgdGhpcy5tZXNzYWdlID0gdGhpcy5kYXRhO1xuICAgIH1cbiAgICB0aGlzLmlucHV0UGFyc2VFcnJvcnMgPSBtb3JlPy5pbnB1dFBhcnNlRXJyb3JzO1xuICAgIHRoaXMub3V0cHV0UGFyc2VFcnJvcnMgPSBtb3JlPy5vdXRwdXRQYXJzZUVycm9ycztcbiAgfVxufTtcblxuLy8gc3JjL3V0aWxzLnRzXG5pbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xudmFyIGluc3RhbmNlb2Zab2RUeXBlS2luZCA9ICh0eXBlLCB6b2RUeXBlS2luZCkgPT4ge1xuICByZXR1cm4gdHlwZT8uX2RlZj8udHlwZU5hbWUgPT09IHpvZFR5cGVLaW5kO1xufTtcbnZhciB1bndyYXBab2RUeXBlID0gKHR5cGUsIHVud3JhcFByZXByb2Nlc3MpID0+IHtcbiAgaWYgKGluc3RhbmNlb2Zab2RUeXBlS2luZCh0eXBlLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RPcHRpb25hbCkpIHtcbiAgICByZXR1cm4gdW53cmFwWm9kVHlwZSh0eXBlLnVud3JhcCgpLCB1bndyYXBQcmVwcm9jZXNzKTtcbiAgfVxuICBpZiAoaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHR5cGUsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZERlZmF1bHQpKSB7XG4gICAgcmV0dXJuIHVud3JhcFpvZFR5cGUodHlwZS5yZW1vdmVEZWZhdWx0KCksIHVud3JhcFByZXByb2Nlc3MpO1xuICB9XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQodHlwZSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kTGF6eSkpIHtcbiAgICByZXR1cm4gdW53cmFwWm9kVHlwZSh0eXBlLl9kZWYuZ2V0dGVyKCksIHVud3JhcFByZXByb2Nlc3MpO1xuICB9XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQodHlwZSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kRWZmZWN0cykpIHtcbiAgICBpZiAodHlwZS5fZGVmLmVmZmVjdC50eXBlID09PSBcInJlZmluZW1lbnRcIikge1xuICAgICAgcmV0dXJuIHVud3JhcFpvZFR5cGUodHlwZS5fZGVmLnNjaGVtYSwgdW53cmFwUHJlcHJvY2Vzcyk7XG4gICAgfVxuICAgIGlmICh0eXBlLl9kZWYuZWZmZWN0LnR5cGUgPT09IFwidHJhbnNmb3JtXCIpIHtcbiAgICAgIHJldHVybiB1bndyYXBab2RUeXBlKHR5cGUuX2RlZi5zY2hlbWEsIHVud3JhcFByZXByb2Nlc3MpO1xuICAgIH1cbiAgICBpZiAodW53cmFwUHJlcHJvY2VzcyAmJiB0eXBlLl9kZWYuZWZmZWN0LnR5cGUgPT09IFwicHJlcHJvY2Vzc1wiKSB7XG4gICAgICByZXR1cm4gdW53cmFwWm9kVHlwZSh0eXBlLl9kZWYuc2NoZW1hLCB1bndyYXBQcmVwcm9jZXNzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHR5cGU7XG59O1xudmFyIGluc3RhbmNlb2Zab2RUeXBlT2JqZWN0ID0gKHR5cGUpID0+IHtcbiAgcmV0dXJuIGluc3RhbmNlb2Zab2RUeXBlS2luZCh0eXBlLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RPYmplY3QpO1xufTtcbnZhciBpbnN0YW5jZW9mWm9kVHlwZUFycmF5ID0gKHR5cGUpID0+IHtcbiAgcmV0dXJuIGluc3RhbmNlb2Zab2RUeXBlS2luZCh0eXBlLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RBcnJheSk7XG59O1xudmFyIGluc3RhbmNlb2Zab2RUeXBlQm9vbGVhbiA9ICh0eXBlKSA9PiB7XG4gIHJldHVybiBpbnN0YW5jZW9mWm9kVHlwZUtpbmQodHlwZSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kQm9vbGVhbik7XG59O1xudmFyIHVud3JhcEtleUluWm9kU2NoZW1hID0gKGtleSwgc2NoZW1hKSA9PiB7XG4gIGNvbnN0IHVud3JhcHBlZCA9IHVud3JhcFpvZFR5cGUoc2NoZW1hLCB0cnVlKTtcbiAgY29uc3QgaXNPYmplY3QgPSBpbnN0YW5jZW9mWm9kVHlwZU9iamVjdCh1bndyYXBwZWQpO1xuICBpZiAoIWlzT2JqZWN0KVxuICAgIHJldHVybiBudWxsO1xuICBjb25zdCBzaGFwZSA9IHVud3JhcHBlZC5zaGFwZTtcbiAgaWYgKCEoa2V5IGluIHNoYXBlKSlcbiAgICByZXR1cm4gbnVsbDtcbiAgY29uc3QgdmFsdWUgPSBzaGFwZVtrZXldO1xuICBpZiAoIXZhbHVlKVxuICAgIHJldHVybiBudWxsO1xuICByZXR1cm4gdW53cmFwWm9kVHlwZSh2YWx1ZSwgdHJ1ZSk7XG59O1xudmFyIGlzS2V5QW5BcnJheUluWm9kU2NoZW1hID0gKGtleSwgc2NoZW1hKSA9PiB7XG4gIGNvbnN0IHVud3JhcHBlZFZhbHVlID0gdW53cmFwS2V5SW5ab2RTY2hlbWEoa2V5LCBzY2hlbWEpO1xuICBpZiAodW53cmFwcGVkVmFsdWUgPT09IG51bGwpXG4gICAgcmV0dXJuIGZhbHNlO1xuICBjb25zdCBpc0FycmF5ID0gaW5zdGFuY2VvZlpvZFR5cGVBcnJheSh1bndyYXBwZWRWYWx1ZSk7XG4gIHJldHVybiBpc0FycmF5O1xufTtcbnZhciBpc0tleUFCb29sZWFuSW5ab2RTY2hlbWEgPSAoa2V5LCBzY2hlbWEpID0+IHtcbiAgY29uc3QgdW53cmFwcGVkVmFsdWUgPSB1bndyYXBLZXlJblpvZFNjaGVtYShrZXksIHNjaGVtYSk7XG4gIGlmICh1bndyYXBwZWRWYWx1ZSA9PT0gbnVsbClcbiAgICByZXR1cm4gZmFsc2U7XG4gIGNvbnN0IGlzQXJyYXkgPSBpbnN0YW5jZW9mWm9kVHlwZUJvb2xlYW4odW53cmFwcGVkVmFsdWUpO1xuICByZXR1cm4gaXNBcnJheTtcbn07XG52YXIgZm9ybURhdGFUb0pzb24gPSAoZm9ybURhdGEsIGlucHV0U2NoZW1hKSA9PiB7XG4gIGNvbnN0IGpzb24gPSB7fTtcbiAgZm9ybURhdGEuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xuICAgIGNvbnN0IGlzQXJyYXlTY2hlbWEgPSBpc0tleUFuQXJyYXlJblpvZFNjaGVtYShrZXksIGlucHV0U2NoZW1hKTtcbiAgICBjb25zdCBpc0Jvb2xlYW5TY2hlbWEgPSBpc0tleUFCb29sZWFuSW5ab2RTY2hlbWEoa2V5LCBpbnB1dFNjaGVtYSk7XG4gICAgaWYgKCFSZWZsZWN0Lmhhcyhqc29uLCBrZXkpKSB7XG4gICAgICBqc29uW2tleV0gPSBpc0FycmF5U2NoZW1hID8gW3ZhbHVlXSA6IHZhbHVlO1xuICAgICAgaWYgKGlzQm9vbGVhblNjaGVtYSkge1xuICAgICAgICBpZiAoanNvbltrZXldID09PSBcInRydWVcIilcbiAgICAgICAgICBqc29uW2tleV0gPSB0cnVlO1xuICAgICAgICBpZiAoanNvbltrZXldID09PSBcImZhbHNlXCIpXG4gICAgICAgICAganNvbltrZXldID0gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghQXJyYXkuaXNBcnJheShqc29uW2tleV0pKSB7XG4gICAgICBqc29uW2tleV0gPSBbanNvbltrZXldXTtcbiAgICB9XG4gICAganNvbltrZXldLnB1c2godmFsdWUpO1xuICB9KTtcbiAgcmV0dXJuIGpzb247XG59O1xudmFyIGFkZFRvTnVsbGlzaEFycmF5ID0gKGFycmF5LCB2YWx1ZSkgPT4ge1xuICBpZiAoIWFycmF5ICYmICF2YWx1ZSlcbiAgICByZXR1cm4gdm9pZCAwO1xuICBpZiAoIXZhbHVlKVxuICAgIHJldHVybiBhcnJheTtcbiAgY29uc3QgdGVtcCA9IFsuLi5hcnJheSB8fCBbXV07XG4gIHRlbXAucHVzaCh2YWx1ZSk7XG4gIHJldHVybiB0ZW1wO1xufTtcbnZhciBtZXJnZUFycmF5c0FuZFJlbW92ZUR1cGxpY2F0ZXMgPSAoYXJyYXkxLCBhcnJheTIpID0+IHtcbiAgaWYgKCFhcnJheTEgJiYgIWFycmF5MilcbiAgICByZXR1cm4gdm9pZCAwO1xuICBpZiAoIWFycmF5MilcbiAgICByZXR1cm4gYXJyYXkxO1xuICBpZiAoIWFycmF5MSlcbiAgICByZXR1cm4gYXJyYXkyO1xuICBjb25zdCB0ZW1wID0gWy4uLmFycmF5MSB8fCBbXSwgLi4uYXJyYXkyIHx8IFtdXTtcbiAgcmV0dXJuIFsuLi5uZXcgU2V0KHRlbXApXTtcbn07XG52YXIgaW5zdGFuY2VvZlpvZFR5cGVMaWtlVm9pZCA9ICh0eXBlKSA9PiB7XG4gIHJldHVybiBpbnN0YW5jZW9mWm9kVHlwZUtpbmQodHlwZSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kVm9pZCkgfHwgaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHR5cGUsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZFVuZGVmaW5lZCkgfHwgaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHR5cGUsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZE5ldmVyKTtcbn07XG52YXIgY2FuRGF0YUJlVW5kZWZpbmVkRm9yU2NoZW1hID0gKHNjaGVtYSkgPT4ge1xuICBpZiAoIXNjaGVtYSlcbiAgICByZXR1cm4gdHJ1ZTtcbiAgaWYgKGluc3RhbmNlb2Zab2RUeXBlTGlrZVZvaWQoc2NoZW1hKSlcbiAgICByZXR1cm4gdHJ1ZTtcbiAgaWYgKGluc3RhbmNlb2Zab2RUeXBlS2luZChzY2hlbWEsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZE9wdGlvbmFsKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQoc2NoZW1hLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2REZWZhdWx0KSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQoc2NoZW1hLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RMYXp5KSkge1xuICAgIHJldHVybiBjYW5EYXRhQmVVbmRlZmluZWRGb3JTY2hlbWEoc2NoZW1hLl9kZWYuZ2V0dGVyKCkpO1xuICB9XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQoc2NoZW1hLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RFZmZlY3RzKSkge1xuICAgIGlmIChzY2hlbWEuX2RlZi5lZmZlY3QudHlwZSA9PT0gXCJyZWZpbmVtZW50XCIpIHtcbiAgICAgIHJldHVybiBjYW5EYXRhQmVVbmRlZmluZWRGb3JTY2hlbWEoc2NoZW1hLl9kZWYuc2NoZW1hKTtcbiAgICB9XG4gICAgaWYgKHNjaGVtYS5fZGVmLmVmZmVjdC50eXBlID09PSBcInRyYW5zZm9ybVwiKSB7XG4gICAgICByZXR1cm4gY2FuRGF0YUJlVW5kZWZpbmVkRm9yU2NoZW1hKHNjaGVtYS5fZGVmLnNjaGVtYSk7XG4gICAgfVxuICAgIGlmIChzY2hlbWEuX2RlZi5lZmZlY3QudHlwZSA9PT0gXCJwcmVwcm9jZXNzXCIpIHtcbiAgICAgIHJldHVybiBjYW5EYXRhQmVVbmRlZmluZWRGb3JTY2hlbWEoc2NoZW1hLl9kZWYuc2NoZW1hKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLy8gc3JjL3pvZC1zYWZlLWZ1bmN0aW9uLnRzXG5pbXBvcnQgeyB6IGFzIHoyIH0gZnJvbSBcInpvZFwiO1xuXG4vLyBzcmMvdHlwZXMudHNcbnZhciBUT3B0c1NvdXJjZSA9IGNsYXNzIHtcbiAgdmFsaWRhdGU7XG4gIGNvbnN0cnVjdG9yKHZhbGlkYXRlKSB7XG4gICAgdGhpcy52YWxpZGF0ZSA9IHZhbGlkYXRlO1xuICB9XG59O1xudmFyIERlZmF1bHRPbWl0dGVkID0ge1xuICAkaW50ZXJuYWxzOiAxLFxuICBoYW5kbGVFcnJvcjogMSxcbiAgb25JbnB1dFBhcnNlRXJyb3I6IDEsXG4gIGdldFRpbWVvdXRFcnJvclByb21pc2U6IDEsXG4gIGdldFByb2NlZHVyZUNoYWluT3V0cHV0OiAxLFxuICBoYW5kbGVTdWNjZXNzOiAxLFxuICBoYW5kbGVTdGFydDogMSxcbiAgcGFyc2VJbnB1dERhdGE6IDEsXG4gIHBhcnNlT3V0cHV0RGF0YTogMSxcbiAgb25PdXRwdXRQYXJzZUVycm9yOiAxLFxuICBjaGVja1RpbWVvdXRTdGF0dXM6IDEsXG4gIGdldFJldHJ5RGVsYXk6IDEsXG4gIGV2YWx1YXRlSW5wdXRTY2hlbWE6IDEsXG4gIGdldEZpbmFsU3RhdGljSW5wdXRTY2hlbWE6IDFcbn07XG52YXIgWlNBUmVzcG9uc2VNZXRhID0gY2xhc3Mge1xuICAvKipcbiAgICogdGhlIGhlYWRlcnMgb2YgdGhlIHJlc3BvbnNlXG4gICAqL1xuICBoZWFkZXJzO1xuICAvKipcbiAgICogdGhlIHN0YXR1cyBjb2RlIG9mIHRoZSByZXNwb25zZVxuICAgKlxuICAgKiBAZGVmYXVsdCAyMDBcbiAgICovXG4gIHN0YXR1c0NvZGU7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuc3RhdHVzQ29kZSA9IDIwMDtcbiAgICB0aGlzLmhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICB9XG59O1xudmFyIFNoYXBlRXJyb3JOb3RTZXQgPSBcIlNoYXBlRXJyb3JOb3RTZXRcIjtcblxuLy8gc3JjL3pvZC1zYWZlLWZ1bmN0aW9uLnRzXG52YXIgdmFsaWRhdGVPcHRzID0gKG9wdHMpID0+IHtcbiAgaWYgKG9wdHMgJiYgKCEob3B0cy5zb3VyY2UgaW5zdGFuY2VvZiBUT3B0c1NvdXJjZSkgfHwgIW9wdHMuc291cmNlLnZhbGlkYXRlKCkpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBvcHRzLCBtdXN0IG9yaWdpbmF0ZSBmcm9tIHRoZSBzZXJ2ZXJcIik7XG4gIH1cbn07XG52YXIgWm9kU2FmZUZ1bmN0aW9uID0gY2xhc3MgX1pvZFNhZmVGdW5jdGlvbiB7XG4gIC8qKiBUaGUgaW50ZXJuYWxzIG9mIHRoZSBab2QgU2FmZSBGdW5jdGlvbiAqL1xuICAkaW50ZXJuYWxzO1xuICBjb25zdHJ1Y3RvcihpbnRlcm5hbHMpIHtcbiAgICB0aGlzLiRpbnRlcm5hbHMgPSBpbnRlcm5hbHM7XG4gIH1cbiAgLyoqIENoZWNrIGlmIHRoZSB0aW1lb3V0IGhhcyB0cmlnZ2VyZWQsIGlmIHNvLCB0aHJvdyBhIFpTQUVycm9yICovXG4gIGNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKSB7XG4gICAgaWYgKHRpbWVvdXRTdGF0dXMuaXNUaW1lb3V0KSB7XG4gICAgICB0aHJvdyBuZXcgWlNBRXJyb3IoXG4gICAgICAgIFwiVElNRU9VVFwiLFxuICAgICAgICBgRXhjZWVkZWQgdGltZW91dCBvZiAke3RoaXMuJGludGVybmFscy50aW1lb3V0fSBtc2BcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKlxuICAgKiBHZXQgdGhlIHJldHJ5IGRlbGF5IGZvciB0aGUgY3VycmVudCByZXRyeSBhdHRlbXB0XG4gICAqXG4gICAqIElmIHRoZXJlIHNob3VsZCBiZSBubyByZXRyeSwgcmV0dXJucyAtMVxuICAgKi9cbiAgZ2V0UmV0cnlEZWxheSgkZXJyLCBjdXJyZW50QXR0ZW1wdCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBlcnIgPSAkZXJyIGluc3RhbmNlb2YgWlNBRXJyb3IgPyAkZXJyIDogbmV3IFpTQUVycm9yKFwiRVJST1JcIiwgJGVycik7XG4gICAgICBpZiAoZXJyLmNvZGUgPT09IFwiVElNRU9VVFwiKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuJGludGVybmFscy5yZXRyeUNvbmZpZztcbiAgICAgIGlmICghY29uZmlnKVxuICAgICAgICByZXR1cm4gLTE7XG4gICAgICBpZiAodGhpcy4kaW50ZXJuYWxzLmlzUHJvY2VkdXJlKVxuICAgICAgICByZXR1cm4gLTE7XG4gICAgICBjb25zdCBzaG91bGRSZXRyeSA9IGN1cnJlbnRBdHRlbXB0IDwgY29uZmlnLm1heEF0dGVtcHRzO1xuICAgICAgbGV0IHJldHJ5RGVsYXkgPSAwO1xuICAgICAgaWYgKHR5cGVvZiBjb25maWcuZGVsYXkgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICByZXRyeURlbGF5ID0gY29uZmlnLmRlbGF5KGN1cnJlbnRBdHRlbXB0LCBlcnIpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnLmRlbGF5ID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIHJldHJ5RGVsYXkgPSBjb25maWcuZGVsYXk7XG4gICAgICB9XG4gICAgICBpZiAoc2hvdWxkUmV0cnkpXG4gICAgICAgIHJldHVybiByZXRyeURlbGF5O1xuICAgICAgcmV0dXJuIC0xO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogIFJ1biB0aHJvdWdoIHRoZSBwcm9jZWR1cmUgY2hhaW4gYW5kIGdldCB0aGUgZmluYWwgY29udGV4dFxuICAgKi9cbiAgYXN5bmMgZ2V0UHJvY2VkdXJlQ2hhaW5PdXRwdXQoJGFyZ3MpIHtcbiAgICBjb25zdCB7XG4gICAgICBhcmdzLFxuICAgICAgdGltZW91dFN0YXR1cyxcbiAgICAgIHJlcXVlc3QsXG4gICAgICByZXNwb25zZU1ldGEsXG4gICAgICBvbklucHV0U2NoZW1hLFxuICAgICAgcHJldmlvdXNTdGF0ZVxuICAgIH0gPSAkYXJncztcbiAgICBsZXQgYWNjRGF0YSA9IHZvaWQgMDtcbiAgICBsZXQgaW5wdXRTY2hlbWEgPSB2b2lkIDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLiRpbnRlcm5hbHMucHJvY2VkdXJlSGFuZGxlckNoYWluLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICB0aGlzLmNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKTtcbiAgICAgIGNvbnN0IHByb2NlZHVyZUhhbmRsZXIgPSB0aGlzLiRpbnRlcm5hbHMucHJvY2VkdXJlSGFuZGxlckNoYWluW2ldO1xuICAgICAgY29uc3QgW2RhdGEsIGVycl0gPSBhd2FpdCBwcm9jZWR1cmVIYW5kbGVyKGFyZ3MsIHZvaWQgMCwge1xuICAgICAgICBjdHg6IGFjY0RhdGEsXG4gICAgICAgIHJlcXVlc3QsXG4gICAgICAgIHJlc3BvbnNlTWV0YSxcbiAgICAgICAgcHJldmlvdXNTdGF0ZSxcbiAgICAgICAgc291cmNlOiBuZXcgVE9wdHNTb3VyY2UoKCkgPT4gdHJ1ZSksXG4gICAgICAgIHByZXZpb3VzSW5wdXRTY2hlbWE6IGlucHV0U2NoZW1hLFxuICAgICAgICBvbklucHV0U2NoZW1hOiAoc2NoZW1hKSA9PiB7XG4gICAgICAgICAgaW5wdXRTY2hlbWEgPSBzY2hlbWE7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKGVycikge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICBhY2NEYXRhID0gZGF0YTtcbiAgICB9XG4gICAgb25JbnB1dFNjaGVtYT8uKGlucHV0U2NoZW1hKTtcbiAgICByZXR1cm4gYWNjRGF0YTtcbiAgfVxuICAvKipcbiAgICogIFJ1biB0aHJvdWdoIHRoZSBwcm9jZWR1cmUgY2hhaW4gYW5kIGdldCB0aGUgZmluYWwgc3RhdGljIGlucHV0IHNjaGVtYVxuICAgKi9cbiAgYXN5bmMgZ2V0RmluYWxTdGF0aWNJbnB1dFNjaGVtYShhcmdzKSB7XG4gICAgbGV0IGlucHV0U2NoZW1hID0gdm9pZCAwO1xuICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuaXNQcm9jZWR1cmUgJiYgYXJncy5vcHRzKSB7XG4gICAgICBhd2FpdCB0aGlzLmV2YWx1YXRlSW5wdXRTY2hlbWEoe1xuICAgICAgICBjdHg6IHZvaWQgMCxcbiAgICAgICAgb3B0czogYXJncy5vcHRzLFxuICAgICAgICBub0Z1bmN0aW9uc0FsbG93ZWQ6IHRydWVcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHByb2NlZHVyZUhhbmRsZXIgb2YgdGhpcy4kaW50ZXJuYWxzLnByb2NlZHVyZUhhbmRsZXJDaGFpbikge1xuICAgICAgYXdhaXQgcHJvY2VkdXJlSGFuZGxlcih2b2lkIDAsIHZvaWQgMCwge1xuICAgICAgICBzb3VyY2U6IG5ldyBUT3B0c1NvdXJjZSgoKSA9PiB0cnVlKSxcbiAgICAgICAgcHJldmlvdXNJbnB1dFNjaGVtYTogaW5wdXRTY2hlbWEsXG4gICAgICAgIHJldHVybklucHV0U2NoZW1hOiB0cnVlLFxuICAgICAgICBvbklucHV0U2NoZW1hOiAoc2NoZW1hKSA9PiB7XG4gICAgICAgICAgaW5wdXRTY2hlbWEgPSBzY2hlbWE7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoIWFyZ3Mub3B0cykge1xuICAgICAgYXJncy5vcHRzID0ge1xuICAgICAgICBzb3VyY2U6IG5ldyBUT3B0c1NvdXJjZSgoKSA9PiB0cnVlKVxuICAgICAgfTtcbiAgICB9XG4gICAgYXJncy5vcHRzLnByZXZpb3VzSW5wdXRTY2hlbWEgPSBpbnB1dFNjaGVtYTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5ldmFsdWF0ZUlucHV0U2NoZW1hKHtcbiAgICAgIGN0eDogdm9pZCAwLFxuICAgICAgb3B0czogYXJncy5vcHRzLFxuICAgICAgbm9GdW5jdGlvbnNBbGxvd2VkOiB0cnVlXG4gICAgfSkgfHwgejIudW5kZWZpbmVkKCk7XG4gIH1cbiAgLyoqIHNldCBhIHRpbWVvdXQgb24gdGhlIHNlcnZlciBhY3Rpb24gKi9cbiAgdGltZW91dChtaWxsaXNlY29uZHMpIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgdGltZW91dDogbWlsbGlzZWNvbmRzXG4gICAgfSk7XG4gIH1cbiAgLyoqIHNldCBhIHJldHJ5IG1lY2hhbmlzbSBvbiB0aGUgc2VydmVyIGFjdGlvbiAqL1xuICByZXRyeShjb25maWcpIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgcmV0cnlDb25maWc6IGNvbmZpZ1xuICAgIH0pO1xuICB9XG4gIC8qKlxuICAgKiBzZXQgdGhlIGlucHV0IHNjaGVtYSBmb3IgdGhlIHNlcnZlciBhY3Rpb25cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgdHNcbiAgICogLmlucHV0KHoub2JqZWN0KHtcbiAgICogICBtZXNzYWdlOiB6LnN0cmluZygpXG4gICAqIH0pKVxuICAgKiBgYGBcbiAgICovXG4gIGlucHV0KHNjaGVtYSwgb3B0cykge1xuICAgIHJldHVybiBuZXcgX1pvZFNhZmVGdW5jdGlvbih7XG4gICAgICAuLi50aGlzLiRpbnRlcm5hbHMsXG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICBpbnB1dFNjaGVtYTogc2NoZW1hLFxuICAgICAgaW5wdXRUeXBlOiBvcHRzPy50eXBlLFxuICAgICAgc2tpcElucHV0UGFyc2luZzogb3B0cz8uc2tpcElucHV0UGFyc2luZ1xuICAgIH0pO1xuICB9XG4gIC8qKiBzZXQgdGhlIG91dHB1dCBzY2hlbWEgZm9yIHRoZSBzZXJ2ZXIgYWN0aW9uICovXG4gIG91dHB1dChzY2hlbWEpIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAgICAgb3V0cHV0U2NoZW1hOiBzY2hlbWFcbiAgICB9KTtcbiAgfVxuICAvKiogc2V0IGEgaGFuZGxlciBmdW5jdGlvbiBmb3IgaW5wdXQgcGFyc2UgZXJyb3JzICovXG4gIG9uSW5wdXRQYXJzZUVycm9yKGZuKSB7XG4gICAgcmV0dXJuIG5ldyBfWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICAgIC4uLnRoaXMuJGludGVybmFscyxcbiAgICAgIG9uSW5wdXRQYXJzZUVycm9yOiBmblxuICAgIH0pO1xuICB9XG4gIC8qKiBzZXQgYSBoYW5kbGVyIGZ1bmN0aW9uIGZvciBvdXRwdXQgcGFyc2UgZXJyb3JzICovXG4gIG9uT3V0cHV0UGFyc2VFcnJvcihmbikge1xuICAgIHJldHVybiBuZXcgX1pvZFNhZmVGdW5jdGlvbih7XG4gICAgICAuLi50aGlzLiRpbnRlcm5hbHMsXG4gICAgICBvbk91dHB1dFBhcnNlRXJyb3I6IGZuXG4gICAgfSk7XG4gIH1cbiAgLyoqIHNldCBhIGhhbmRsZXIgZnVuY3Rpb24gZm9yIGVycm9ycyAqL1xuICBvbkVycm9yKGZuKSB7XG4gICAgcmV0dXJuIG5ldyBfWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICAgIC4uLnRoaXMuJGludGVybmFscyxcbiAgICAgIG9uRXJyb3JGbnM6IFsuLi50aGlzLiRpbnRlcm5hbHMub25FcnJvckZucyB8fCBbXSwgZm5dXG4gICAgfSk7XG4gIH1cbiAgLyoqIHNldCBhIGhhbmRsZXIgZnVuY3Rpb24gZm9yIHdoZW4gdGhlIHNlcnZlciBhY3Rpb24gc3RhcnRzICovXG4gIG9uU3RhcnQoZm4pIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgb25TdGFydEZuczogWy4uLnRoaXMuJGludGVybmFscy5vblN0YXJ0Rm5zIHx8IFtdLCBmbl1cbiAgICB9KTtcbiAgfVxuICAvKiogc2V0IGEgaGFuZGxlciBmdW5jdGlvbiBmb3Igd2hlbiB0aGUgc2VydmVyIGFjdGlvbiBzdWNjZWVkcyAqL1xuICBvblN1Y2Nlc3MoZm4pIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgb25TdWNjZXNzRm5zOiBbLi4udGhpcy4kaW50ZXJuYWxzLm9uU3VjY2Vzc0ZucyB8fCBbXSwgZm5dXG4gICAgfSk7XG4gIH1cbiAgLyoqIHNldCBhIGhhbmRsZXIgZnVuY3Rpb24gZm9yIHdoZW4gdGhlIHNlcnZlciBhY3Rpb24gY29tcGxldGVzIChzdWNjZXNzIG9yIGVycm9yKSAqL1xuICBvbkNvbXBsZXRlKGZuKSB7XG4gICAgcmV0dXJuIG5ldyBfWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICAgIC4uLnRoaXMuJGludGVybmFscyxcbiAgICAgIG9uQ29tcGxldGVGbnM6IFsuLi50aGlzLiRpbnRlcm5hbHMub25Db21wbGV0ZUZucyB8fCBbXSwgZm5dXG4gICAgfSk7XG4gIH1cbiAgLyoqIGEgaGVscGVyIGZ1bmN0aW9uIHRvIHBhcnNlIG91dHB1dCBkYXRhIGdpdmVuIHRoZSBhY3RpdmUgb3V0cHV0IHNjaGVtYSAqL1xuICBhc3luYyBwYXJzZU91dHB1dERhdGEoZGF0YSwgY3R4LCB0aW1lb3V0U3RhdHVzLCBvcHRzKSB7XG4gICAgdGhpcy5jaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cyk7XG4gICAgaWYgKCF0aGlzLiRpbnRlcm5hbHMub3V0cHV0U2NoZW1hKVxuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgY29uc3Qgc2NoZW1hID0gdHlwZW9mIHRoaXMuJGludGVybmFscy5vdXRwdXRTY2hlbWEgPT09IFwiZnVuY3Rpb25cIiA/IGF3YWl0IHRoaXMuJGludGVybmFscy5vdXRwdXRTY2hlbWEoe1xuICAgICAgY3R4LFxuICAgICAgdW5wYXJzZWREYXRhOiBkYXRhLFxuICAgICAgcmVxdWVzdDogb3B0cz8ucmVxdWVzdCxcbiAgICAgIHJlc3BvbnNlTWV0YTogb3B0cz8ucmVzcG9uc2VNZXRhLFxuICAgICAgcHJldmlvdXNTdGF0ZTogb3B0cz8ucHJldmlvdXNTdGF0ZVxuICAgIH0pIDogdGhpcy4kaW50ZXJuYWxzLm91dHB1dFNjaGVtYTtcbiAgICBpZiAoIShzY2hlbWEgaW5zdGFuY2VvZiB6Mi5ab2RUeXBlKSkge1xuICAgICAgdGhyb3cgbmV3IFpTQUVycm9yKFwiRVJST1JcIiwgXCJPdXRwdXQgc2NoZW1hIG11c3QgYmUgYSBab2RUeXBlXCIpO1xuICAgIH1cbiAgICBjb25zdCBzYWZlID0gYXdhaXQgc2NoZW1hLnNhZmVQYXJzZUFzeW5jKGRhdGEpO1xuICAgIGlmICghc2FmZS5zdWNjZXNzKSB7XG4gICAgICBpZiAodGhpcy4kaW50ZXJuYWxzLm9uT3V0cHV0UGFyc2VFcnJvcikge1xuICAgICAgICBhd2FpdCB0aGlzLiRpbnRlcm5hbHMub25PdXRwdXRQYXJzZUVycm9yKHNhZmUuZXJyb3IpO1xuICAgICAgfVxuICAgICAgY29uc3QgZmxhdHRlbmVkRXJyb3JzID0gc2FmZS5lcnJvci5mbGF0dGVuKCk7XG4gICAgICBjb25zdCBmb3JtYXR0ZWRFcnJvcnMgPSBzYWZlLmVycm9yLmZvcm1hdCgpO1xuICAgICAgdGhyb3cgbmV3IFpTQUVycm9yKFwiT1VUUFVUX1BBUlNFX0VSUk9SXCIsIHNhZmUuZXJyb3IsIHtcbiAgICAgICAgb3V0cHV0UGFyc2VFcnJvcnM6IHtcbiAgICAgICAgICBmaWVsZEVycm9yczogZmxhdHRlbmVkRXJyb3JzPy5maWVsZEVycm9ycyxcbiAgICAgICAgICBmb3JtRXJyb3JzOiBmbGF0dGVuZWRFcnJvcnM/LmZvcm1FcnJvcnMsXG4gICAgICAgICAgZm9ybWF0dGVkRXJyb3JzXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gc2FmZS5kYXRhO1xuICB9XG4gIC8qKiBoZWxwZXIgZnVuY3Rpb24gdG8gaGFuZGxlIHN0YXJ0IHdpdGggdGltZW91dCBjaGVja3BvaW50cyAqL1xuICBhc3luYyBoYW5kbGVTdGFydChhcmdzLCB0aW1lb3V0U3RhdHVzKSB7XG4gICAgdGhpcy5jaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cyk7XG4gICAgaWYgKHRoaXMuJGludGVybmFscy5pc1Byb2NlZHVyZSlcbiAgICAgIHJldHVybjtcbiAgICBmb3IgKGNvbnN0IGZuIG9mIHRoaXMuJGludGVybmFscy5vblN0YXJ0Rm5zIHx8IFtdKSB7XG4gICAgICBhd2FpdCBmbih7IGFyZ3MgfSk7XG4gICAgICB0aGlzLmNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKTtcbiAgICB9XG4gIH1cbiAgLyoqIGhlbHBlciBmdW5jdGlvbiB0byBoYW5kbGUgc3VjY2VzcyB3aXRoIHRpbWVvdXQgY2hlY2twb2ludHMgKi9cbiAgYXN5bmMgaGFuZGxlU3VjY2VzcyhhcmdzLCBkYXRhLCB0aW1lb3V0U3RhdHVzKSB7XG4gICAgdGhpcy5jaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cyk7XG4gICAgaWYgKHRoaXMuJGludGVybmFscy5pc1Byb2NlZHVyZSlcbiAgICAgIHJldHVybjtcbiAgICBmb3IgKGNvbnN0IGZuIG9mIHRoaXMuJGludGVybmFscy5vblN1Y2Nlc3NGbnMgfHwgW10pIHtcbiAgICAgIGF3YWl0IGZuKHsgYXJncywgZGF0YSB9KTtcbiAgICAgIHRoaXMuY2hlY2tUaW1lb3V0U3RhdHVzKHRpbWVvdXRTdGF0dXMpO1xuICAgIH1cbiAgICB0aGlzLmNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKTtcbiAgICBmb3IgKGNvbnN0IGZuIG9mIHRoaXMuJGludGVybmFscy5vbkNvbXBsZXRlRm5zIHx8IFtdKSB7XG4gICAgICBhd2FpdCBmbih7XG4gICAgICAgIGlzU3VjY2VzczogdHJ1ZSxcbiAgICAgICAgaXNFcnJvcjogZmFsc2UsXG4gICAgICAgIHN0YXR1czogXCJzdWNjZXNzXCIsXG4gICAgICAgIGFyZ3MsXG4gICAgICAgIGRhdGFcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cyk7XG4gICAgfVxuICB9XG4gIC8qKiBoZWxwZXIgZnVuY3Rpb24gdG8gaGFuZGxlIGVycm9ycyB3aXRoIHRpbWVvdXQgY2hlY2twb2ludHMgKi9cbiAgYXN5bmMgaGFuZGxlRXJyb3IoZXJyLCBpbnB1dFJhdywgaW5wdXRQYXJzZWQpIHtcbiAgICBpZiAoZXJyLm1lc3NhZ2UgPT09IFwiTkVYVF9SRURJUkVDVFwiIHx8IGVyci5tZXNzYWdlID09PSBcIk5FWFRfTk9UX0ZPVU5EXCIpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgaWYgKHRoaXMuJGludGVybmFscy5pc1Byb2NlZHVyZSlcbiAgICAgIHJldHVybiBbbnVsbCwgZXJyXTtcbiAgICBsZXQgY3VzdG9tRXJyb3I7XG4gICAgaWYgKHRoaXMuJGludGVybmFscy5zaGFwZUVycm9yRm5zICE9PSB2b2lkIDApIHtcbiAgICAgIGxldCBhY2NEYXRhID0gdm9pZCAwO1xuICAgICAgZm9yIChjb25zdCBmbiBvZiB0aGlzLiRpbnRlcm5hbHMuc2hhcGVFcnJvckZucykge1xuICAgICAgICBhY2NEYXRhID0gYXdhaXQgZm4oe1xuICAgICAgICAgIGVycixcbiAgICAgICAgICB0eXBlZERhdGE6IHtcbiAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgICAgICAgICAgIGlucHV0UGFyc2VFcnJvcnM6IGVyciBpbnN0YW5jZW9mIFpTQUVycm9yID8gZXJyLmlucHV0UGFyc2VFcnJvcnMgOiB2b2lkIDAsXG4gICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICAgICAgICBvdXRwdXRQYXJzZUVycm9yczogZXJyIGluc3RhbmNlb2YgWlNBRXJyb3IgPyBlcnIub3V0cHV0UGFyc2VFcnJvcnMgOiB2b2lkIDAsXG4gICAgICAgICAgICBpbnB1dFBhcnNlZCxcbiAgICAgICAgICAgIGlucHV0UmF3XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjdHg6IGFjY0RhdGFcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjdXN0b21FcnJvciA9IGFjY0RhdGE7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1c3RvbUVycm9yID0gZXJyIGluc3RhbmNlb2YgWlNBRXJyb3IgPyBlcnIgOiBuZXcgWlNBRXJyb3IoXCJFUlJPUlwiLCBlcnIpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGZuIG9mIHRoaXMuJGludGVybmFscy5vbkVycm9yRm5zIHx8IFtdKSB7XG4gICAgICBhd2FpdCBmbihjdXN0b21FcnJvcik7XG4gICAgfVxuICAgIGZvciAoY29uc3QgZm4gb2YgdGhpcy4kaW50ZXJuYWxzLm9uQ29tcGxldGVGbnMgfHwgW10pIHtcbiAgICAgIGF3YWl0IGZuKHtcbiAgICAgICAgaXNTdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgaXNFcnJvcjogdHJ1ZSxcbiAgICAgICAgc3RhdHVzOiBcImVycm9yXCIsXG4gICAgICAgIGVycm9yOiBjdXN0b21FcnJvclxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuc2hhcGVFcnJvckZucyAhPT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gW251bGwsIGN1c3RvbUVycm9yXTtcbiAgICB9XG4gICAgY29uc3Qgc3RyaW5naWZ5SWZOZWVkZWQgPSAoZGF0YTIpID0+IHR5cGVvZiBkYXRhMiA9PT0gXCJzdHJpbmdcIiA/IGRhdGEyIDogSlNPTi5zdHJpbmdpZnkoZGF0YTIpO1xuICAgIGxldCBmb3JtYXR0ZWRFcnJvcnM7XG4gICAgbGV0IGZsYXR0ZW5lZEVycm9ycztcbiAgICBjb25zdCBkYXRhID0gZXJyLmRhdGE7XG4gICAgaWYgKGRhdGEgaW5zdGFuY2VvZiB6Mi5ab2RFcnJvciAmJiBjdXN0b21FcnJvci5jb2RlID09PSBcIklOUFVUX1BBUlNFX0VSUk9SXCIpIHtcbiAgICAgIGZvcm1hdHRlZEVycm9ycyA9IGRhdGEuZm9ybWF0KCk7XG4gICAgICBmbGF0dGVuZWRFcnJvcnMgPSBkYXRhLmZsYXR0ZW4oKTtcbiAgICB9XG4gICAgcmV0dXJuIFtcbiAgICAgIG51bGwsXG4gICAgICB7XG4gICAgICAgIGRhdGE6IHN0cmluZ2lmeUlmTmVlZGVkKGN1c3RvbUVycm9yLmRhdGEpLFxuICAgICAgICBuYW1lOiBjdXN0b21FcnJvci5uYW1lLFxuICAgICAgICBtZXNzYWdlOiBzdHJpbmdpZnlJZk5lZWRlZChjdXN0b21FcnJvci5tZXNzYWdlKSxcbiAgICAgICAgY29kZTogY3VzdG9tRXJyb3IuY29kZSxcbiAgICAgICAgZmllbGRFcnJvcnM6IGZsYXR0ZW5lZEVycm9ycz8uZmllbGRFcnJvcnMsXG4gICAgICAgIGZvcm1FcnJvcnM6IGZsYXR0ZW5lZEVycm9ycz8uZm9ybUVycm9ycyxcbiAgICAgICAgZm9ybWF0dGVkRXJyb3JzXG4gICAgICB9XG4gICAgXTtcbiAgfVxuICBhc3luYyBldmFsdWF0ZUlucHV0U2NoZW1hKGFyZ3MpIHtcbiAgICBjb25zdCB7IGN0eCwgb3B0cywgbm9GdW5jdGlvbnNBbGxvd2VkIH0gPSBhcmdzO1xuICAgIGxldCBpbnB1dFNjaGVtYSA9IHRoaXMuJGludGVybmFscy5pbnB1dFNjaGVtYTtcbiAgICBpZiAobm9GdW5jdGlvbnNBbGxvd2VkICYmIHR5cGVvZiBpbnB1dFNjaGVtYSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnB1dCBmdW5jdGlvbnMgYXJlIG5vdCBzdXBwcG9ydGVkIHlldFwiKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBpbnB1dFNjaGVtYSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBpbnB1dFNjaGVtYSA9IGF3YWl0IGlucHV0U2NoZW1hKHtcbiAgICAgICAgY3R4LFxuICAgICAgICBwcmV2aW91c1NjaGVtYTogb3B0cz8ucHJldmlvdXNJbnB1dFNjaGVtYSB8fCB6Mi51bmRlZmluZWQoKSxcbiAgICAgICAgcmVxdWVzdDogb3B0cz8ucmVxdWVzdCxcbiAgICAgICAgcmVzcG9uc2VNZXRhOiBvcHRzPy5yZXNwb25zZU1ldGEsXG4gICAgICAgIHByZXZpb3VzU3RhdGU6IG9wdHM/LnByZXZpb3VzU3RhdGVcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoaW5wdXRTY2hlbWEgJiYgIShpbnB1dFNjaGVtYSBpbnN0YW5jZW9mIHoyLlpvZFR5cGUpKSB7XG4gICAgICB0aHJvdyBuZXcgWlNBRXJyb3IoXCJFUlJPUlwiLCBcIklucHV0IHNjaGVtYSBtdXN0IGJlIGEgWm9kVHlwZVwiKTtcbiAgICB9XG4gICAgbGV0IGZpbmFsO1xuICAgIGlmICghb3B0cz8ucHJldmlvdXNJbnB1dFNjaGVtYSkge1xuICAgICAgZmluYWwgPSBpbnB1dFNjaGVtYTtcbiAgICB9IGVsc2UgaWYgKCFpbnB1dFNjaGVtYSkge1xuICAgICAgZmluYWwgPSBvcHRzLnByZXZpb3VzSW5wdXRTY2hlbWE7XG4gICAgfSBlbHNlIGlmIChpbnN0YW5jZW9mWm9kVHlwZU9iamVjdChvcHRzLnByZXZpb3VzSW5wdXRTY2hlbWEpICYmIGluc3RhbmNlb2Zab2RUeXBlT2JqZWN0KGlucHV0U2NoZW1hKSkge1xuICAgICAgZmluYWwgPSBvcHRzLnByZXZpb3VzSW5wdXRTY2hlbWEubWVyZ2UoaW5wdXRTY2hlbWEpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmaW5hbCA9IGlucHV0U2NoZW1hO1xuICAgIH1cbiAgICBvcHRzPy5vbklucHV0U2NoZW1hPy4oZmluYWwpO1xuICAgIHJldHVybiBmaW5hbCB8fCB6Mi51bmRlZmluZWQoKTtcbiAgfVxuICAvKiogaGVscGVyIGZ1bmN0aW9uIHRvIHBhcnNlIGlucHV0IGRhdGEgZ2l2ZW4gdGhlIGFjdGl2ZSBpbnB1dCBzY2hlbWEgKi9cbiAgYXN5bmMgcGFyc2VJbnB1dERhdGEoJGRhdGEsIG92ZXJyaWRlRGF0YSwgdGltZW91dFN0YXR1cywgY3R4LCBvcHRzKSB7XG4gICAgdGhpcy5jaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cyk7XG4gICAgY29uc3QgaW5wdXRTY2hlbWEgPSBhd2FpdCB0aGlzLmV2YWx1YXRlSW5wdXRTY2hlbWEoe1xuICAgICAgY3R4LFxuICAgICAgb3B0c1xuICAgIH0pO1xuICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuc2tpcElucHV0UGFyc2luZykge1xuICAgICAgcmV0dXJuICRkYXRhO1xuICAgIH1cbiAgICBsZXQgZGF0YSA9ICRkYXRhO1xuICAgIGlmICgkZGF0YSBpbnN0YW5jZW9mIEZvcm1EYXRhICYmIHRoaXMuJGludGVybmFscy5pbnB1dFR5cGUgIT09IFwianNvblwiKSB7XG4gICAgICBkYXRhID0ge1xuICAgICAgICAuLi5mb3JtRGF0YVRvSnNvbihkYXRhLCBpbnB1dFNjaGVtYSksXG4gICAgICAgIC4uLnRoaXMuJGludGVybmFscy5pbnB1dFR5cGUgIT09IFwic3RhdGVcIiA/IG92ZXJyaWRlRGF0YSB8fCB7fSA6IHt9XG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBjYW5DaGFuZ2VUb1VuZGVmaW5lZCA9ICgkZGF0YSBpbnN0YW5jZW9mIEZvcm1EYXRhIHx8IG9wdHM/LmlzRnJvbU9wZW5BcGlIYW5kbGVyKSAmJiBjYW5EYXRhQmVVbmRlZmluZWRGb3JTY2hlbWEoaW5wdXRTY2hlbWEpO1xuICAgIGlmIChjYW5DaGFuZ2VUb1VuZGVmaW5lZCAmJiBkYXRhICYmIHR5cGVvZiBkYXRhID09PSBcIm9iamVjdFwiICYmIE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgZGF0YSA9IHZvaWQgMDtcbiAgICB9XG4gICAgb3B0cz8ub25BcmdzPy4oZGF0YSk7XG4gICAgYXdhaXQgdGhpcy5oYW5kbGVTdGFydChkYXRhLCB0aW1lb3V0U3RhdHVzKTtcbiAgICBpZiAoIXRoaXMuJGludGVybmFscy5pbnB1dFNjaGVtYSAmJiBkYXRhICE9PSB2b2lkIDAgJiYgdGhpcy4kaW50ZXJuYWxzLmlzUHJvY2VkdXJlKSB7XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH1cbiAgICBjb25zdCBzYWZlID0gYXdhaXQgaW5wdXRTY2hlbWEuc2FmZVBhcnNlQXN5bmMoZGF0YSk7XG4gICAgaWYgKCFzYWZlLnN1Y2Nlc3MpIHtcbiAgICAgIGlmICh0aGlzLiRpbnRlcm5hbHMub25JbnB1dFBhcnNlRXJyb3IpIHtcbiAgICAgICAgYXdhaXQgdGhpcy4kaW50ZXJuYWxzLm9uSW5wdXRQYXJzZUVycm9yKHNhZmUuZXJyb3IpO1xuICAgICAgfVxuICAgICAgY29uc3QgZmxhdHRlbmVkRXJyb3JzID0gc2FmZS5lcnJvci5mbGF0dGVuKCk7XG4gICAgICBjb25zdCBmb3JtYXR0ZWRFcnJvcnMgPSBzYWZlLmVycm9yLmZvcm1hdCgpO1xuICAgICAgdGhyb3cgbmV3IFpTQUVycm9yKFwiSU5QVVRfUEFSU0VfRVJST1JcIiwgc2FmZS5lcnJvciwge1xuICAgICAgICBpbnB1dFBhcnNlRXJyb3JzOiB7XG4gICAgICAgICAgZmllbGRFcnJvcnM6IGZsYXR0ZW5lZEVycm9ycz8uZmllbGRFcnJvcnMsXG4gICAgICAgICAgZm9ybUVycm9yczogZmxhdHRlbmVkRXJyb3JzPy5mb3JtRXJyb3JzLFxuICAgICAgICAgIGZvcm1hdHRlZEVycm9yc1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHNhZmUuZGF0YTtcbiAgfVxuICAvKiogc2V0IGEgaGFuZGxlciBmdW5jdGlvbiBmb3Igd2hlbiB0aGUgc2VydmVyIGFjdGlvbiBzdGFydHMgKi9cbiAgZXhwZXJpbWVudGFsX3NoYXBlRXJyb3IoZm4pIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAgICAgc2hhcGVFcnJvckZuczogWy4uLnRoaXMuJGludGVybmFscy5zaGFwZUVycm9yRm5zIHx8IFtdLCBmbl1cbiAgICB9KTtcbiAgfVxuICBnZXRUaW1lb3V0RXJyb3JQcm9taXNlID0gKHRpbWVvdXRNcykgPT4gbmV3IFByb21pc2UoKF8sIHJlamVjdCkgPT4ge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgcmVqZWN0KG5ldyBaU0FFcnJvcihcIlRJTUVPVVRcIiwgYEV4Y2VlZGVkIHRpbWVvdXQgb2YgJHt0aW1lb3V0TXN9IG1zYCkpO1xuICAgIH0sIHRpbWVvdXRNcyk7XG4gIH0pO1xuICAvKiogc2V0IHRoZSBoYW5kbGVyIGZ1bmN0aW9uIGZvciB0aGUgc2VydmVyIGFjdGlvbiAqL1xuICBoYW5kbGVyKGZuKSB7XG4gICAgY29uc3QgdGltZW91dFN0YXR1cyA9IHtcbiAgICAgIGlzVGltZW91dDogZmFsc2VcbiAgICB9O1xuICAgIGNvbnN0IHdyYXBwZXIgPSBhc3luYyAoJGFyZ3MsIG92ZXJyaWRlQXJncywgb3B0cykgPT4ge1xuICAgICAgdmFsaWRhdGVPcHRzKG9wdHMpO1xuICAgICAgaWYgKG9wdHM/LnJldHVybklucHV0U2NoZW1hKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldEZpbmFsU3RhdGljSW5wdXRTY2hlbWEoe1xuICAgICAgICAgIG9wdHNcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKG9wdHM/LnJldHVybk91dHB1dFNjaGVtYSkge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMuJGludGVybmFscy5vdXRwdXRTY2hlbWEgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiQ2Fubm90IHJldHVybiBvdXRwdXQgc2NoZW1hIGZyb20gYSBmdW5jdGlvbiBvdXRwdXQgc2NoZW1hXCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLiRpbnRlcm5hbHMub3V0cHV0U2NoZW1hO1xuICAgICAgfVxuICAgICAgbGV0IGFyZ3M7XG4gICAgICBsZXQgcGFyc2VkQXJncztcbiAgICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuaW5wdXRUeXBlID09PSBcInN0YXRlXCIpIHtcbiAgICAgICAgYXJncyA9IG92ZXJyaWRlQXJncztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFyZ3MgPSAkYXJncztcbiAgICAgIH1cbiAgICAgIGxldCBwcmV2aW91c1N0YXRlID0gb3B0cz8ucHJldmlvdXNTdGF0ZSB8fCB2b2lkIDA7XG4gICAgICBpZiAodGhpcy4kaW50ZXJuYWxzLmlucHV0VHlwZSA9PT0gXCJzdGF0ZVwiICYmICF0aGlzLiRpbnRlcm5hbHMuaXNQcm9jZWR1cmUpIHtcbiAgICAgICAgcHJldmlvdXNTdGF0ZSA9ICRhcmdzO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgbGV0IGN0eDtcbiAgICAgICAgaWYgKHRoaXMuJGludGVybmFscy5pc1Byb2NlZHVyZSAmJiBvcHRzKSB7XG4gICAgICAgICAgY3R4ID0gb3B0cy5jdHg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3R4ID0gYXdhaXQgdGhpcy5nZXRQcm9jZWR1cmVDaGFpbk91dHB1dCh7XG4gICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICAgICAgICBhcmdzLFxuICAgICAgICAgICAgdGltZW91dFN0YXR1cyxcbiAgICAgICAgICAgIHJlcXVlc3Q6IG9wdHM/LnJlcXVlc3QsXG4gICAgICAgICAgICByZXNwb25zZU1ldGE6IG9wdHM/LnJlc3BvbnNlTWV0YSxcbiAgICAgICAgICAgIG9uSW5wdXRTY2hlbWE6IChzY2hlbWEpID0+IHtcbiAgICAgICAgICAgICAgaWYgKCFvcHRzKSB7XG4gICAgICAgICAgICAgICAgb3B0cyA9IHtcbiAgICAgICAgICAgICAgICAgIHNvdXJjZTogbmV3IFRPcHRzU291cmNlKCgpID0+IHRydWUpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBvcHRzLnByZXZpb3VzSW5wdXRTY2hlbWEgPSBzY2hlbWE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJldmlvdXNTdGF0ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlucHV0ID0gYXdhaXQgdGhpcy5wYXJzZUlucHV0RGF0YShcbiAgICAgICAgICBhcmdzLFxuICAgICAgICAgIG92ZXJyaWRlQXJncyxcbiAgICAgICAgICB0aW1lb3V0U3RhdHVzLFxuICAgICAgICAgIGN0eCxcbiAgICAgICAgICBvcHRzXG4gICAgICAgICk7XG4gICAgICAgIG9wdHM/Lm9uUGFyc2VkQXJncz8uKGlucHV0KTtcbiAgICAgICAgcGFyc2VkQXJncyA9IGlucHV0O1xuICAgICAgICB0aGlzLmNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKTtcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZuKHtcbiAgICAgICAgICBpbnB1dCxcbiAgICAgICAgICBjdHgsXG4gICAgICAgICAgcmVxdWVzdDogb3B0cz8ucmVxdWVzdCxcbiAgICAgICAgICByZXNwb25zZU1ldGE6IG9wdHM/LnJlc3BvbnNlTWV0YSxcbiAgICAgICAgICBwcmV2aW91c1N0YXRlXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBwYXJzZWQgPSBhd2FpdCB0aGlzLnBhcnNlT3V0cHV0RGF0YShcbiAgICAgICAgICBkYXRhLFxuICAgICAgICAgIGN0eCxcbiAgICAgICAgICB0aW1lb3V0U3RhdHVzLFxuICAgICAgICAgIG9wdHNcbiAgICAgICAgKTtcbiAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVTdWNjZXNzKGlucHV0LCBwYXJzZWQsIHRpbWVvdXRTdGF0dXMpO1xuICAgICAgICByZXR1cm4gW3BhcnNlZCwgbnVsbF07XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc3QgcmV0cnlEZWxheSA9IHRoaXMuZ2V0UmV0cnlEZWxheShlcnIsIG9wdHM/LmF0dGVtcHRzIHx8IDEpO1xuICAgICAgICBpZiAocmV0cnlEZWxheSA+PSAwKSB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHIpID0+IHNldFRpbWVvdXQociwgcmV0cnlEZWxheSkpO1xuICAgICAgICAgIHJldHVybiBhd2FpdCB3cmFwcGVyKCRhcmdzLCBvdmVycmlkZUFyZ3MsIHtcbiAgICAgICAgICAgIC4uLm9wdHMgfHwge30sXG4gICAgICAgICAgICBhdHRlbXB0czogKG9wdHM/LmF0dGVtcHRzIHx8IDEpICsgMSxcbiAgICAgICAgICAgIHNvdXJjZTogbmV3IFRPcHRzU291cmNlKCgpID0+IHRydWUpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuaGFuZGxlRXJyb3IoZXJyLCBhcmdzLCBwYXJzZWRBcmdzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHdpdGhUaW1lb3V0ID0gYXN5bmMgKGFyZ3MsIG92ZXJyaWRlQXJncywgb3B0cykgPT4ge1xuICAgICAgY29uc3QgdGltZW91dE1zID0gdGhpcy4kaW50ZXJuYWxzLnRpbWVvdXQ7XG4gICAgICBpZiAoIXRpbWVvdXRNcylcbiAgICAgICAgcmV0dXJuIGF3YWl0IHdyYXBwZXIoYXJncywgb3ZlcnJpZGVBcmdzLCBvcHRzKTtcbiAgICAgIHZhbGlkYXRlT3B0cyhvcHRzKTtcbiAgICAgIGxldCBnb3RBcmdzID0gdm9pZCAwO1xuICAgICAgbGV0IGdvdFBhcnNlZEFyZ3MgPSB2b2lkIDA7XG4gICAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5yYWNlKFtcbiAgICAgICAgd3JhcHBlcihhcmdzLCBvdmVycmlkZUFyZ3MsIHtcbiAgICAgICAgICAuLi5vcHRzIHx8IHt9LFxuICAgICAgICAgIG9uQXJnczogKGFyZ3MyKSA9PiB7XG4gICAgICAgICAgICBnb3RBcmdzID0gYXJnczI7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvblBhcnNlZEFyZ3M6IChwYXJzZWRBcmdzKSA9PiB7XG4gICAgICAgICAgICBnb3RQYXJzZWRBcmdzID0gcGFyc2VkQXJncztcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNvdXJjZTogbmV3IFRPcHRzU291cmNlKCgpID0+IHRydWUpXG4gICAgICAgIH0pLFxuICAgICAgICB0aGlzLmdldFRpbWVvdXRFcnJvclByb21pc2UodGltZW91dE1zKVxuICAgICAgXSkudGhlbigocikgPT4gcikuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICB0aW1lb3V0U3RhdHVzLmlzVGltZW91dCA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVycm9yKGVyciwgZ290QXJncywgZ290UGFyc2VkQXJncyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuaXNQcm9jZWR1cmUpIHtcbiAgICAgIGNvbnN0IGhhbmRsZXIgPSB0aGlzLiRpbnRlcm5hbHMudGltZW91dCA/IHdpdGhUaW1lb3V0IDogd3JhcHBlcjtcbiAgICAgIHJldHVybiBuZXcgQ29tcGxldGVQcm9jZWR1cmUoe1xuICAgICAgICBpbnB1dFNjaGVtYTogdGhpcy4kaW50ZXJuYWxzLmlucHV0U2NoZW1hLFxuICAgICAgICBoYW5kbGVyQ2hhaW46IFsuLi50aGlzLiRpbnRlcm5hbHMucHJvY2VkdXJlSGFuZGxlckNoYWluLCBoYW5kbGVyXSxcbiAgICAgICAgc2hhcGVFcnJvckZuczogdGhpcy4kaW50ZXJuYWxzLnNoYXBlRXJyb3JGbnMsXG4gICAgICAgIGxhc3RIYW5kbGVyOiBoYW5kbGVyLFxuICAgICAgICBvbkNvbXBsZXRlRm5zOiB0aGlzLiRpbnRlcm5hbHMub25Db21wbGV0ZUZucyxcbiAgICAgICAgb25FcnJvckZuczogdGhpcy4kaW50ZXJuYWxzLm9uRXJyb3JGbnMsXG4gICAgICAgIG9uU3RhcnRGbnM6IHRoaXMuJGludGVybmFscy5vblN0YXJ0Rm5zLFxuICAgICAgICBvblN1Y2Nlc3NGbnM6IHRoaXMuJGludGVybmFscy5vblN1Y2Nlc3NGbnMsXG4gICAgICAgIHRpbWVvdXQ6IHRoaXMuJGludGVybmFscy50aW1lb3V0LFxuICAgICAgICByZXRyeUNvbmZpZzogdGhpcy4kaW50ZXJuYWxzLnJldHJ5Q29uZmlnXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHRoaXMuJGludGVybmFscy50aW1lb3V0KSB7XG4gICAgICByZXR1cm4gd2l0aFRpbWVvdXQ7XG4gICAgfVxuICAgIHJldHVybiB3cmFwcGVyO1xuICB9XG59O1xuZnVuY3Rpb24gY3JlYXRlWm9kU2FmZUZ1bmN0aW9uKGlzUHJvY2VkdXJlLCBwYXJlbnRQcm9jZWR1cmUpIHtcbiAgcmV0dXJuIG5ldyBab2RTYWZlRnVuY3Rpb24oe1xuICAgIGlucHV0U2NoZW1hOiBwYXJlbnRQcm9jZWR1cmU/LiRpbnRlcm5hbHMuaW5wdXRTY2hlbWEgfHwgdm9pZCAwLFxuICAgIG91dHB1dFNjaGVtYTogdm9pZCAwLFxuICAgIHNoYXBlRXJyb3JGbnM6IHBhcmVudFByb2NlZHVyZT8uJGludGVybmFscy5zaGFwZUVycm9yRm5zIHx8IHZvaWQgMCxcbiAgICBpc0NoYWluZWQ6IHBhcmVudFByb2NlZHVyZSAhPT0gdm9pZCAwLFxuICAgIGlzUHJvY2VkdXJlOiBpc1Byb2NlZHVyZSA9PT0gdHJ1ZSxcbiAgICBwcm9jZWR1cmVIYW5kbGVyQ2hhaW46IHBhcmVudFByb2NlZHVyZT8uJGludGVybmFscy5oYW5kbGVyQ2hhaW4gfHwgW10sXG4gICAgb25Db21wbGV0ZUZuczogcGFyZW50UHJvY2VkdXJlPy4kaW50ZXJuYWxzLm9uQ29tcGxldGVGbnMsXG4gICAgb25FcnJvckZuczogcGFyZW50UHJvY2VkdXJlPy4kaW50ZXJuYWxzLm9uRXJyb3JGbnMsXG4gICAgb25TdGFydEZuczogcGFyZW50UHJvY2VkdXJlPy4kaW50ZXJuYWxzLm9uU3RhcnRGbnMsXG4gICAgb25TdWNjZXNzRm5zOiBwYXJlbnRQcm9jZWR1cmU/LiRpbnRlcm5hbHMub25TdWNjZXNzRm5zXG4gIH0pO1xufVxuZnVuY3Rpb24gY3JlYXRlU2VydmVyQWN0aW9uKCkge1xuICByZXR1cm4gbmV3IFpvZFNhZmVGdW5jdGlvbih7XG4gICAgaW5wdXRTY2hlbWE6IHZvaWQgMCxcbiAgICBvdXRwdXRTY2hlbWE6IHZvaWQgMCxcbiAgICBzaGFwZUVycm9yRm5zOiB2b2lkIDAsXG4gICAgcHJvY2VkdXJlSGFuZGxlckNoYWluOiBbXVxuICB9KTtcbn1cblxuLy8gc3JjL3Byb2NlZHVyZS50c1xudmFyIENvbXBsZXRlUHJvY2VkdXJlID0gY2xhc3Mge1xuICAkaW50ZXJuYWxzO1xuICBjb25zdHJ1Y3RvcihwYXJhbXMpIHtcbiAgICB0aGlzLiRpbnRlcm5hbHMgPSBwYXJhbXM7XG4gIH1cbiAgLyoqIG1ha2UgYSBzZXJ2ZXIgYWN0aW9uIHdpdGggdGhlIGN1cnJlbnQgcHJvY2VkdXJlICovXG4gIGNyZWF0ZVNlcnZlckFjdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IFpvZFNhZmVGdW5jdGlvbih7XG4gICAgICBpbnB1dFNjaGVtYTogdGhpcy4kaW50ZXJuYWxzLmlucHV0U2NoZW1hLFxuICAgICAgb3V0cHV0U2NoZW1hOiB2b2lkIDAsXG4gICAgICBwcm9jZWR1cmVIYW5kbGVyQ2hhaW46IHRoaXMuJGludGVybmFscy5oYW5kbGVyQ2hhaW4sXG4gICAgICBvbkVycm9yRm5zOiB0aGlzLiRpbnRlcm5hbHMub25FcnJvckZucyxcbiAgICAgIG9uU3RhcnRGbnM6IHRoaXMuJGludGVybmFscy5vblN0YXJ0Rm5zLFxuICAgICAgb25TdWNjZXNzRm5zOiB0aGlzLiRpbnRlcm5hbHMub25TdWNjZXNzRm5zLFxuICAgICAgb25Db21wbGV0ZUZuczogdGhpcy4kaW50ZXJuYWxzLm9uQ29tcGxldGVGbnMsXG4gICAgICB0aW1lb3V0OiB0aGlzLiRpbnRlcm5hbHMudGltZW91dCxcbiAgICAgIHJldHJ5Q29uZmlnOiB0aGlzLiRpbnRlcm5hbHMucmV0cnlDb25maWcsXG4gICAgICBzaGFwZUVycm9yRm5zOiB0aGlzLiRpbnRlcm5hbHMuc2hhcGVFcnJvckZuc1xuICAgIH0pO1xuICB9XG59O1xudmFyIGNyZWF0ZVNlcnZlckFjdGlvblByb2NlZHVyZSA9IChwYXJlbnQpID0+IHtcbiAgcmV0dXJuIGNyZWF0ZVpvZFNhZmVGdW5jdGlvbih0cnVlLCBwYXJlbnQpO1xufTtcbnZhciBjaGFpblNlcnZlckFjdGlvblByb2NlZHVyZXMgPSAoZmlyc3QsIHNlY29uZCkgPT4ge1xuICByZXR1cm4gbmV3IENvbXBsZXRlUHJvY2VkdXJlKHtcbiAgICBpbnB1dFNjaGVtYTogc2Vjb25kLiRpbnRlcm5hbHMuaW5wdXRTY2hlbWEsXG4gICAgaGFuZGxlckNoYWluOiBbXG4gICAgICAuLi5maXJzdC4kaW50ZXJuYWxzLmhhbmRsZXJDaGFpbixcbiAgICAgIHNlY29uZC4kaW50ZXJuYWxzLmxhc3RIYW5kbGVyXG4gICAgXSxcbiAgICBsYXN0SGFuZGxlcjogc2Vjb25kLiRpbnRlcm5hbHMubGFzdEhhbmRsZXIsXG4gICAgdGltZW91dDogc2Vjb25kLiRpbnRlcm5hbHMudGltZW91dCB8fCBmaXJzdC4kaW50ZXJuYWxzLnRpbWVvdXQsXG4gICAgcmV0cnlDb25maWc6IHNlY29uZC4kaW50ZXJuYWxzLnJldHJ5Q29uZmlnIHx8IGZpcnN0LiRpbnRlcm5hbHMucmV0cnlDb25maWcsXG4gICAgc2hhcGVFcnJvckZuczogbWVyZ2VBcnJheXNBbmRSZW1vdmVEdXBsaWNhdGVzKFxuICAgICAgZmlyc3QuJGludGVybmFscy5zaGFwZUVycm9yRm5zLFxuICAgICAgc2Vjb25kLiRpbnRlcm5hbHMuc2hhcGVFcnJvckZuc1xuICAgICksXG4gICAgb25FcnJvckZuczogbWVyZ2VBcnJheXNBbmRSZW1vdmVEdXBsaWNhdGVzKFxuICAgICAgZmlyc3QuJGludGVybmFscy5vbkVycm9yRm5zLFxuICAgICAgc2Vjb25kLiRpbnRlcm5hbHMub25FcnJvckZuc1xuICAgICksXG4gICAgb25TdGFydEZuczogbWVyZ2VBcnJheXNBbmRSZW1vdmVEdXBsaWNhdGVzKFxuICAgICAgZmlyc3QuJGludGVybmFscy5vblN0YXJ0Rm5zLFxuICAgICAgc2Vjb25kLiRpbnRlcm5hbHMub25TdGFydEZuc1xuICAgICksXG4gICAgb25TdWNjZXNzRm5zOiBtZXJnZUFycmF5c0FuZFJlbW92ZUR1cGxpY2F0ZXMoXG4gICAgICBmaXJzdC4kaW50ZXJuYWxzLm9uU3VjY2Vzc0ZucyxcbiAgICAgIHNlY29uZC4kaW50ZXJuYWxzLm9uU3VjY2Vzc0Zuc1xuICAgICksXG4gICAgb25Db21wbGV0ZUZuczogbWVyZ2VBcnJheXNBbmRSZW1vdmVEdXBsaWNhdGVzKFxuICAgICAgZmlyc3QuJGludGVybmFscy5vbkNvbXBsZXRlRm5zLFxuICAgICAgc2Vjb25kLiRpbnRlcm5hbHMub25Db21wbGV0ZUZuc1xuICAgIClcbiAgfSk7XG59O1xuZXhwb3J0IHtcbiAgQ29tcGxldGVQcm9jZWR1cmUsXG4gIERlZmF1bHRPbWl0dGVkLFxuICBTaGFwZUVycm9yTm90U2V0LFxuICBUT3B0c1NvdXJjZSxcbiAgWlNBRXJyb3IsXG4gIFpTQVJlc3BvbnNlTWV0YSxcbiAgWm9kU2FmZUZ1bmN0aW9uLFxuICBhZGRUb051bGxpc2hBcnJheSxcbiAgY2FuRGF0YUJlVW5kZWZpbmVkRm9yU2NoZW1hLFxuICBjaGFpblNlcnZlckFjdGlvblByb2NlZHVyZXMsXG4gIGNyZWF0ZVNlcnZlckFjdGlvbixcbiAgY3JlYXRlU2VydmVyQWN0aW9uUHJvY2VkdXJlLFxuICBjcmVhdGVab2RTYWZlRnVuY3Rpb24sXG4gIGZvcm1EYXRhVG9Kc29uLFxuICBpbnN0YW5jZW9mWm9kVHlwZUFycmF5LFxuICBpbnN0YW5jZW9mWm9kVHlwZUJvb2xlYW4sXG4gIGluc3RhbmNlb2Zab2RUeXBlS2luZCxcbiAgaW5zdGFuY2VvZlpvZFR5cGVMaWtlVm9pZCxcbiAgaW5zdGFuY2VvZlpvZFR5cGVPYmplY3QsXG4gIGlzS2V5QUJvb2xlYW5JblpvZFNjaGVtYSxcbiAgaXNLZXlBbkFycmF5SW5ab2RTY2hlbWEsXG4gIG1lcmdlQXJyYXlzQW5kUmVtb3ZlRHVwbGljYXRlcyxcbiAgdW53cmFwWm9kVHlwZVxufTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(action-browser)/./node_modules/zsa/dist/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/zsa/dist/index.mjs":
/*!*****************************************!*\
  !*** ./node_modules/zsa/dist/index.mjs ***!
  \*****************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CompleteProcedure: () => (/* binding */ CompleteProcedure),\n/* harmony export */   DefaultOmitted: () => (/* binding */ DefaultOmitted),\n/* harmony export */   ShapeErrorNotSet: () => (/* binding */ ShapeErrorNotSet),\n/* harmony export */   TOptsSource: () => (/* binding */ TOptsSource),\n/* harmony export */   ZSAError: () => (/* binding */ ZSAError),\n/* harmony export */   ZSAResponseMeta: () => (/* binding */ ZSAResponseMeta),\n/* harmony export */   ZodSafeFunction: () => (/* binding */ ZodSafeFunction),\n/* harmony export */   addToNullishArray: () => (/* binding */ addToNullishArray),\n/* harmony export */   canDataBeUndefinedForSchema: () => (/* binding */ canDataBeUndefinedForSchema),\n/* harmony export */   chainServerActionProcedures: () => (/* binding */ chainServerActionProcedures),\n/* harmony export */   createServerAction: () => (/* binding */ createServerAction),\n/* harmony export */   createServerActionProcedure: () => (/* binding */ createServerActionProcedure),\n/* harmony export */   createZodSafeFunction: () => (/* binding */ createZodSafeFunction),\n/* harmony export */   formDataToJson: () => (/* binding */ formDataToJson),\n/* harmony export */   instanceofZodTypeArray: () => (/* binding */ instanceofZodTypeArray),\n/* harmony export */   instanceofZodTypeBoolean: () => (/* binding */ instanceofZodTypeBoolean),\n/* harmony export */   instanceofZodTypeKind: () => (/* binding */ instanceofZodTypeKind),\n/* harmony export */   instanceofZodTypeLikeVoid: () => (/* binding */ instanceofZodTypeLikeVoid),\n/* harmony export */   instanceofZodTypeObject: () => (/* binding */ instanceofZodTypeObject),\n/* harmony export */   isKeyABooleanInZodSchema: () => (/* binding */ isKeyABooleanInZodSchema),\n/* harmony export */   isKeyAnArrayInZodSchema: () => (/* binding */ isKeyAnArrayInZodSchema),\n/* harmony export */   mergeArraysAndRemoveDuplicates: () => (/* binding */ mergeArraysAndRemoveDuplicates),\n/* harmony export */   unwrapZodType: () => (/* binding */ unwrapZodType)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v3/ZodError.js\");\n// src/errors.ts\nvar ERROR_CODES = {\n  INPUT_PARSE_ERROR: \"INPUT_PARSE_ERROR\",\n  OUTPUT_PARSE_ERROR: \"OUTPUT_PARSE_ERROR\",\n  ERROR: \"ERROR\",\n  NOT_AUTHORIZED: \"NOT_AUTHORIZED\",\n  TIMEOUT: \"TIMEOUT\",\n  INTERNAL_SERVER_ERROR: \"INTERNAL_SERVER_ERROR\",\n  FORBIDDEN: \"FORBIDDEN\",\n  NOT_FOUND: \"NOT_FOUND\",\n  CONFLICT: \"CONFLICT\",\n  PRECONDITION_FAILED: \"PRECONDITION_FAILED\",\n  PAYLOAD_TOO_LARGE: \"PAYLOAD_TOO_LARGE\",\n  METHOD_NOT_SUPPORTED: \"METHOD_NOT_SUPPORTED\",\n  UNPROCESSABLE_CONTENT: \"UNPROCESSABLE_CONTENT\",\n  TOO_MANY_REQUESTS: \"TOO_MANY_REQUESTS\",\n  CLIENT_CLOSED_REQUEST: \"CLIENT_CLOSED_REQUEST\",\n  INSUFFICIENT_CREDITS: \"INSUFFICIENT_CREDITS\",\n  PAYMENT_REQUIRED: \"PAYMENT_REQUIRED\"\n};\nvar ZSAError = class extends Error {\n  /** the Error object thrown */\n  data;\n  /** the error code */\n  code;\n  inputParseErrors;\n  outputParseErrors;\n  constructor(code = ERROR_CODES.ERROR, data, more) {\n    super();\n    this.data = data;\n    this.code = code;\n    if (data instanceof Error) {\n      this.message = data.message;\n      this.stack = data.stack;\n      this.name = data.name;\n      this.cause = data.cause;\n    }\n    if (!this.message && typeof this.data === \"string\") {\n      this.message = this.data;\n    }\n    this.inputParseErrors = more?.inputParseErrors;\n    this.outputParseErrors = more?.outputParseErrors;\n  }\n};\n\n// src/utils.ts\n\nvar instanceofZodTypeKind = (type, zodTypeKind) => {\n  return type?._def?.typeName === zodTypeKind;\n};\nvar unwrapZodType = (type, unwrapPreprocess) => {\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodOptional)) {\n    return unwrapZodType(type.unwrap(), unwrapPreprocess);\n  }\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodDefault)) {\n    return unwrapZodType(type.removeDefault(), unwrapPreprocess);\n  }\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodLazy)) {\n    return unwrapZodType(type._def.getter(), unwrapPreprocess);\n  }\n  if (instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodEffects)) {\n    if (type._def.effect.type === \"refinement\") {\n      return unwrapZodType(type._def.schema, unwrapPreprocess);\n    }\n    if (type._def.effect.type === \"transform\") {\n      return unwrapZodType(type._def.schema, unwrapPreprocess);\n    }\n    if (unwrapPreprocess && type._def.effect.type === \"preprocess\") {\n      return unwrapZodType(type._def.schema, unwrapPreprocess);\n    }\n  }\n  return type;\n};\nvar instanceofZodTypeObject = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodObject);\n};\nvar instanceofZodTypeArray = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodArray);\n};\nvar instanceofZodTypeBoolean = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodBoolean);\n};\nvar unwrapKeyInZodSchema = (key, schema) => {\n  const unwrapped = unwrapZodType(schema, true);\n  const isObject = instanceofZodTypeObject(unwrapped);\n  if (!isObject)\n    return null;\n  const shape = unwrapped.shape;\n  if (!(key in shape))\n    return null;\n  const value = shape[key];\n  if (!value)\n    return null;\n  return unwrapZodType(value, true);\n};\nvar isKeyAnArrayInZodSchema = (key, schema) => {\n  const unwrappedValue = unwrapKeyInZodSchema(key, schema);\n  if (unwrappedValue === null)\n    return false;\n  const isArray = instanceofZodTypeArray(unwrappedValue);\n  return isArray;\n};\nvar isKeyABooleanInZodSchema = (key, schema) => {\n  const unwrappedValue = unwrapKeyInZodSchema(key, schema);\n  if (unwrappedValue === null)\n    return false;\n  const isArray = instanceofZodTypeBoolean(unwrappedValue);\n  return isArray;\n};\nvar formDataToJson = (formData, inputSchema) => {\n  const json = {};\n  formData.forEach((value, key) => {\n    const isArraySchema = isKeyAnArrayInZodSchema(key, inputSchema);\n    const isBooleanSchema = isKeyABooleanInZodSchema(key, inputSchema);\n    if (!Reflect.has(json, key)) {\n      json[key] = isArraySchema ? [value] : value;\n      if (isBooleanSchema) {\n        if (json[key] === \"true\")\n          json[key] = true;\n        if (json[key] === \"false\")\n          json[key] = false;\n      }\n      return;\n    }\n    if (!Array.isArray(json[key])) {\n      json[key] = [json[key]];\n    }\n    json[key].push(value);\n  });\n  return json;\n};\nvar addToNullishArray = (array, value) => {\n  if (!array && !value)\n    return void 0;\n  if (!value)\n    return array;\n  const temp = [...array || []];\n  temp.push(value);\n  return temp;\n};\nvar mergeArraysAndRemoveDuplicates = (array1, array2) => {\n  if (!array1 && !array2)\n    return void 0;\n  if (!array2)\n    return array1;\n  if (!array1)\n    return array2;\n  const temp = [...array1 || [], ...array2 || []];\n  return [...new Set(temp)];\n};\nvar instanceofZodTypeLikeVoid = (type) => {\n  return instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodVoid) || instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodUndefined) || instanceofZodTypeKind(type, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodNever);\n};\nvar canDataBeUndefinedForSchema = (schema) => {\n  if (!schema)\n    return true;\n  if (instanceofZodTypeLikeVoid(schema))\n    return true;\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodOptional)) {\n    return true;\n  }\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodDefault)) {\n    return true;\n  }\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodLazy)) {\n    return canDataBeUndefinedForSchema(schema._def.getter());\n  }\n  if (instanceofZodTypeKind(schema, zod__WEBPACK_IMPORTED_MODULE_0__.ZodFirstPartyTypeKind.ZodEffects)) {\n    if (schema._def.effect.type === \"refinement\") {\n      return canDataBeUndefinedForSchema(schema._def.schema);\n    }\n    if (schema._def.effect.type === \"transform\") {\n      return canDataBeUndefinedForSchema(schema._def.schema);\n    }\n    if (schema._def.effect.type === \"preprocess\") {\n      return canDataBeUndefinedForSchema(schema._def.schema);\n    }\n  }\n  return false;\n};\n\n// src/zod-safe-function.ts\n\n\n// src/types.ts\nvar TOptsSource = class {\n  validate;\n  constructor(validate) {\n    this.validate = validate;\n  }\n};\nvar DefaultOmitted = {\n  $internals: 1,\n  handleError: 1,\n  onInputParseError: 1,\n  getTimeoutErrorPromise: 1,\n  getProcedureChainOutput: 1,\n  handleSuccess: 1,\n  handleStart: 1,\n  parseInputData: 1,\n  parseOutputData: 1,\n  onOutputParseError: 1,\n  checkTimeoutStatus: 1,\n  getRetryDelay: 1,\n  evaluateInputSchema: 1,\n  getFinalStaticInputSchema: 1\n};\nvar ZSAResponseMeta = class {\n  /**\n   * the headers of the response\n   */\n  headers;\n  /**\n   * the status code of the response\n   *\n   * @default 200\n   */\n  statusCode;\n  constructor() {\n    this.statusCode = 200;\n    this.headers = new Headers();\n  }\n};\nvar ShapeErrorNotSet = \"ShapeErrorNotSet\";\n\n// src/zod-safe-function.ts\nvar validateOpts = (opts) => {\n  if (opts && (!(opts.source instanceof TOptsSource) || !opts.source.validate())) {\n    throw new Error(\"Invalid opts, must originate from the server\");\n  }\n};\nvar ZodSafeFunction = class _ZodSafeFunction {\n  /** The internals of the Zod Safe Function */\n  $internals;\n  constructor(internals) {\n    this.$internals = internals;\n  }\n  /** Check if the timeout has triggered, if so, throw a ZSAError */\n  checkTimeoutStatus(timeoutStatus) {\n    if (timeoutStatus.isTimeout) {\n      throw new ZSAError(\n        \"TIMEOUT\",\n        `Exceeded timeout of ${this.$internals.timeout} ms`\n      );\n    }\n  }\n  /**\n   *\n   * Get the retry delay for the current retry attempt\n   *\n   * If there should be no retry, returns -1\n   */\n  getRetryDelay($err, currentAttempt) {\n    try {\n      const err = $err instanceof ZSAError ? $err : new ZSAError(\"ERROR\", $err);\n      if (err.code === \"TIMEOUT\") {\n        return -1;\n      }\n      const config = this.$internals.retryConfig;\n      if (!config)\n        return -1;\n      if (this.$internals.isProcedure)\n        return -1;\n      const shouldRetry = currentAttempt < config.maxAttempts;\n      let retryDelay = 0;\n      if (typeof config.delay === \"function\") {\n        retryDelay = config.delay(currentAttempt, err);\n      } else if (typeof config.delay === \"number\") {\n        retryDelay = config.delay;\n      }\n      if (shouldRetry)\n        return retryDelay;\n      return -1;\n    } catch {\n      return -1;\n    }\n  }\n  /**\n   *  Run through the procedure chain and get the final context\n   */\n  async getProcedureChainOutput($args) {\n    const {\n      args,\n      timeoutStatus,\n      request,\n      responseMeta,\n      onInputSchema,\n      previousState\n    } = $args;\n    let accData = void 0;\n    let inputSchema = void 0;\n    for (let i = 0; i < this.$internals.procedureHandlerChain.length; i += 1) {\n      this.checkTimeoutStatus(timeoutStatus);\n      const procedureHandler = this.$internals.procedureHandlerChain[i];\n      const [data, err] = await procedureHandler(args, void 0, {\n        ctx: accData,\n        request,\n        responseMeta,\n        previousState,\n        source: new TOptsSource(() => true),\n        previousInputSchema: inputSchema,\n        onInputSchema: (schema) => {\n          inputSchema = schema;\n        }\n      });\n      if (err) {\n        throw err;\n      }\n      accData = data;\n    }\n    onInputSchema?.(inputSchema);\n    return accData;\n  }\n  /**\n   *  Run through the procedure chain and get the final static input schema\n   */\n  async getFinalStaticInputSchema(args) {\n    let inputSchema = void 0;\n    if (this.$internals.isProcedure && args.opts) {\n      await this.evaluateInputSchema({\n        ctx: void 0,\n        opts: args.opts,\n        noFunctionsAllowed: true\n      });\n      return;\n    }\n    for (const procedureHandler of this.$internals.procedureHandlerChain) {\n      await procedureHandler(void 0, void 0, {\n        source: new TOptsSource(() => true),\n        previousInputSchema: inputSchema,\n        returnInputSchema: true,\n        onInputSchema: (schema) => {\n          inputSchema = schema;\n        }\n      });\n    }\n    if (!args.opts) {\n      args.opts = {\n        source: new TOptsSource(() => true)\n      };\n    }\n    args.opts.previousInputSchema = inputSchema;\n    return await this.evaluateInputSchema({\n      ctx: void 0,\n      opts: args.opts,\n      noFunctionsAllowed: true\n    }) || zod__WEBPACK_IMPORTED_MODULE_0__.undefined();\n  }\n  /** set a timeout on the server action */\n  timeout(milliseconds) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      timeout: milliseconds\n    });\n  }\n  /** set a retry mechanism on the server action */\n  retry(config) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      retryConfig: config\n    });\n  }\n  /**\n   * set the input schema for the server action\n   *\n   * @example\n   * ```ts\n   * .input(z.object({\n   *   message: z.string()\n   * }))\n   * ```\n   */\n  input(schema, opts) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      // @ts-expect-error\n      inputSchema: schema,\n      inputType: opts?.type,\n      skipInputParsing: opts?.skipInputParsing\n    });\n  }\n  /** set the output schema for the server action */\n  output(schema) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      // @ts-expect-error\n      outputSchema: schema\n    });\n  }\n  /** set a handler function for input parse errors */\n  onInputParseError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onInputParseError: fn\n    });\n  }\n  /** set a handler function for output parse errors */\n  onOutputParseError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onOutputParseError: fn\n    });\n  }\n  /** set a handler function for errors */\n  onError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onErrorFns: [...this.$internals.onErrorFns || [], fn]\n    });\n  }\n  /** set a handler function for when the server action starts */\n  onStart(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onStartFns: [...this.$internals.onStartFns || [], fn]\n    });\n  }\n  /** set a handler function for when the server action succeeds */\n  onSuccess(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onSuccessFns: [...this.$internals.onSuccessFns || [], fn]\n    });\n  }\n  /** set a handler function for when the server action completes (success or error) */\n  onComplete(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      onCompleteFns: [...this.$internals.onCompleteFns || [], fn]\n    });\n  }\n  /** a helper function to parse output data given the active output schema */\n  async parseOutputData(data, ctx, timeoutStatus, opts) {\n    this.checkTimeoutStatus(timeoutStatus);\n    if (!this.$internals.outputSchema)\n      return data;\n    const schema = typeof this.$internals.outputSchema === \"function\" ? await this.$internals.outputSchema({\n      ctx,\n      unparsedData: data,\n      request: opts?.request,\n      responseMeta: opts?.responseMeta,\n      previousState: opts?.previousState\n    }) : this.$internals.outputSchema;\n    if (!(schema instanceof zod__WEBPACK_IMPORTED_MODULE_0__.ZodType)) {\n      throw new ZSAError(\"ERROR\", \"Output schema must be a ZodType\");\n    }\n    const safe = await schema.safeParseAsync(data);\n    if (!safe.success) {\n      if (this.$internals.onOutputParseError) {\n        await this.$internals.onOutputParseError(safe.error);\n      }\n      const flattenedErrors = safe.error.flatten();\n      const formattedErrors = safe.error.format();\n      throw new ZSAError(\"OUTPUT_PARSE_ERROR\", safe.error, {\n        outputParseErrors: {\n          fieldErrors: flattenedErrors?.fieldErrors,\n          formErrors: flattenedErrors?.formErrors,\n          formattedErrors\n        }\n      });\n    }\n    return safe.data;\n  }\n  /** helper function to handle start with timeout checkpoints */\n  async handleStart(args, timeoutStatus) {\n    this.checkTimeoutStatus(timeoutStatus);\n    if (this.$internals.isProcedure)\n      return;\n    for (const fn of this.$internals.onStartFns || []) {\n      await fn({ args });\n      this.checkTimeoutStatus(timeoutStatus);\n    }\n  }\n  /** helper function to handle success with timeout checkpoints */\n  async handleSuccess(args, data, timeoutStatus) {\n    this.checkTimeoutStatus(timeoutStatus);\n    if (this.$internals.isProcedure)\n      return;\n    for (const fn of this.$internals.onSuccessFns || []) {\n      await fn({ args, data });\n      this.checkTimeoutStatus(timeoutStatus);\n    }\n    this.checkTimeoutStatus(timeoutStatus);\n    for (const fn of this.$internals.onCompleteFns || []) {\n      await fn({\n        isSuccess: true,\n        isError: false,\n        status: \"success\",\n        args,\n        data\n      });\n      this.checkTimeoutStatus(timeoutStatus);\n    }\n  }\n  /** helper function to handle errors with timeout checkpoints */\n  async handleError(err, inputRaw, inputParsed) {\n    if (err.message === \"NEXT_REDIRECT\" || err.message === \"NEXT_NOT_FOUND\") {\n      throw err;\n    }\n    if (this.$internals.isProcedure)\n      return [null, err];\n    let customError;\n    if (this.$internals.shapeErrorFns !== void 0) {\n      let accData = void 0;\n      for (const fn of this.$internals.shapeErrorFns) {\n        accData = await fn({\n          err,\n          typedData: {\n            // @ts-expect-error\n            inputParseErrors: err instanceof ZSAError ? err.inputParseErrors : void 0,\n            // @ts-expect-error\n            outputParseErrors: err instanceof ZSAError ? err.outputParseErrors : void 0,\n            inputParsed,\n            inputRaw\n          },\n          ctx: accData\n        });\n      }\n      customError = accData;\n    } else {\n      customError = err instanceof ZSAError ? err : new ZSAError(\"ERROR\", err);\n    }\n    for (const fn of this.$internals.onErrorFns || []) {\n      await fn(customError);\n    }\n    for (const fn of this.$internals.onCompleteFns || []) {\n      await fn({\n        isSuccess: false,\n        isError: true,\n        status: \"error\",\n        error: customError\n      });\n    }\n    if (this.$internals.shapeErrorFns !== void 0) {\n      return [null, customError];\n    }\n    const stringifyIfNeeded = (data2) => typeof data2 === \"string\" ? data2 : JSON.stringify(data2);\n    let formattedErrors;\n    let flattenedErrors;\n    const data = err.data;\n    if (data instanceof zod__WEBPACK_IMPORTED_MODULE_1__.ZodError && customError.code === \"INPUT_PARSE_ERROR\") {\n      formattedErrors = data.format();\n      flattenedErrors = data.flatten();\n    }\n    return [\n      null,\n      {\n        data: stringifyIfNeeded(customError.data),\n        name: customError.name,\n        message: stringifyIfNeeded(customError.message),\n        code: customError.code,\n        fieldErrors: flattenedErrors?.fieldErrors,\n        formErrors: flattenedErrors?.formErrors,\n        formattedErrors\n      }\n    ];\n  }\n  async evaluateInputSchema(args) {\n    const { ctx, opts, noFunctionsAllowed } = args;\n    let inputSchema = this.$internals.inputSchema;\n    if (noFunctionsAllowed && typeof inputSchema === \"function\") {\n      throw new Error(\"Input functions are not suppported yet\");\n    }\n    if (typeof inputSchema === \"function\") {\n      inputSchema = await inputSchema({\n        ctx,\n        previousSchema: opts?.previousInputSchema || zod__WEBPACK_IMPORTED_MODULE_0__.undefined(),\n        request: opts?.request,\n        responseMeta: opts?.responseMeta,\n        previousState: opts?.previousState\n      });\n    }\n    if (inputSchema && !(inputSchema instanceof zod__WEBPACK_IMPORTED_MODULE_0__.ZodType)) {\n      throw new ZSAError(\"ERROR\", \"Input schema must be a ZodType\");\n    }\n    let final;\n    if (!opts?.previousInputSchema) {\n      final = inputSchema;\n    } else if (!inputSchema) {\n      final = opts.previousInputSchema;\n    } else if (instanceofZodTypeObject(opts.previousInputSchema) && instanceofZodTypeObject(inputSchema)) {\n      final = opts.previousInputSchema.merge(inputSchema);\n    } else {\n      final = inputSchema;\n    }\n    opts?.onInputSchema?.(final);\n    return final || zod__WEBPACK_IMPORTED_MODULE_0__.undefined();\n  }\n  /** helper function to parse input data given the active input schema */\n  async parseInputData($data, overrideData, timeoutStatus, ctx, opts) {\n    this.checkTimeoutStatus(timeoutStatus);\n    const inputSchema = await this.evaluateInputSchema({\n      ctx,\n      opts\n    });\n    if (this.$internals.skipInputParsing) {\n      return $data;\n    }\n    let data = $data;\n    if ($data instanceof FormData && this.$internals.inputType !== \"json\") {\n      data = {\n        ...formDataToJson(data, inputSchema),\n        ...this.$internals.inputType !== \"state\" ? overrideData || {} : {}\n      };\n    }\n    const canChangeToUndefined = ($data instanceof FormData || opts?.isFromOpenApiHandler) && canDataBeUndefinedForSchema(inputSchema);\n    if (canChangeToUndefined && data && typeof data === \"object\" && Object.keys(data).length === 0) {\n      data = void 0;\n    }\n    opts?.onArgs?.(data);\n    await this.handleStart(data, timeoutStatus);\n    if (!this.$internals.inputSchema && data !== void 0 && this.$internals.isProcedure) {\n      return void 0;\n    }\n    const safe = await inputSchema.safeParseAsync(data);\n    if (!safe.success) {\n      if (this.$internals.onInputParseError) {\n        await this.$internals.onInputParseError(safe.error);\n      }\n      const flattenedErrors = safe.error.flatten();\n      const formattedErrors = safe.error.format();\n      throw new ZSAError(\"INPUT_PARSE_ERROR\", safe.error, {\n        inputParseErrors: {\n          fieldErrors: flattenedErrors?.fieldErrors,\n          formErrors: flattenedErrors?.formErrors,\n          formattedErrors\n        }\n      });\n    }\n    return safe.data;\n  }\n  /** set a handler function for when the server action starts */\n  experimental_shapeError(fn) {\n    return new _ZodSafeFunction({\n      ...this.$internals,\n      // @ts-expect-error\n      shapeErrorFns: [...this.$internals.shapeErrorFns || [], fn]\n    });\n  }\n  getTimeoutErrorPromise = (timeoutMs) => new Promise((_, reject) => {\n    setTimeout(() => {\n      reject(new ZSAError(\"TIMEOUT\", `Exceeded timeout of ${timeoutMs} ms`));\n    }, timeoutMs);\n  });\n  /** set the handler function for the server action */\n  handler(fn) {\n    const timeoutStatus = {\n      isTimeout: false\n    };\n    const wrapper = async ($args, overrideArgs, opts) => {\n      validateOpts(opts);\n      if (opts?.returnInputSchema) {\n        return await this.getFinalStaticInputSchema({\n          opts\n        });\n      } else if (opts?.returnOutputSchema) {\n        if (typeof this.$internals.outputSchema === \"function\") {\n          throw new Error(\n            \"Cannot return output schema from a function output schema\"\n          );\n        }\n        return this.$internals.outputSchema;\n      }\n      let args;\n      let parsedArgs;\n      if (this.$internals.inputType === \"state\") {\n        args = overrideArgs;\n      } else {\n        args = $args;\n      }\n      let previousState = opts?.previousState || void 0;\n      if (this.$internals.inputType === \"state\" && !this.$internals.isProcedure) {\n        previousState = $args;\n      }\n      try {\n        let ctx;\n        if (this.$internals.isProcedure && opts) {\n          ctx = opts.ctx;\n        } else {\n          ctx = await this.getProcedureChainOutput({\n            // @ts-expect-error\n            args,\n            timeoutStatus,\n            request: opts?.request,\n            responseMeta: opts?.responseMeta,\n            onInputSchema: (schema) => {\n              if (!opts) {\n                opts = {\n                  source: new TOptsSource(() => true)\n                };\n              }\n              opts.previousInputSchema = schema;\n            },\n            previousState\n          });\n        }\n        const input = await this.parseInputData(\n          args,\n          overrideArgs,\n          timeoutStatus,\n          ctx,\n          opts\n        );\n        opts?.onParsedArgs?.(input);\n        parsedArgs = input;\n        this.checkTimeoutStatus(timeoutStatus);\n        const data = await fn({\n          input,\n          ctx,\n          request: opts?.request,\n          responseMeta: opts?.responseMeta,\n          previousState\n        });\n        const parsed = await this.parseOutputData(\n          data,\n          ctx,\n          timeoutStatus,\n          opts\n        );\n        await this.handleSuccess(input, parsed, timeoutStatus);\n        return [parsed, null];\n      } catch (err) {\n        const retryDelay = this.getRetryDelay(err, opts?.attempts || 1);\n        if (retryDelay >= 0) {\n          await new Promise((r) => setTimeout(r, retryDelay));\n          return await wrapper($args, overrideArgs, {\n            ...opts || {},\n            attempts: (opts?.attempts || 1) + 1,\n            source: new TOptsSource(() => true)\n          });\n        }\n        return await this.handleError(err, args, parsedArgs);\n      }\n    };\n    const withTimeout = async (args, overrideArgs, opts) => {\n      const timeoutMs = this.$internals.timeout;\n      if (!timeoutMs)\n        return await wrapper(args, overrideArgs, opts);\n      validateOpts(opts);\n      let gotArgs = void 0;\n      let gotParsedArgs = void 0;\n      return await Promise.race([\n        wrapper(args, overrideArgs, {\n          ...opts || {},\n          onArgs: (args2) => {\n            gotArgs = args2;\n          },\n          onParsedArgs: (parsedArgs) => {\n            gotParsedArgs = parsedArgs;\n          },\n          source: new TOptsSource(() => true)\n        }),\n        this.getTimeoutErrorPromise(timeoutMs)\n      ]).then((r) => r).catch((err) => {\n        timeoutStatus.isTimeout = true;\n        return this.handleError(err, gotArgs, gotParsedArgs);\n      });\n    };\n    if (this.$internals.isProcedure) {\n      const handler = this.$internals.timeout ? withTimeout : wrapper;\n      return new CompleteProcedure({\n        inputSchema: this.$internals.inputSchema,\n        handlerChain: [...this.$internals.procedureHandlerChain, handler],\n        shapeErrorFns: this.$internals.shapeErrorFns,\n        lastHandler: handler,\n        onCompleteFns: this.$internals.onCompleteFns,\n        onErrorFns: this.$internals.onErrorFns,\n        onStartFns: this.$internals.onStartFns,\n        onSuccessFns: this.$internals.onSuccessFns,\n        timeout: this.$internals.timeout,\n        retryConfig: this.$internals.retryConfig\n      });\n    }\n    if (this.$internals.timeout) {\n      return withTimeout;\n    }\n    return wrapper;\n  }\n};\nfunction createZodSafeFunction(isProcedure, parentProcedure) {\n  return new ZodSafeFunction({\n    inputSchema: parentProcedure?.$internals.inputSchema || void 0,\n    outputSchema: void 0,\n    shapeErrorFns: parentProcedure?.$internals.shapeErrorFns || void 0,\n    isChained: parentProcedure !== void 0,\n    isProcedure: isProcedure === true,\n    procedureHandlerChain: parentProcedure?.$internals.handlerChain || [],\n    onCompleteFns: parentProcedure?.$internals.onCompleteFns,\n    onErrorFns: parentProcedure?.$internals.onErrorFns,\n    onStartFns: parentProcedure?.$internals.onStartFns,\n    onSuccessFns: parentProcedure?.$internals.onSuccessFns\n  });\n}\nfunction createServerAction() {\n  return new ZodSafeFunction({\n    inputSchema: void 0,\n    outputSchema: void 0,\n    shapeErrorFns: void 0,\n    procedureHandlerChain: []\n  });\n}\n\n// src/procedure.ts\nvar CompleteProcedure = class {\n  $internals;\n  constructor(params) {\n    this.$internals = params;\n  }\n  /** make a server action with the current procedure */\n  createServerAction() {\n    return new ZodSafeFunction({\n      inputSchema: this.$internals.inputSchema,\n      outputSchema: void 0,\n      procedureHandlerChain: this.$internals.handlerChain,\n      onErrorFns: this.$internals.onErrorFns,\n      onStartFns: this.$internals.onStartFns,\n      onSuccessFns: this.$internals.onSuccessFns,\n      onCompleteFns: this.$internals.onCompleteFns,\n      timeout: this.$internals.timeout,\n      retryConfig: this.$internals.retryConfig,\n      shapeErrorFns: this.$internals.shapeErrorFns\n    });\n  }\n};\nvar createServerActionProcedure = (parent) => {\n  return createZodSafeFunction(true, parent);\n};\nvar chainServerActionProcedures = (first, second) => {\n  return new CompleteProcedure({\n    inputSchema: second.$internals.inputSchema,\n    handlerChain: [\n      ...first.$internals.handlerChain,\n      second.$internals.lastHandler\n    ],\n    lastHandler: second.$internals.lastHandler,\n    timeout: second.$internals.timeout || first.$internals.timeout,\n    retryConfig: second.$internals.retryConfig || first.$internals.retryConfig,\n    shapeErrorFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.shapeErrorFns,\n      second.$internals.shapeErrorFns\n    ),\n    onErrorFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onErrorFns,\n      second.$internals.onErrorFns\n    ),\n    onStartFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onStartFns,\n      second.$internals.onStartFns\n    ),\n    onSuccessFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onSuccessFns,\n      second.$internals.onSuccessFns\n    ),\n    onCompleteFns: mergeArraysAndRemoveDuplicates(\n      first.$internals.onCompleteFns,\n      second.$internals.onCompleteFns\n    )\n  });\n};\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvenNhL2Rpc3QvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ3dCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLHNEQUF1QjtBQUN6RDtBQUNBO0FBQ0Esa0NBQWtDLHNEQUF1QjtBQUN6RDtBQUNBO0FBQ0Esa0NBQWtDLHNEQUF1QjtBQUN6RDtBQUNBO0FBQ0Esa0NBQWtDLHNEQUF1QjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxzREFBdUI7QUFDNUQ7QUFDQTtBQUNBLHFDQUFxQyxzREFBdUI7QUFDNUQ7QUFDQTtBQUNBLHFDQUFxQyxzREFBdUI7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxzREFBdUIseUNBQXlDLHNEQUF1Qiw4Q0FBOEMsc0RBQXVCO0FBQ2pNO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxzREFBdUI7QUFDM0Q7QUFDQTtBQUNBLG9DQUFvQyxzREFBdUI7QUFDM0Q7QUFDQTtBQUNBLG9DQUFvQyxzREFBdUI7QUFDM0Q7QUFDQTtBQUNBLG9DQUFvQyxzREFBdUI7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQzhCOztBQUU5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLHlCQUF5QjtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxvQkFBb0Isa0RBQWtEO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUssS0FBSywwQ0FBWTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCw0QkFBNEIsd0NBQVU7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixNQUFNO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixZQUFZO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUNBQVc7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksZ0NBQWdDO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscURBQXFELDBDQUFZO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLGdEQUFnRCx3Q0FBVTtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwwQ0FBWTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRTtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLDREQUE0RCxXQUFXO0FBQ3ZFLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7QUFDdkI7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQXlCRSIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx6YWludWxhYWJhaWRpblxcRG93bmxvYWRzXFxGaW5hbFByb2plY3QtbWFpblxcRmluYWxQcm9qZWN0LW1haW5cXG5vZGVfbW9kdWxlc1xcenNhXFxkaXN0XFxpbmRleC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2Vycm9ycy50c1xudmFyIEVSUk9SX0NPREVTID0ge1xuICBJTlBVVF9QQVJTRV9FUlJPUjogXCJJTlBVVF9QQVJTRV9FUlJPUlwiLFxuICBPVVRQVVRfUEFSU0VfRVJST1I6IFwiT1VUUFVUX1BBUlNFX0VSUk9SXCIsXG4gIEVSUk9SOiBcIkVSUk9SXCIsXG4gIE5PVF9BVVRIT1JJWkVEOiBcIk5PVF9BVVRIT1JJWkVEXCIsXG4gIFRJTUVPVVQ6IFwiVElNRU9VVFwiLFxuICBJTlRFUk5BTF9TRVJWRVJfRVJST1I6IFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsXG4gIEZPUkJJRERFTjogXCJGT1JCSURERU5cIixcbiAgTk9UX0ZPVU5EOiBcIk5PVF9GT1VORFwiLFxuICBDT05GTElDVDogXCJDT05GTElDVFwiLFxuICBQUkVDT05ESVRJT05fRkFJTEVEOiBcIlBSRUNPTkRJVElPTl9GQUlMRURcIixcbiAgUEFZTE9BRF9UT09fTEFSR0U6IFwiUEFZTE9BRF9UT09fTEFSR0VcIixcbiAgTUVUSE9EX05PVF9TVVBQT1JURUQ6IFwiTUVUSE9EX05PVF9TVVBQT1JURURcIixcbiAgVU5QUk9DRVNTQUJMRV9DT05URU5UOiBcIlVOUFJPQ0VTU0FCTEVfQ09OVEVOVFwiLFxuICBUT09fTUFOWV9SRVFVRVNUUzogXCJUT09fTUFOWV9SRVFVRVNUU1wiLFxuICBDTElFTlRfQ0xPU0VEX1JFUVVFU1Q6IFwiQ0xJRU5UX0NMT1NFRF9SRVFVRVNUXCIsXG4gIElOU1VGRklDSUVOVF9DUkVESVRTOiBcIklOU1VGRklDSUVOVF9DUkVESVRTXCIsXG4gIFBBWU1FTlRfUkVRVUlSRUQ6IFwiUEFZTUVOVF9SRVFVSVJFRFwiXG59O1xudmFyIFpTQUVycm9yID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7XG4gIC8qKiB0aGUgRXJyb3Igb2JqZWN0IHRocm93biAqL1xuICBkYXRhO1xuICAvKiogdGhlIGVycm9yIGNvZGUgKi9cbiAgY29kZTtcbiAgaW5wdXRQYXJzZUVycm9ycztcbiAgb3V0cHV0UGFyc2VFcnJvcnM7XG4gIGNvbnN0cnVjdG9yKGNvZGUgPSBFUlJPUl9DT0RFUy5FUlJPUiwgZGF0YSwgbW9yZSkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICB0aGlzLmNvZGUgPSBjb2RlO1xuICAgIGlmIChkYXRhIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgIHRoaXMubWVzc2FnZSA9IGRhdGEubWVzc2FnZTtcbiAgICAgIHRoaXMuc3RhY2sgPSBkYXRhLnN0YWNrO1xuICAgICAgdGhpcy5uYW1lID0gZGF0YS5uYW1lO1xuICAgICAgdGhpcy5jYXVzZSA9IGRhdGEuY2F1c2U7XG4gICAgfVxuICAgIGlmICghdGhpcy5tZXNzYWdlICYmIHR5cGVvZiB0aGlzLmRhdGEgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRoaXMubWVzc2FnZSA9IHRoaXMuZGF0YTtcbiAgICB9XG4gICAgdGhpcy5pbnB1dFBhcnNlRXJyb3JzID0gbW9yZT8uaW5wdXRQYXJzZUVycm9ycztcbiAgICB0aGlzLm91dHB1dFBhcnNlRXJyb3JzID0gbW9yZT8ub3V0cHV0UGFyc2VFcnJvcnM7XG4gIH1cbn07XG5cbi8vIHNyYy91dGlscy50c1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbnZhciBpbnN0YW5jZW9mWm9kVHlwZUtpbmQgPSAodHlwZSwgem9kVHlwZUtpbmQpID0+IHtcbiAgcmV0dXJuIHR5cGU/Ll9kZWY/LnR5cGVOYW1lID09PSB6b2RUeXBlS2luZDtcbn07XG52YXIgdW53cmFwWm9kVHlwZSA9ICh0eXBlLCB1bndyYXBQcmVwcm9jZXNzKSA9PiB7XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQodHlwZSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kT3B0aW9uYWwpKSB7XG4gICAgcmV0dXJuIHVud3JhcFpvZFR5cGUodHlwZS51bndyYXAoKSwgdW53cmFwUHJlcHJvY2Vzcyk7XG4gIH1cbiAgaWYgKGluc3RhbmNlb2Zab2RUeXBlS2luZCh0eXBlLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2REZWZhdWx0KSkge1xuICAgIHJldHVybiB1bndyYXBab2RUeXBlKHR5cGUucmVtb3ZlRGVmYXVsdCgpLCB1bndyYXBQcmVwcm9jZXNzKTtcbiAgfVxuICBpZiAoaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHR5cGUsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZExhenkpKSB7XG4gICAgcmV0dXJuIHVud3JhcFpvZFR5cGUodHlwZS5fZGVmLmdldHRlcigpLCB1bndyYXBQcmVwcm9jZXNzKTtcbiAgfVxuICBpZiAoaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHR5cGUsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZEVmZmVjdHMpKSB7XG4gICAgaWYgKHR5cGUuX2RlZi5lZmZlY3QudHlwZSA9PT0gXCJyZWZpbmVtZW50XCIpIHtcbiAgICAgIHJldHVybiB1bndyYXBab2RUeXBlKHR5cGUuX2RlZi5zY2hlbWEsIHVud3JhcFByZXByb2Nlc3MpO1xuICAgIH1cbiAgICBpZiAodHlwZS5fZGVmLmVmZmVjdC50eXBlID09PSBcInRyYW5zZm9ybVwiKSB7XG4gICAgICByZXR1cm4gdW53cmFwWm9kVHlwZSh0eXBlLl9kZWYuc2NoZW1hLCB1bndyYXBQcmVwcm9jZXNzKTtcbiAgICB9XG4gICAgaWYgKHVud3JhcFByZXByb2Nlc3MgJiYgdHlwZS5fZGVmLmVmZmVjdC50eXBlID09PSBcInByZXByb2Nlc3NcIikge1xuICAgICAgcmV0dXJuIHVud3JhcFpvZFR5cGUodHlwZS5fZGVmLnNjaGVtYSwgdW53cmFwUHJlcHJvY2Vzcyk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0eXBlO1xufTtcbnZhciBpbnN0YW5jZW9mWm9kVHlwZU9iamVjdCA9ICh0eXBlKSA9PiB7XG4gIHJldHVybiBpbnN0YW5jZW9mWm9kVHlwZUtpbmQodHlwZSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kT2JqZWN0KTtcbn07XG52YXIgaW5zdGFuY2VvZlpvZFR5cGVBcnJheSA9ICh0eXBlKSA9PiB7XG4gIHJldHVybiBpbnN0YW5jZW9mWm9kVHlwZUtpbmQodHlwZSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kQXJyYXkpO1xufTtcbnZhciBpbnN0YW5jZW9mWm9kVHlwZUJvb2xlYW4gPSAodHlwZSkgPT4ge1xuICByZXR1cm4gaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHR5cGUsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZEJvb2xlYW4pO1xufTtcbnZhciB1bndyYXBLZXlJblpvZFNjaGVtYSA9IChrZXksIHNjaGVtYSkgPT4ge1xuICBjb25zdCB1bndyYXBwZWQgPSB1bndyYXBab2RUeXBlKHNjaGVtYSwgdHJ1ZSk7XG4gIGNvbnN0IGlzT2JqZWN0ID0gaW5zdGFuY2VvZlpvZFR5cGVPYmplY3QodW53cmFwcGVkKTtcbiAgaWYgKCFpc09iamVjdClcbiAgICByZXR1cm4gbnVsbDtcbiAgY29uc3Qgc2hhcGUgPSB1bndyYXBwZWQuc2hhcGU7XG4gIGlmICghKGtleSBpbiBzaGFwZSkpXG4gICAgcmV0dXJuIG51bGw7XG4gIGNvbnN0IHZhbHVlID0gc2hhcGVba2V5XTtcbiAgaWYgKCF2YWx1ZSlcbiAgICByZXR1cm4gbnVsbDtcbiAgcmV0dXJuIHVud3JhcFpvZFR5cGUodmFsdWUsIHRydWUpO1xufTtcbnZhciBpc0tleUFuQXJyYXlJblpvZFNjaGVtYSA9IChrZXksIHNjaGVtYSkgPT4ge1xuICBjb25zdCB1bndyYXBwZWRWYWx1ZSA9IHVud3JhcEtleUluWm9kU2NoZW1hKGtleSwgc2NoZW1hKTtcbiAgaWYgKHVud3JhcHBlZFZhbHVlID09PSBudWxsKVxuICAgIHJldHVybiBmYWxzZTtcbiAgY29uc3QgaXNBcnJheSA9IGluc3RhbmNlb2Zab2RUeXBlQXJyYXkodW53cmFwcGVkVmFsdWUpO1xuICByZXR1cm4gaXNBcnJheTtcbn07XG52YXIgaXNLZXlBQm9vbGVhbkluWm9kU2NoZW1hID0gKGtleSwgc2NoZW1hKSA9PiB7XG4gIGNvbnN0IHVud3JhcHBlZFZhbHVlID0gdW53cmFwS2V5SW5ab2RTY2hlbWEoa2V5LCBzY2hlbWEpO1xuICBpZiAodW53cmFwcGVkVmFsdWUgPT09IG51bGwpXG4gICAgcmV0dXJuIGZhbHNlO1xuICBjb25zdCBpc0FycmF5ID0gaW5zdGFuY2VvZlpvZFR5cGVCb29sZWFuKHVud3JhcHBlZFZhbHVlKTtcbiAgcmV0dXJuIGlzQXJyYXk7XG59O1xudmFyIGZvcm1EYXRhVG9Kc29uID0gKGZvcm1EYXRhLCBpbnB1dFNjaGVtYSkgPT4ge1xuICBjb25zdCBqc29uID0ge307XG4gIGZvcm1EYXRhLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcbiAgICBjb25zdCBpc0FycmF5U2NoZW1hID0gaXNLZXlBbkFycmF5SW5ab2RTY2hlbWEoa2V5LCBpbnB1dFNjaGVtYSk7XG4gICAgY29uc3QgaXNCb29sZWFuU2NoZW1hID0gaXNLZXlBQm9vbGVhbkluWm9kU2NoZW1hKGtleSwgaW5wdXRTY2hlbWEpO1xuICAgIGlmICghUmVmbGVjdC5oYXMoanNvbiwga2V5KSkge1xuICAgICAganNvbltrZXldID0gaXNBcnJheVNjaGVtYSA/IFt2YWx1ZV0gOiB2YWx1ZTtcbiAgICAgIGlmIChpc0Jvb2xlYW5TY2hlbWEpIHtcbiAgICAgICAgaWYgKGpzb25ba2V5XSA9PT0gXCJ0cnVlXCIpXG4gICAgICAgICAganNvbltrZXldID0gdHJ1ZTtcbiAgICAgICAgaWYgKGpzb25ba2V5XSA9PT0gXCJmYWxzZVwiKVxuICAgICAgICAgIGpzb25ba2V5XSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoanNvbltrZXldKSkge1xuICAgICAganNvbltrZXldID0gW2pzb25ba2V5XV07XG4gICAgfVxuICAgIGpzb25ba2V5XS5wdXNoKHZhbHVlKTtcbiAgfSk7XG4gIHJldHVybiBqc29uO1xufTtcbnZhciBhZGRUb051bGxpc2hBcnJheSA9IChhcnJheSwgdmFsdWUpID0+IHtcbiAgaWYgKCFhcnJheSAmJiAhdmFsdWUpXG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgaWYgKCF2YWx1ZSlcbiAgICByZXR1cm4gYXJyYXk7XG4gIGNvbnN0IHRlbXAgPSBbLi4uYXJyYXkgfHwgW11dO1xuICB0ZW1wLnB1c2godmFsdWUpO1xuICByZXR1cm4gdGVtcDtcbn07XG52YXIgbWVyZ2VBcnJheXNBbmRSZW1vdmVEdXBsaWNhdGVzID0gKGFycmF5MSwgYXJyYXkyKSA9PiB7XG4gIGlmICghYXJyYXkxICYmICFhcnJheTIpXG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgaWYgKCFhcnJheTIpXG4gICAgcmV0dXJuIGFycmF5MTtcbiAgaWYgKCFhcnJheTEpXG4gICAgcmV0dXJuIGFycmF5MjtcbiAgY29uc3QgdGVtcCA9IFsuLi5hcnJheTEgfHwgW10sIC4uLmFycmF5MiB8fCBbXV07XG4gIHJldHVybiBbLi4ubmV3IFNldCh0ZW1wKV07XG59O1xudmFyIGluc3RhbmNlb2Zab2RUeXBlTGlrZVZvaWQgPSAodHlwZSkgPT4ge1xuICByZXR1cm4gaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHR5cGUsIHouWm9kRmlyc3RQYXJ0eVR5cGVLaW5kLlpvZFZvaWQpIHx8IGluc3RhbmNlb2Zab2RUeXBlS2luZCh0eXBlLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RVbmRlZmluZWQpIHx8IGluc3RhbmNlb2Zab2RUeXBlS2luZCh0eXBlLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2ROZXZlcik7XG59O1xudmFyIGNhbkRhdGFCZVVuZGVmaW5lZEZvclNjaGVtYSA9IChzY2hlbWEpID0+IHtcbiAgaWYgKCFzY2hlbWEpXG4gICAgcmV0dXJuIHRydWU7XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUxpa2VWb2lkKHNjaGVtYSkpXG4gICAgcmV0dXJuIHRydWU7XG4gIGlmIChpbnN0YW5jZW9mWm9kVHlwZUtpbmQoc2NoZW1hLCB6LlpvZEZpcnN0UGFydHlUeXBlS2luZC5ab2RPcHRpb25hbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHNjaGVtYSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kRGVmYXVsdCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHNjaGVtYSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kTGF6eSkpIHtcbiAgICByZXR1cm4gY2FuRGF0YUJlVW5kZWZpbmVkRm9yU2NoZW1hKHNjaGVtYS5fZGVmLmdldHRlcigpKTtcbiAgfVxuICBpZiAoaW5zdGFuY2VvZlpvZFR5cGVLaW5kKHNjaGVtYSwgei5ab2RGaXJzdFBhcnR5VHlwZUtpbmQuWm9kRWZmZWN0cykpIHtcbiAgICBpZiAoc2NoZW1hLl9kZWYuZWZmZWN0LnR5cGUgPT09IFwicmVmaW5lbWVudFwiKSB7XG4gICAgICByZXR1cm4gY2FuRGF0YUJlVW5kZWZpbmVkRm9yU2NoZW1hKHNjaGVtYS5fZGVmLnNjaGVtYSk7XG4gICAgfVxuICAgIGlmIChzY2hlbWEuX2RlZi5lZmZlY3QudHlwZSA9PT0gXCJ0cmFuc2Zvcm1cIikge1xuICAgICAgcmV0dXJuIGNhbkRhdGFCZVVuZGVmaW5lZEZvclNjaGVtYShzY2hlbWEuX2RlZi5zY2hlbWEpO1xuICAgIH1cbiAgICBpZiAoc2NoZW1hLl9kZWYuZWZmZWN0LnR5cGUgPT09IFwicHJlcHJvY2Vzc1wiKSB7XG4gICAgICByZXR1cm4gY2FuRGF0YUJlVW5kZWZpbmVkRm9yU2NoZW1hKHNjaGVtYS5fZGVmLnNjaGVtYSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbi8vIHNyYy96b2Qtc2FmZS1mdW5jdGlvbi50c1xuaW1wb3J0IHsgeiBhcyB6MiB9IGZyb20gXCJ6b2RcIjtcblxuLy8gc3JjL3R5cGVzLnRzXG52YXIgVE9wdHNTb3VyY2UgPSBjbGFzcyB7XG4gIHZhbGlkYXRlO1xuICBjb25zdHJ1Y3Rvcih2YWxpZGF0ZSkge1xuICAgIHRoaXMudmFsaWRhdGUgPSB2YWxpZGF0ZTtcbiAgfVxufTtcbnZhciBEZWZhdWx0T21pdHRlZCA9IHtcbiAgJGludGVybmFsczogMSxcbiAgaGFuZGxlRXJyb3I6IDEsXG4gIG9uSW5wdXRQYXJzZUVycm9yOiAxLFxuICBnZXRUaW1lb3V0RXJyb3JQcm9taXNlOiAxLFxuICBnZXRQcm9jZWR1cmVDaGFpbk91dHB1dDogMSxcbiAgaGFuZGxlU3VjY2VzczogMSxcbiAgaGFuZGxlU3RhcnQ6IDEsXG4gIHBhcnNlSW5wdXREYXRhOiAxLFxuICBwYXJzZU91dHB1dERhdGE6IDEsXG4gIG9uT3V0cHV0UGFyc2VFcnJvcjogMSxcbiAgY2hlY2tUaW1lb3V0U3RhdHVzOiAxLFxuICBnZXRSZXRyeURlbGF5OiAxLFxuICBldmFsdWF0ZUlucHV0U2NoZW1hOiAxLFxuICBnZXRGaW5hbFN0YXRpY0lucHV0U2NoZW1hOiAxXG59O1xudmFyIFpTQVJlc3BvbnNlTWV0YSA9IGNsYXNzIHtcbiAgLyoqXG4gICAqIHRoZSBoZWFkZXJzIG9mIHRoZSByZXNwb25zZVxuICAgKi9cbiAgaGVhZGVycztcbiAgLyoqXG4gICAqIHRoZSBzdGF0dXMgY29kZSBvZiB0aGUgcmVzcG9uc2VcbiAgICpcbiAgICogQGRlZmF1bHQgMjAwXG4gICAqL1xuICBzdGF0dXNDb2RlO1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnN0YXR1c0NvZGUgPSAyMDA7XG4gICAgdGhpcy5oZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcbiAgfVxufTtcbnZhciBTaGFwZUVycm9yTm90U2V0ID0gXCJTaGFwZUVycm9yTm90U2V0XCI7XG5cbi8vIHNyYy96b2Qtc2FmZS1mdW5jdGlvbi50c1xudmFyIHZhbGlkYXRlT3B0cyA9IChvcHRzKSA9PiB7XG4gIGlmIChvcHRzICYmICghKG9wdHMuc291cmNlIGluc3RhbmNlb2YgVE9wdHNTb3VyY2UpIHx8ICFvcHRzLnNvdXJjZS52YWxpZGF0ZSgpKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgb3B0cywgbXVzdCBvcmlnaW5hdGUgZnJvbSB0aGUgc2VydmVyXCIpO1xuICB9XG59O1xudmFyIFpvZFNhZmVGdW5jdGlvbiA9IGNsYXNzIF9ab2RTYWZlRnVuY3Rpb24ge1xuICAvKiogVGhlIGludGVybmFscyBvZiB0aGUgWm9kIFNhZmUgRnVuY3Rpb24gKi9cbiAgJGludGVybmFscztcbiAgY29uc3RydWN0b3IoaW50ZXJuYWxzKSB7XG4gICAgdGhpcy4kaW50ZXJuYWxzID0gaW50ZXJuYWxzO1xuICB9XG4gIC8qKiBDaGVjayBpZiB0aGUgdGltZW91dCBoYXMgdHJpZ2dlcmVkLCBpZiBzbywgdGhyb3cgYSBaU0FFcnJvciAqL1xuICBjaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cykge1xuICAgIGlmICh0aW1lb3V0U3RhdHVzLmlzVGltZW91dCkge1xuICAgICAgdGhyb3cgbmV3IFpTQUVycm9yKFxuICAgICAgICBcIlRJTUVPVVRcIixcbiAgICAgICAgYEV4Y2VlZGVkIHRpbWVvdXQgb2YgJHt0aGlzLiRpbnRlcm5hbHMudGltZW91dH0gbXNgXG4gICAgICApO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICpcbiAgICogR2V0IHRoZSByZXRyeSBkZWxheSBmb3IgdGhlIGN1cnJlbnQgcmV0cnkgYXR0ZW1wdFxuICAgKlxuICAgKiBJZiB0aGVyZSBzaG91bGQgYmUgbm8gcmV0cnksIHJldHVybnMgLTFcbiAgICovXG4gIGdldFJldHJ5RGVsYXkoJGVyciwgY3VycmVudEF0dGVtcHQpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZXJyID0gJGVyciBpbnN0YW5jZW9mIFpTQUVycm9yID8gJGVyciA6IG5ldyBaU0FFcnJvcihcIkVSUk9SXCIsICRlcnIpO1xuICAgICAgaWYgKGVyci5jb2RlID09PSBcIlRJTUVPVVRcIikge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgICB9XG4gICAgICBjb25zdCBjb25maWcgPSB0aGlzLiRpbnRlcm5hbHMucmV0cnlDb25maWc7XG4gICAgICBpZiAoIWNvbmZpZylcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgaWYgKHRoaXMuJGludGVybmFscy5pc1Byb2NlZHVyZSlcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgY29uc3Qgc2hvdWxkUmV0cnkgPSBjdXJyZW50QXR0ZW1wdCA8IGNvbmZpZy5tYXhBdHRlbXB0cztcbiAgICAgIGxldCByZXRyeURlbGF5ID0gMDtcbiAgICAgIGlmICh0eXBlb2YgY29uZmlnLmRlbGF5ID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgcmV0cnlEZWxheSA9IGNvbmZpZy5kZWxheShjdXJyZW50QXR0ZW1wdCwgZXJyKTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbmZpZy5kZWxheSA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICByZXRyeURlbGF5ID0gY29uZmlnLmRlbGF5O1xuICAgICAgfVxuICAgICAgaWYgKHNob3VsZFJldHJ5KVxuICAgICAgICByZXR1cm4gcmV0cnlEZWxheTtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqICBSdW4gdGhyb3VnaCB0aGUgcHJvY2VkdXJlIGNoYWluIGFuZCBnZXQgdGhlIGZpbmFsIGNvbnRleHRcbiAgICovXG4gIGFzeW5jIGdldFByb2NlZHVyZUNoYWluT3V0cHV0KCRhcmdzKSB7XG4gICAgY29uc3Qge1xuICAgICAgYXJncyxcbiAgICAgIHRpbWVvdXRTdGF0dXMsXG4gICAgICByZXF1ZXN0LFxuICAgICAgcmVzcG9uc2VNZXRhLFxuICAgICAgb25JbnB1dFNjaGVtYSxcbiAgICAgIHByZXZpb3VzU3RhdGVcbiAgICB9ID0gJGFyZ3M7XG4gICAgbGV0IGFjY0RhdGEgPSB2b2lkIDA7XG4gICAgbGV0IGlucHV0U2NoZW1hID0gdm9pZCAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy4kaW50ZXJuYWxzLnByb2NlZHVyZUhhbmRsZXJDaGFpbi5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgdGhpcy5jaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cyk7XG4gICAgICBjb25zdCBwcm9jZWR1cmVIYW5kbGVyID0gdGhpcy4kaW50ZXJuYWxzLnByb2NlZHVyZUhhbmRsZXJDaGFpbltpXTtcbiAgICAgIGNvbnN0IFtkYXRhLCBlcnJdID0gYXdhaXQgcHJvY2VkdXJlSGFuZGxlcihhcmdzLCB2b2lkIDAsIHtcbiAgICAgICAgY3R4OiBhY2NEYXRhLFxuICAgICAgICByZXF1ZXN0LFxuICAgICAgICByZXNwb25zZU1ldGEsXG4gICAgICAgIHByZXZpb3VzU3RhdGUsXG4gICAgICAgIHNvdXJjZTogbmV3IFRPcHRzU291cmNlKCgpID0+IHRydWUpLFxuICAgICAgICBwcmV2aW91c0lucHV0U2NoZW1hOiBpbnB1dFNjaGVtYSxcbiAgICAgICAgb25JbnB1dFNjaGVtYTogKHNjaGVtYSkgPT4ge1xuICAgICAgICAgIGlucHV0U2NoZW1hID0gc2NoZW1hO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgICAgYWNjRGF0YSA9IGRhdGE7XG4gICAgfVxuICAgIG9uSW5wdXRTY2hlbWE/LihpbnB1dFNjaGVtYSk7XG4gICAgcmV0dXJuIGFjY0RhdGE7XG4gIH1cbiAgLyoqXG4gICAqICBSdW4gdGhyb3VnaCB0aGUgcHJvY2VkdXJlIGNoYWluIGFuZCBnZXQgdGhlIGZpbmFsIHN0YXRpYyBpbnB1dCBzY2hlbWFcbiAgICovXG4gIGFzeW5jIGdldEZpbmFsU3RhdGljSW5wdXRTY2hlbWEoYXJncykge1xuICAgIGxldCBpbnB1dFNjaGVtYSA9IHZvaWQgMDtcbiAgICBpZiAodGhpcy4kaW50ZXJuYWxzLmlzUHJvY2VkdXJlICYmIGFyZ3Mub3B0cykge1xuICAgICAgYXdhaXQgdGhpcy5ldmFsdWF0ZUlucHV0U2NoZW1hKHtcbiAgICAgICAgY3R4OiB2b2lkIDAsXG4gICAgICAgIG9wdHM6IGFyZ3Mub3B0cyxcbiAgICAgICAgbm9GdW5jdGlvbnNBbGxvd2VkOiB0cnVlXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZm9yIChjb25zdCBwcm9jZWR1cmVIYW5kbGVyIG9mIHRoaXMuJGludGVybmFscy5wcm9jZWR1cmVIYW5kbGVyQ2hhaW4pIHtcbiAgICAgIGF3YWl0IHByb2NlZHVyZUhhbmRsZXIodm9pZCAwLCB2b2lkIDAsIHtcbiAgICAgICAgc291cmNlOiBuZXcgVE9wdHNTb3VyY2UoKCkgPT4gdHJ1ZSksXG4gICAgICAgIHByZXZpb3VzSW5wdXRTY2hlbWE6IGlucHV0U2NoZW1hLFxuICAgICAgICByZXR1cm5JbnB1dFNjaGVtYTogdHJ1ZSxcbiAgICAgICAgb25JbnB1dFNjaGVtYTogKHNjaGVtYSkgPT4ge1xuICAgICAgICAgIGlucHV0U2NoZW1hID0gc2NoZW1hO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKCFhcmdzLm9wdHMpIHtcbiAgICAgIGFyZ3Mub3B0cyA9IHtcbiAgICAgICAgc291cmNlOiBuZXcgVE9wdHNTb3VyY2UoKCkgPT4gdHJ1ZSlcbiAgICAgIH07XG4gICAgfVxuICAgIGFyZ3Mub3B0cy5wcmV2aW91c0lucHV0U2NoZW1hID0gaW5wdXRTY2hlbWE7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZXZhbHVhdGVJbnB1dFNjaGVtYSh7XG4gICAgICBjdHg6IHZvaWQgMCxcbiAgICAgIG9wdHM6IGFyZ3Mub3B0cyxcbiAgICAgIG5vRnVuY3Rpb25zQWxsb3dlZDogdHJ1ZVxuICAgIH0pIHx8IHoyLnVuZGVmaW5lZCgpO1xuICB9XG4gIC8qKiBzZXQgYSB0aW1lb3V0IG9uIHRoZSBzZXJ2ZXIgYWN0aW9uICovXG4gIHRpbWVvdXQobWlsbGlzZWNvbmRzKSB7XG4gICAgcmV0dXJuIG5ldyBfWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICAgIC4uLnRoaXMuJGludGVybmFscyxcbiAgICAgIHRpbWVvdXQ6IG1pbGxpc2Vjb25kc1xuICAgIH0pO1xuICB9XG4gIC8qKiBzZXQgYSByZXRyeSBtZWNoYW5pc20gb24gdGhlIHNlcnZlciBhY3Rpb24gKi9cbiAgcmV0cnkoY29uZmlnKSB7XG4gICAgcmV0dXJuIG5ldyBfWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICAgIC4uLnRoaXMuJGludGVybmFscyxcbiAgICAgIHJldHJ5Q29uZmlnOiBjb25maWdcbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICogc2V0IHRoZSBpbnB1dCBzY2hlbWEgZm9yIHRoZSBzZXJ2ZXIgYWN0aW9uXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYHRzXG4gICAqIC5pbnB1dCh6Lm9iamVjdCh7XG4gICAqICAgbWVzc2FnZTogei5zdHJpbmcoKVxuICAgKiB9KSlcbiAgICogYGBgXG4gICAqL1xuICBpbnB1dChzY2hlbWEsIG9wdHMpIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAgICAgaW5wdXRTY2hlbWE6IHNjaGVtYSxcbiAgICAgIGlucHV0VHlwZTogb3B0cz8udHlwZSxcbiAgICAgIHNraXBJbnB1dFBhcnNpbmc6IG9wdHM/LnNraXBJbnB1dFBhcnNpbmdcbiAgICB9KTtcbiAgfVxuICAvKiogc2V0IHRoZSBvdXRwdXQgc2NoZW1hIGZvciB0aGUgc2VydmVyIGFjdGlvbiAqL1xuICBvdXRwdXQoc2NoZW1hKSB7XG4gICAgcmV0dXJuIG5ldyBfWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICAgIC4uLnRoaXMuJGludGVybmFscyxcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgICAgIG91dHB1dFNjaGVtYTogc2NoZW1hXG4gICAgfSk7XG4gIH1cbiAgLyoqIHNldCBhIGhhbmRsZXIgZnVuY3Rpb24gZm9yIGlucHV0IHBhcnNlIGVycm9ycyAqL1xuICBvbklucHV0UGFyc2VFcnJvcihmbikge1xuICAgIHJldHVybiBuZXcgX1pvZFNhZmVGdW5jdGlvbih7XG4gICAgICAuLi50aGlzLiRpbnRlcm5hbHMsXG4gICAgICBvbklucHV0UGFyc2VFcnJvcjogZm5cbiAgICB9KTtcbiAgfVxuICAvKiogc2V0IGEgaGFuZGxlciBmdW5jdGlvbiBmb3Igb3V0cHV0IHBhcnNlIGVycm9ycyAqL1xuICBvbk91dHB1dFBhcnNlRXJyb3IoZm4pIHtcbiAgICByZXR1cm4gbmV3IF9ab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgLi4udGhpcy4kaW50ZXJuYWxzLFxuICAgICAgb25PdXRwdXRQYXJzZUVycm9yOiBmblxuICAgIH0pO1xuICB9XG4gIC8qKiBzZXQgYSBoYW5kbGVyIGZ1bmN0aW9uIGZvciBlcnJvcnMgKi9cbiAgb25FcnJvcihmbikge1xuICAgIHJldHVybiBuZXcgX1pvZFNhZmVGdW5jdGlvbih7XG4gICAgICAuLi50aGlzLiRpbnRlcm5hbHMsXG4gICAgICBvbkVycm9yRm5zOiBbLi4udGhpcy4kaW50ZXJuYWxzLm9uRXJyb3JGbnMgfHwgW10sIGZuXVxuICAgIH0pO1xuICB9XG4gIC8qKiBzZXQgYSBoYW5kbGVyIGZ1bmN0aW9uIGZvciB3aGVuIHRoZSBzZXJ2ZXIgYWN0aW9uIHN0YXJ0cyAqL1xuICBvblN0YXJ0KGZuKSB7XG4gICAgcmV0dXJuIG5ldyBfWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICAgIC4uLnRoaXMuJGludGVybmFscyxcbiAgICAgIG9uU3RhcnRGbnM6IFsuLi50aGlzLiRpbnRlcm5hbHMub25TdGFydEZucyB8fCBbXSwgZm5dXG4gICAgfSk7XG4gIH1cbiAgLyoqIHNldCBhIGhhbmRsZXIgZnVuY3Rpb24gZm9yIHdoZW4gdGhlIHNlcnZlciBhY3Rpb24gc3VjY2VlZHMgKi9cbiAgb25TdWNjZXNzKGZuKSB7XG4gICAgcmV0dXJuIG5ldyBfWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICAgIC4uLnRoaXMuJGludGVybmFscyxcbiAgICAgIG9uU3VjY2Vzc0ZuczogWy4uLnRoaXMuJGludGVybmFscy5vblN1Y2Nlc3NGbnMgfHwgW10sIGZuXVxuICAgIH0pO1xuICB9XG4gIC8qKiBzZXQgYSBoYW5kbGVyIGZ1bmN0aW9uIGZvciB3aGVuIHRoZSBzZXJ2ZXIgYWN0aW9uIGNvbXBsZXRlcyAoc3VjY2VzcyBvciBlcnJvcikgKi9cbiAgb25Db21wbGV0ZShmbikge1xuICAgIHJldHVybiBuZXcgX1pvZFNhZmVGdW5jdGlvbih7XG4gICAgICAuLi50aGlzLiRpbnRlcm5hbHMsXG4gICAgICBvbkNvbXBsZXRlRm5zOiBbLi4udGhpcy4kaW50ZXJuYWxzLm9uQ29tcGxldGVGbnMgfHwgW10sIGZuXVxuICAgIH0pO1xuICB9XG4gIC8qKiBhIGhlbHBlciBmdW5jdGlvbiB0byBwYXJzZSBvdXRwdXQgZGF0YSBnaXZlbiB0aGUgYWN0aXZlIG91dHB1dCBzY2hlbWEgKi9cbiAgYXN5bmMgcGFyc2VPdXRwdXREYXRhKGRhdGEsIGN0eCwgdGltZW91dFN0YXR1cywgb3B0cykge1xuICAgIHRoaXMuY2hlY2tUaW1lb3V0U3RhdHVzKHRpbWVvdXRTdGF0dXMpO1xuICAgIGlmICghdGhpcy4kaW50ZXJuYWxzLm91dHB1dFNjaGVtYSlcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIGNvbnN0IHNjaGVtYSA9IHR5cGVvZiB0aGlzLiRpbnRlcm5hbHMub3V0cHV0U2NoZW1hID09PSBcImZ1bmN0aW9uXCIgPyBhd2FpdCB0aGlzLiRpbnRlcm5hbHMub3V0cHV0U2NoZW1hKHtcbiAgICAgIGN0eCxcbiAgICAgIHVucGFyc2VkRGF0YTogZGF0YSxcbiAgICAgIHJlcXVlc3Q6IG9wdHM/LnJlcXVlc3QsXG4gICAgICByZXNwb25zZU1ldGE6IG9wdHM/LnJlc3BvbnNlTWV0YSxcbiAgICAgIHByZXZpb3VzU3RhdGU6IG9wdHM/LnByZXZpb3VzU3RhdGVcbiAgICB9KSA6IHRoaXMuJGludGVybmFscy5vdXRwdXRTY2hlbWE7XG4gICAgaWYgKCEoc2NoZW1hIGluc3RhbmNlb2YgejIuWm9kVHlwZSkpIHtcbiAgICAgIHRocm93IG5ldyBaU0FFcnJvcihcIkVSUk9SXCIsIFwiT3V0cHV0IHNjaGVtYSBtdXN0IGJlIGEgWm9kVHlwZVwiKTtcbiAgICB9XG4gICAgY29uc3Qgc2FmZSA9IGF3YWl0IHNjaGVtYS5zYWZlUGFyc2VBc3luYyhkYXRhKTtcbiAgICBpZiAoIXNhZmUuc3VjY2Vzcykge1xuICAgICAgaWYgKHRoaXMuJGludGVybmFscy5vbk91dHB1dFBhcnNlRXJyb3IpIHtcbiAgICAgICAgYXdhaXQgdGhpcy4kaW50ZXJuYWxzLm9uT3V0cHV0UGFyc2VFcnJvcihzYWZlLmVycm9yKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZsYXR0ZW5lZEVycm9ycyA9IHNhZmUuZXJyb3IuZmxhdHRlbigpO1xuICAgICAgY29uc3QgZm9ybWF0dGVkRXJyb3JzID0gc2FmZS5lcnJvci5mb3JtYXQoKTtcbiAgICAgIHRocm93IG5ldyBaU0FFcnJvcihcIk9VVFBVVF9QQVJTRV9FUlJPUlwiLCBzYWZlLmVycm9yLCB7XG4gICAgICAgIG91dHB1dFBhcnNlRXJyb3JzOiB7XG4gICAgICAgICAgZmllbGRFcnJvcnM6IGZsYXR0ZW5lZEVycm9ycz8uZmllbGRFcnJvcnMsXG4gICAgICAgICAgZm9ybUVycm9yczogZmxhdHRlbmVkRXJyb3JzPy5mb3JtRXJyb3JzLFxuICAgICAgICAgIGZvcm1hdHRlZEVycm9yc1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHNhZmUuZGF0YTtcbiAgfVxuICAvKiogaGVscGVyIGZ1bmN0aW9uIHRvIGhhbmRsZSBzdGFydCB3aXRoIHRpbWVvdXQgY2hlY2twb2ludHMgKi9cbiAgYXN5bmMgaGFuZGxlU3RhcnQoYXJncywgdGltZW91dFN0YXR1cykge1xuICAgIHRoaXMuY2hlY2tUaW1lb3V0U3RhdHVzKHRpbWVvdXRTdGF0dXMpO1xuICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuaXNQcm9jZWR1cmUpXG4gICAgICByZXR1cm47XG4gICAgZm9yIChjb25zdCBmbiBvZiB0aGlzLiRpbnRlcm5hbHMub25TdGFydEZucyB8fCBbXSkge1xuICAgICAgYXdhaXQgZm4oeyBhcmdzIH0pO1xuICAgICAgdGhpcy5jaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cyk7XG4gICAgfVxuICB9XG4gIC8qKiBoZWxwZXIgZnVuY3Rpb24gdG8gaGFuZGxlIHN1Y2Nlc3Mgd2l0aCB0aW1lb3V0IGNoZWNrcG9pbnRzICovXG4gIGFzeW5jIGhhbmRsZVN1Y2Nlc3MoYXJncywgZGF0YSwgdGltZW91dFN0YXR1cykge1xuICAgIHRoaXMuY2hlY2tUaW1lb3V0U3RhdHVzKHRpbWVvdXRTdGF0dXMpO1xuICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuaXNQcm9jZWR1cmUpXG4gICAgICByZXR1cm47XG4gICAgZm9yIChjb25zdCBmbiBvZiB0aGlzLiRpbnRlcm5hbHMub25TdWNjZXNzRm5zIHx8IFtdKSB7XG4gICAgICBhd2FpdCBmbih7IGFyZ3MsIGRhdGEgfSk7XG4gICAgICB0aGlzLmNoZWNrVGltZW91dFN0YXR1cyh0aW1lb3V0U3RhdHVzKTtcbiAgICB9XG4gICAgdGhpcy5jaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cyk7XG4gICAgZm9yIChjb25zdCBmbiBvZiB0aGlzLiRpbnRlcm5hbHMub25Db21wbGV0ZUZucyB8fCBbXSkge1xuICAgICAgYXdhaXQgZm4oe1xuICAgICAgICBpc1N1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGlzRXJyb3I6IGZhbHNlLFxuICAgICAgICBzdGF0dXM6IFwic3VjY2Vzc1wiLFxuICAgICAgICBhcmdzLFxuICAgICAgICBkYXRhXG4gICAgICB9KTtcbiAgICAgIHRoaXMuY2hlY2tUaW1lb3V0U3RhdHVzKHRpbWVvdXRTdGF0dXMpO1xuICAgIH1cbiAgfVxuICAvKiogaGVscGVyIGZ1bmN0aW9uIHRvIGhhbmRsZSBlcnJvcnMgd2l0aCB0aW1lb3V0IGNoZWNrcG9pbnRzICovXG4gIGFzeW5jIGhhbmRsZUVycm9yKGVyciwgaW5wdXRSYXcsIGlucHV0UGFyc2VkKSB7XG4gICAgaWYgKGVyci5tZXNzYWdlID09PSBcIk5FWFRfUkVESVJFQ1RcIiB8fCBlcnIubWVzc2FnZSA9PT0gXCJORVhUX05PVF9GT1VORFwiKSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuaXNQcm9jZWR1cmUpXG4gICAgICByZXR1cm4gW251bGwsIGVycl07XG4gICAgbGV0IGN1c3RvbUVycm9yO1xuICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuc2hhcGVFcnJvckZucyAhPT0gdm9pZCAwKSB7XG4gICAgICBsZXQgYWNjRGF0YSA9IHZvaWQgMDtcbiAgICAgIGZvciAoY29uc3QgZm4gb2YgdGhpcy4kaW50ZXJuYWxzLnNoYXBlRXJyb3JGbnMpIHtcbiAgICAgICAgYWNjRGF0YSA9IGF3YWl0IGZuKHtcbiAgICAgICAgICBlcnIsXG4gICAgICAgICAgdHlwZWREYXRhOiB7XG4gICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICAgICAgICBpbnB1dFBhcnNlRXJyb3JzOiBlcnIgaW5zdGFuY2VvZiBaU0FFcnJvciA/IGVyci5pbnB1dFBhcnNlRXJyb3JzIDogdm9pZCAwLFxuICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAgICAgICAgICAgb3V0cHV0UGFyc2VFcnJvcnM6IGVyciBpbnN0YW5jZW9mIFpTQUVycm9yID8gZXJyLm91dHB1dFBhcnNlRXJyb3JzIDogdm9pZCAwLFxuICAgICAgICAgICAgaW5wdXRQYXJzZWQsXG4gICAgICAgICAgICBpbnB1dFJhd1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY3R4OiBhY2NEYXRhXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY3VzdG9tRXJyb3IgPSBhY2NEYXRhO1xuICAgIH0gZWxzZSB7XG4gICAgICBjdXN0b21FcnJvciA9IGVyciBpbnN0YW5jZW9mIFpTQUVycm9yID8gZXJyIDogbmV3IFpTQUVycm9yKFwiRVJST1JcIiwgZXJyKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBmbiBvZiB0aGlzLiRpbnRlcm5hbHMub25FcnJvckZucyB8fCBbXSkge1xuICAgICAgYXdhaXQgZm4oY3VzdG9tRXJyb3IpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGZuIG9mIHRoaXMuJGludGVybmFscy5vbkNvbXBsZXRlRm5zIHx8IFtdKSB7XG4gICAgICBhd2FpdCBmbih7XG4gICAgICAgIGlzU3VjY2VzczogZmFsc2UsXG4gICAgICAgIGlzRXJyb3I6IHRydWUsXG4gICAgICAgIHN0YXR1czogXCJlcnJvclwiLFxuICAgICAgICBlcnJvcjogY3VzdG9tRXJyb3JcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAodGhpcy4kaW50ZXJuYWxzLnNoYXBlRXJyb3JGbnMgIT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIFtudWxsLCBjdXN0b21FcnJvcl07XG4gICAgfVxuICAgIGNvbnN0IHN0cmluZ2lmeUlmTmVlZGVkID0gKGRhdGEyKSA9PiB0eXBlb2YgZGF0YTIgPT09IFwic3RyaW5nXCIgPyBkYXRhMiA6IEpTT04uc3RyaW5naWZ5KGRhdGEyKTtcbiAgICBsZXQgZm9ybWF0dGVkRXJyb3JzO1xuICAgIGxldCBmbGF0dGVuZWRFcnJvcnM7XG4gICAgY29uc3QgZGF0YSA9IGVyci5kYXRhO1xuICAgIGlmIChkYXRhIGluc3RhbmNlb2YgejIuWm9kRXJyb3IgJiYgY3VzdG9tRXJyb3IuY29kZSA9PT0gXCJJTlBVVF9QQVJTRV9FUlJPUlwiKSB7XG4gICAgICBmb3JtYXR0ZWRFcnJvcnMgPSBkYXRhLmZvcm1hdCgpO1xuICAgICAgZmxhdHRlbmVkRXJyb3JzID0gZGF0YS5mbGF0dGVuKCk7XG4gICAgfVxuICAgIHJldHVybiBbXG4gICAgICBudWxsLFxuICAgICAge1xuICAgICAgICBkYXRhOiBzdHJpbmdpZnlJZk5lZWRlZChjdXN0b21FcnJvci5kYXRhKSxcbiAgICAgICAgbmFtZTogY3VzdG9tRXJyb3IubmFtZSxcbiAgICAgICAgbWVzc2FnZTogc3RyaW5naWZ5SWZOZWVkZWQoY3VzdG9tRXJyb3IubWVzc2FnZSksXG4gICAgICAgIGNvZGU6IGN1c3RvbUVycm9yLmNvZGUsXG4gICAgICAgIGZpZWxkRXJyb3JzOiBmbGF0dGVuZWRFcnJvcnM/LmZpZWxkRXJyb3JzLFxuICAgICAgICBmb3JtRXJyb3JzOiBmbGF0dGVuZWRFcnJvcnM/LmZvcm1FcnJvcnMsXG4gICAgICAgIGZvcm1hdHRlZEVycm9yc1xuICAgICAgfVxuICAgIF07XG4gIH1cbiAgYXN5bmMgZXZhbHVhdGVJbnB1dFNjaGVtYShhcmdzKSB7XG4gICAgY29uc3QgeyBjdHgsIG9wdHMsIG5vRnVuY3Rpb25zQWxsb3dlZCB9ID0gYXJncztcbiAgICBsZXQgaW5wdXRTY2hlbWEgPSB0aGlzLiRpbnRlcm5hbHMuaW5wdXRTY2hlbWE7XG4gICAgaWYgKG5vRnVuY3Rpb25zQWxsb3dlZCAmJiB0eXBlb2YgaW5wdXRTY2hlbWEgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5wdXQgZnVuY3Rpb25zIGFyZSBub3Qgc3VwcHBvcnRlZCB5ZXRcIik7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgaW5wdXRTY2hlbWEgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgaW5wdXRTY2hlbWEgPSBhd2FpdCBpbnB1dFNjaGVtYSh7XG4gICAgICAgIGN0eCxcbiAgICAgICAgcHJldmlvdXNTY2hlbWE6IG9wdHM/LnByZXZpb3VzSW5wdXRTY2hlbWEgfHwgejIudW5kZWZpbmVkKCksXG4gICAgICAgIHJlcXVlc3Q6IG9wdHM/LnJlcXVlc3QsXG4gICAgICAgIHJlc3BvbnNlTWV0YTogb3B0cz8ucmVzcG9uc2VNZXRhLFxuICAgICAgICBwcmV2aW91c1N0YXRlOiBvcHRzPy5wcmV2aW91c1N0YXRlXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGlucHV0U2NoZW1hICYmICEoaW5wdXRTY2hlbWEgaW5zdGFuY2VvZiB6Mi5ab2RUeXBlKSkge1xuICAgICAgdGhyb3cgbmV3IFpTQUVycm9yKFwiRVJST1JcIiwgXCJJbnB1dCBzY2hlbWEgbXVzdCBiZSBhIFpvZFR5cGVcIik7XG4gICAgfVxuICAgIGxldCBmaW5hbDtcbiAgICBpZiAoIW9wdHM/LnByZXZpb3VzSW5wdXRTY2hlbWEpIHtcbiAgICAgIGZpbmFsID0gaW5wdXRTY2hlbWE7XG4gICAgfSBlbHNlIGlmICghaW5wdXRTY2hlbWEpIHtcbiAgICAgIGZpbmFsID0gb3B0cy5wcmV2aW91c0lucHV0U2NoZW1hO1xuICAgIH0gZWxzZSBpZiAoaW5zdGFuY2VvZlpvZFR5cGVPYmplY3Qob3B0cy5wcmV2aW91c0lucHV0U2NoZW1hKSAmJiBpbnN0YW5jZW9mWm9kVHlwZU9iamVjdChpbnB1dFNjaGVtYSkpIHtcbiAgICAgIGZpbmFsID0gb3B0cy5wcmV2aW91c0lucHV0U2NoZW1hLm1lcmdlKGlucHV0U2NoZW1hKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmluYWwgPSBpbnB1dFNjaGVtYTtcbiAgICB9XG4gICAgb3B0cz8ub25JbnB1dFNjaGVtYT8uKGZpbmFsKTtcbiAgICByZXR1cm4gZmluYWwgfHwgejIudW5kZWZpbmVkKCk7XG4gIH1cbiAgLyoqIGhlbHBlciBmdW5jdGlvbiB0byBwYXJzZSBpbnB1dCBkYXRhIGdpdmVuIHRoZSBhY3RpdmUgaW5wdXQgc2NoZW1hICovXG4gIGFzeW5jIHBhcnNlSW5wdXREYXRhKCRkYXRhLCBvdmVycmlkZURhdGEsIHRpbWVvdXRTdGF0dXMsIGN0eCwgb3B0cykge1xuICAgIHRoaXMuY2hlY2tUaW1lb3V0U3RhdHVzKHRpbWVvdXRTdGF0dXMpO1xuICAgIGNvbnN0IGlucHV0U2NoZW1hID0gYXdhaXQgdGhpcy5ldmFsdWF0ZUlucHV0U2NoZW1hKHtcbiAgICAgIGN0eCxcbiAgICAgIG9wdHNcbiAgICB9KTtcbiAgICBpZiAodGhpcy4kaW50ZXJuYWxzLnNraXBJbnB1dFBhcnNpbmcpIHtcbiAgICAgIHJldHVybiAkZGF0YTtcbiAgICB9XG4gICAgbGV0IGRhdGEgPSAkZGF0YTtcbiAgICBpZiAoJGRhdGEgaW5zdGFuY2VvZiBGb3JtRGF0YSAmJiB0aGlzLiRpbnRlcm5hbHMuaW5wdXRUeXBlICE9PSBcImpzb25cIikge1xuICAgICAgZGF0YSA9IHtcbiAgICAgICAgLi4uZm9ybURhdGFUb0pzb24oZGF0YSwgaW5wdXRTY2hlbWEpLFxuICAgICAgICAuLi50aGlzLiRpbnRlcm5hbHMuaW5wdXRUeXBlICE9PSBcInN0YXRlXCIgPyBvdmVycmlkZURhdGEgfHwge30gOiB7fVxuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgY2FuQ2hhbmdlVG9VbmRlZmluZWQgPSAoJGRhdGEgaW5zdGFuY2VvZiBGb3JtRGF0YSB8fCBvcHRzPy5pc0Zyb21PcGVuQXBpSGFuZGxlcikgJiYgY2FuRGF0YUJlVW5kZWZpbmVkRm9yU2NoZW1hKGlucHV0U2NoZW1hKTtcbiAgICBpZiAoY2FuQ2hhbmdlVG9VbmRlZmluZWQgJiYgZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gXCJvYmplY3RcIiAmJiBPYmplY3Qua2V5cyhkYXRhKS5sZW5ndGggPT09IDApIHtcbiAgICAgIGRhdGEgPSB2b2lkIDA7XG4gICAgfVxuICAgIG9wdHM/Lm9uQXJncz8uKGRhdGEpO1xuICAgIGF3YWl0IHRoaXMuaGFuZGxlU3RhcnQoZGF0YSwgdGltZW91dFN0YXR1cyk7XG4gICAgaWYgKCF0aGlzLiRpbnRlcm5hbHMuaW5wdXRTY2hlbWEgJiYgZGF0YSAhPT0gdm9pZCAwICYmIHRoaXMuJGludGVybmFscy5pc1Byb2NlZHVyZSkge1xuICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9XG4gICAgY29uc3Qgc2FmZSA9IGF3YWl0IGlucHV0U2NoZW1hLnNhZmVQYXJzZUFzeW5jKGRhdGEpO1xuICAgIGlmICghc2FmZS5zdWNjZXNzKSB7XG4gICAgICBpZiAodGhpcy4kaW50ZXJuYWxzLm9uSW5wdXRQYXJzZUVycm9yKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuJGludGVybmFscy5vbklucHV0UGFyc2VFcnJvcihzYWZlLmVycm9yKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZsYXR0ZW5lZEVycm9ycyA9IHNhZmUuZXJyb3IuZmxhdHRlbigpO1xuICAgICAgY29uc3QgZm9ybWF0dGVkRXJyb3JzID0gc2FmZS5lcnJvci5mb3JtYXQoKTtcbiAgICAgIHRocm93IG5ldyBaU0FFcnJvcihcIklOUFVUX1BBUlNFX0VSUk9SXCIsIHNhZmUuZXJyb3IsIHtcbiAgICAgICAgaW5wdXRQYXJzZUVycm9yczoge1xuICAgICAgICAgIGZpZWxkRXJyb3JzOiBmbGF0dGVuZWRFcnJvcnM/LmZpZWxkRXJyb3JzLFxuICAgICAgICAgIGZvcm1FcnJvcnM6IGZsYXR0ZW5lZEVycm9ycz8uZm9ybUVycm9ycyxcbiAgICAgICAgICBmb3JtYXR0ZWRFcnJvcnNcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBzYWZlLmRhdGE7XG4gIH1cbiAgLyoqIHNldCBhIGhhbmRsZXIgZnVuY3Rpb24gZm9yIHdoZW4gdGhlIHNlcnZlciBhY3Rpb24gc3RhcnRzICovXG4gIGV4cGVyaW1lbnRhbF9zaGFwZUVycm9yKGZuKSB7XG4gICAgcmV0dXJuIG5ldyBfWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICAgIC4uLnRoaXMuJGludGVybmFscyxcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgICAgIHNoYXBlRXJyb3JGbnM6IFsuLi50aGlzLiRpbnRlcm5hbHMuc2hhcGVFcnJvckZucyB8fCBbXSwgZm5dXG4gICAgfSk7XG4gIH1cbiAgZ2V0VGltZW91dEVycm9yUHJvbWlzZSA9ICh0aW1lb3V0TXMpID0+IG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHJlamVjdChuZXcgWlNBRXJyb3IoXCJUSU1FT1VUXCIsIGBFeGNlZWRlZCB0aW1lb3V0IG9mICR7dGltZW91dE1zfSBtc2ApKTtcbiAgICB9LCB0aW1lb3V0TXMpO1xuICB9KTtcbiAgLyoqIHNldCB0aGUgaGFuZGxlciBmdW5jdGlvbiBmb3IgdGhlIHNlcnZlciBhY3Rpb24gKi9cbiAgaGFuZGxlcihmbikge1xuICAgIGNvbnN0IHRpbWVvdXRTdGF0dXMgPSB7XG4gICAgICBpc1RpbWVvdXQ6IGZhbHNlXG4gICAgfTtcbiAgICBjb25zdCB3cmFwcGVyID0gYXN5bmMgKCRhcmdzLCBvdmVycmlkZUFyZ3MsIG9wdHMpID0+IHtcbiAgICAgIHZhbGlkYXRlT3B0cyhvcHRzKTtcbiAgICAgIGlmIChvcHRzPy5yZXR1cm5JbnB1dFNjaGVtYSkge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRGaW5hbFN0YXRpY0lucHV0U2NoZW1hKHtcbiAgICAgICAgICBvcHRzXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmIChvcHRzPy5yZXR1cm5PdXRwdXRTY2hlbWEpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLiRpbnRlcm5hbHMub3V0cHV0U2NoZW1hID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBcIkNhbm5vdCByZXR1cm4gb3V0cHV0IHNjaGVtYSBmcm9tIGEgZnVuY3Rpb24gb3V0cHV0IHNjaGVtYVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy4kaW50ZXJuYWxzLm91dHB1dFNjaGVtYTtcbiAgICAgIH1cbiAgICAgIGxldCBhcmdzO1xuICAgICAgbGV0IHBhcnNlZEFyZ3M7XG4gICAgICBpZiAodGhpcy4kaW50ZXJuYWxzLmlucHV0VHlwZSA9PT0gXCJzdGF0ZVwiKSB7XG4gICAgICAgIGFyZ3MgPSBvdmVycmlkZUFyZ3M7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcmdzID0gJGFyZ3M7XG4gICAgICB9XG4gICAgICBsZXQgcHJldmlvdXNTdGF0ZSA9IG9wdHM/LnByZXZpb3VzU3RhdGUgfHwgdm9pZCAwO1xuICAgICAgaWYgKHRoaXMuJGludGVybmFscy5pbnB1dFR5cGUgPT09IFwic3RhdGVcIiAmJiAhdGhpcy4kaW50ZXJuYWxzLmlzUHJvY2VkdXJlKSB7XG4gICAgICAgIHByZXZpb3VzU3RhdGUgPSAkYXJncztcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCBjdHg7XG4gICAgICAgIGlmICh0aGlzLiRpbnRlcm5hbHMuaXNQcm9jZWR1cmUgJiYgb3B0cykge1xuICAgICAgICAgIGN0eCA9IG9wdHMuY3R4O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGN0eCA9IGF3YWl0IHRoaXMuZ2V0UHJvY2VkdXJlQ2hhaW5PdXRwdXQoe1xuICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAgICAgICAgICAgYXJncyxcbiAgICAgICAgICAgIHRpbWVvdXRTdGF0dXMsXG4gICAgICAgICAgICByZXF1ZXN0OiBvcHRzPy5yZXF1ZXN0LFxuICAgICAgICAgICAgcmVzcG9uc2VNZXRhOiBvcHRzPy5yZXNwb25zZU1ldGEsXG4gICAgICAgICAgICBvbklucHV0U2NoZW1hOiAoc2NoZW1hKSA9PiB7XG4gICAgICAgICAgICAgIGlmICghb3B0cykge1xuICAgICAgICAgICAgICAgIG9wdHMgPSB7XG4gICAgICAgICAgICAgICAgICBzb3VyY2U6IG5ldyBUT3B0c1NvdXJjZSgoKSA9PiB0cnVlKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgb3B0cy5wcmV2aW91c0lucHV0U2NoZW1hID0gc2NoZW1hO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHByZXZpb3VzU3RhdGVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbnB1dCA9IGF3YWl0IHRoaXMucGFyc2VJbnB1dERhdGEoXG4gICAgICAgICAgYXJncyxcbiAgICAgICAgICBvdmVycmlkZUFyZ3MsXG4gICAgICAgICAgdGltZW91dFN0YXR1cyxcbiAgICAgICAgICBjdHgsXG4gICAgICAgICAgb3B0c1xuICAgICAgICApO1xuICAgICAgICBvcHRzPy5vblBhcnNlZEFyZ3M/LihpbnB1dCk7XG4gICAgICAgIHBhcnNlZEFyZ3MgPSBpbnB1dDtcbiAgICAgICAgdGhpcy5jaGVja1RpbWVvdXRTdGF0dXModGltZW91dFN0YXR1cyk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBmbih7XG4gICAgICAgICAgaW5wdXQsXG4gICAgICAgICAgY3R4LFxuICAgICAgICAgIHJlcXVlc3Q6IG9wdHM/LnJlcXVlc3QsXG4gICAgICAgICAgcmVzcG9uc2VNZXRhOiBvcHRzPy5yZXNwb25zZU1ldGEsXG4gICAgICAgICAgcHJldmlvdXNTdGF0ZVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcGFyc2VkID0gYXdhaXQgdGhpcy5wYXJzZU91dHB1dERhdGEoXG4gICAgICAgICAgZGF0YSxcbiAgICAgICAgICBjdHgsXG4gICAgICAgICAgdGltZW91dFN0YXR1cyxcbiAgICAgICAgICBvcHRzXG4gICAgICAgICk7XG4gICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlU3VjY2VzcyhpbnB1dCwgcGFyc2VkLCB0aW1lb3V0U3RhdHVzKTtcbiAgICAgICAgcmV0dXJuIFtwYXJzZWQsIG51bGxdO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnN0IHJldHJ5RGVsYXkgPSB0aGlzLmdldFJldHJ5RGVsYXkoZXJyLCBvcHRzPy5hdHRlbXB0cyB8fCAxKTtcbiAgICAgICAgaWYgKHJldHJ5RGVsYXkgPj0gMCkge1xuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyKSA9PiBzZXRUaW1lb3V0KHIsIHJldHJ5RGVsYXkpKTtcbiAgICAgICAgICByZXR1cm4gYXdhaXQgd3JhcHBlcigkYXJncywgb3ZlcnJpZGVBcmdzLCB7XG4gICAgICAgICAgICAuLi5vcHRzIHx8IHt9LFxuICAgICAgICAgICAgYXR0ZW1wdHM6IChvcHRzPy5hdHRlbXB0cyB8fCAxKSArIDEsXG4gICAgICAgICAgICBzb3VyY2U6IG5ldyBUT3B0c1NvdXJjZSgoKSA9PiB0cnVlKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmhhbmRsZUVycm9yKGVyciwgYXJncywgcGFyc2VkQXJncyk7XG4gICAgICB9XG4gICAgfTtcbiAgICBjb25zdCB3aXRoVGltZW91dCA9IGFzeW5jIChhcmdzLCBvdmVycmlkZUFyZ3MsIG9wdHMpID0+IHtcbiAgICAgIGNvbnN0IHRpbWVvdXRNcyA9IHRoaXMuJGludGVybmFscy50aW1lb3V0O1xuICAgICAgaWYgKCF0aW1lb3V0TXMpXG4gICAgICAgIHJldHVybiBhd2FpdCB3cmFwcGVyKGFyZ3MsIG92ZXJyaWRlQXJncywgb3B0cyk7XG4gICAgICB2YWxpZGF0ZU9wdHMob3B0cyk7XG4gICAgICBsZXQgZ290QXJncyA9IHZvaWQgMDtcbiAgICAgIGxldCBnb3RQYXJzZWRBcmdzID0gdm9pZCAwO1xuICAgICAgcmV0dXJuIGF3YWl0IFByb21pc2UucmFjZShbXG4gICAgICAgIHdyYXBwZXIoYXJncywgb3ZlcnJpZGVBcmdzLCB7XG4gICAgICAgICAgLi4ub3B0cyB8fCB7fSxcbiAgICAgICAgICBvbkFyZ3M6IChhcmdzMikgPT4ge1xuICAgICAgICAgICAgZ290QXJncyA9IGFyZ3MyO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25QYXJzZWRBcmdzOiAocGFyc2VkQXJncykgPT4ge1xuICAgICAgICAgICAgZ290UGFyc2VkQXJncyA9IHBhcnNlZEFyZ3M7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzb3VyY2U6IG5ldyBUT3B0c1NvdXJjZSgoKSA9PiB0cnVlKVxuICAgICAgICB9KSxcbiAgICAgICAgdGhpcy5nZXRUaW1lb3V0RXJyb3JQcm9taXNlKHRpbWVvdXRNcylcbiAgICAgIF0pLnRoZW4oKHIpID0+IHIpLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgdGltZW91dFN0YXR1cy5pc1RpbWVvdXQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVFcnJvcihlcnIsIGdvdEFyZ3MsIGdvdFBhcnNlZEFyZ3MpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgICBpZiAodGhpcy4kaW50ZXJuYWxzLmlzUHJvY2VkdXJlKSB7XG4gICAgICBjb25zdCBoYW5kbGVyID0gdGhpcy4kaW50ZXJuYWxzLnRpbWVvdXQgPyB3aXRoVGltZW91dCA6IHdyYXBwZXI7XG4gICAgICByZXR1cm4gbmV3IENvbXBsZXRlUHJvY2VkdXJlKHtcbiAgICAgICAgaW5wdXRTY2hlbWE6IHRoaXMuJGludGVybmFscy5pbnB1dFNjaGVtYSxcbiAgICAgICAgaGFuZGxlckNoYWluOiBbLi4udGhpcy4kaW50ZXJuYWxzLnByb2NlZHVyZUhhbmRsZXJDaGFpbiwgaGFuZGxlcl0sXG4gICAgICAgIHNoYXBlRXJyb3JGbnM6IHRoaXMuJGludGVybmFscy5zaGFwZUVycm9yRm5zLFxuICAgICAgICBsYXN0SGFuZGxlcjogaGFuZGxlcixcbiAgICAgICAgb25Db21wbGV0ZUZuczogdGhpcy4kaW50ZXJuYWxzLm9uQ29tcGxldGVGbnMsXG4gICAgICAgIG9uRXJyb3JGbnM6IHRoaXMuJGludGVybmFscy5vbkVycm9yRm5zLFxuICAgICAgICBvblN0YXJ0Rm5zOiB0aGlzLiRpbnRlcm5hbHMub25TdGFydEZucyxcbiAgICAgICAgb25TdWNjZXNzRm5zOiB0aGlzLiRpbnRlcm5hbHMub25TdWNjZXNzRm5zLFxuICAgICAgICB0aW1lb3V0OiB0aGlzLiRpbnRlcm5hbHMudGltZW91dCxcbiAgICAgICAgcmV0cnlDb25maWc6IHRoaXMuJGludGVybmFscy5yZXRyeUNvbmZpZ1xuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICh0aGlzLiRpbnRlcm5hbHMudGltZW91dCkge1xuICAgICAgcmV0dXJuIHdpdGhUaW1lb3V0O1xuICAgIH1cbiAgICByZXR1cm4gd3JhcHBlcjtcbiAgfVxufTtcbmZ1bmN0aW9uIGNyZWF0ZVpvZFNhZmVGdW5jdGlvbihpc1Byb2NlZHVyZSwgcGFyZW50UHJvY2VkdXJlKSB7XG4gIHJldHVybiBuZXcgWm9kU2FmZUZ1bmN0aW9uKHtcbiAgICBpbnB1dFNjaGVtYTogcGFyZW50UHJvY2VkdXJlPy4kaW50ZXJuYWxzLmlucHV0U2NoZW1hIHx8IHZvaWQgMCxcbiAgICBvdXRwdXRTY2hlbWE6IHZvaWQgMCxcbiAgICBzaGFwZUVycm9yRm5zOiBwYXJlbnRQcm9jZWR1cmU/LiRpbnRlcm5hbHMuc2hhcGVFcnJvckZucyB8fCB2b2lkIDAsXG4gICAgaXNDaGFpbmVkOiBwYXJlbnRQcm9jZWR1cmUgIT09IHZvaWQgMCxcbiAgICBpc1Byb2NlZHVyZTogaXNQcm9jZWR1cmUgPT09IHRydWUsXG4gICAgcHJvY2VkdXJlSGFuZGxlckNoYWluOiBwYXJlbnRQcm9jZWR1cmU/LiRpbnRlcm5hbHMuaGFuZGxlckNoYWluIHx8IFtdLFxuICAgIG9uQ29tcGxldGVGbnM6IHBhcmVudFByb2NlZHVyZT8uJGludGVybmFscy5vbkNvbXBsZXRlRm5zLFxuICAgIG9uRXJyb3JGbnM6IHBhcmVudFByb2NlZHVyZT8uJGludGVybmFscy5vbkVycm9yRm5zLFxuICAgIG9uU3RhcnRGbnM6IHBhcmVudFByb2NlZHVyZT8uJGludGVybmFscy5vblN0YXJ0Rm5zLFxuICAgIG9uU3VjY2Vzc0ZuczogcGFyZW50UHJvY2VkdXJlPy4kaW50ZXJuYWxzLm9uU3VjY2Vzc0Zuc1xuICB9KTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZVNlcnZlckFjdGlvbigpIHtcbiAgcmV0dXJuIG5ldyBab2RTYWZlRnVuY3Rpb24oe1xuICAgIGlucHV0U2NoZW1hOiB2b2lkIDAsXG4gICAgb3V0cHV0U2NoZW1hOiB2b2lkIDAsXG4gICAgc2hhcGVFcnJvckZuczogdm9pZCAwLFxuICAgIHByb2NlZHVyZUhhbmRsZXJDaGFpbjogW11cbiAgfSk7XG59XG5cbi8vIHNyYy9wcm9jZWR1cmUudHNcbnZhciBDb21wbGV0ZVByb2NlZHVyZSA9IGNsYXNzIHtcbiAgJGludGVybmFscztcbiAgY29uc3RydWN0b3IocGFyYW1zKSB7XG4gICAgdGhpcy4kaW50ZXJuYWxzID0gcGFyYW1zO1xuICB9XG4gIC8qKiBtYWtlIGEgc2VydmVyIGFjdGlvbiB3aXRoIHRoZSBjdXJyZW50IHByb2NlZHVyZSAqL1xuICBjcmVhdGVTZXJ2ZXJBY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBab2RTYWZlRnVuY3Rpb24oe1xuICAgICAgaW5wdXRTY2hlbWE6IHRoaXMuJGludGVybmFscy5pbnB1dFNjaGVtYSxcbiAgICAgIG91dHB1dFNjaGVtYTogdm9pZCAwLFxuICAgICAgcHJvY2VkdXJlSGFuZGxlckNoYWluOiB0aGlzLiRpbnRlcm5hbHMuaGFuZGxlckNoYWluLFxuICAgICAgb25FcnJvckZuczogdGhpcy4kaW50ZXJuYWxzLm9uRXJyb3JGbnMsXG4gICAgICBvblN0YXJ0Rm5zOiB0aGlzLiRpbnRlcm5hbHMub25TdGFydEZucyxcbiAgICAgIG9uU3VjY2Vzc0ZuczogdGhpcy4kaW50ZXJuYWxzLm9uU3VjY2Vzc0ZucyxcbiAgICAgIG9uQ29tcGxldGVGbnM6IHRoaXMuJGludGVybmFscy5vbkNvbXBsZXRlRm5zLFxuICAgICAgdGltZW91dDogdGhpcy4kaW50ZXJuYWxzLnRpbWVvdXQsXG4gICAgICByZXRyeUNvbmZpZzogdGhpcy4kaW50ZXJuYWxzLnJldHJ5Q29uZmlnLFxuICAgICAgc2hhcGVFcnJvckZuczogdGhpcy4kaW50ZXJuYWxzLnNoYXBlRXJyb3JGbnNcbiAgICB9KTtcbiAgfVxufTtcbnZhciBjcmVhdGVTZXJ2ZXJBY3Rpb25Qcm9jZWR1cmUgPSAocGFyZW50KSA9PiB7XG4gIHJldHVybiBjcmVhdGVab2RTYWZlRnVuY3Rpb24odHJ1ZSwgcGFyZW50KTtcbn07XG52YXIgY2hhaW5TZXJ2ZXJBY3Rpb25Qcm9jZWR1cmVzID0gKGZpcnN0LCBzZWNvbmQpID0+IHtcbiAgcmV0dXJuIG5ldyBDb21wbGV0ZVByb2NlZHVyZSh7XG4gICAgaW5wdXRTY2hlbWE6IHNlY29uZC4kaW50ZXJuYWxzLmlucHV0U2NoZW1hLFxuICAgIGhhbmRsZXJDaGFpbjogW1xuICAgICAgLi4uZmlyc3QuJGludGVybmFscy5oYW5kbGVyQ2hhaW4sXG4gICAgICBzZWNvbmQuJGludGVybmFscy5sYXN0SGFuZGxlclxuICAgIF0sXG4gICAgbGFzdEhhbmRsZXI6IHNlY29uZC4kaW50ZXJuYWxzLmxhc3RIYW5kbGVyLFxuICAgIHRpbWVvdXQ6IHNlY29uZC4kaW50ZXJuYWxzLnRpbWVvdXQgfHwgZmlyc3QuJGludGVybmFscy50aW1lb3V0LFxuICAgIHJldHJ5Q29uZmlnOiBzZWNvbmQuJGludGVybmFscy5yZXRyeUNvbmZpZyB8fCBmaXJzdC4kaW50ZXJuYWxzLnJldHJ5Q29uZmlnLFxuICAgIHNoYXBlRXJyb3JGbnM6IG1lcmdlQXJyYXlzQW5kUmVtb3ZlRHVwbGljYXRlcyhcbiAgICAgIGZpcnN0LiRpbnRlcm5hbHMuc2hhcGVFcnJvckZucyxcbiAgICAgIHNlY29uZC4kaW50ZXJuYWxzLnNoYXBlRXJyb3JGbnNcbiAgICApLFxuICAgIG9uRXJyb3JGbnM6IG1lcmdlQXJyYXlzQW5kUmVtb3ZlRHVwbGljYXRlcyhcbiAgICAgIGZpcnN0LiRpbnRlcm5hbHMub25FcnJvckZucyxcbiAgICAgIHNlY29uZC4kaW50ZXJuYWxzLm9uRXJyb3JGbnNcbiAgICApLFxuICAgIG9uU3RhcnRGbnM6IG1lcmdlQXJyYXlzQW5kUmVtb3ZlRHVwbGljYXRlcyhcbiAgICAgIGZpcnN0LiRpbnRlcm5hbHMub25TdGFydEZucyxcbiAgICAgIHNlY29uZC4kaW50ZXJuYWxzLm9uU3RhcnRGbnNcbiAgICApLFxuICAgIG9uU3VjY2Vzc0ZuczogbWVyZ2VBcnJheXNBbmRSZW1vdmVEdXBsaWNhdGVzKFxuICAgICAgZmlyc3QuJGludGVybmFscy5vblN1Y2Nlc3NGbnMsXG4gICAgICBzZWNvbmQuJGludGVybmFscy5vblN1Y2Nlc3NGbnNcbiAgICApLFxuICAgIG9uQ29tcGxldGVGbnM6IG1lcmdlQXJyYXlzQW5kUmVtb3ZlRHVwbGljYXRlcyhcbiAgICAgIGZpcnN0LiRpbnRlcm5hbHMub25Db21wbGV0ZUZucyxcbiAgICAgIHNlY29uZC4kaW50ZXJuYWxzLm9uQ29tcGxldGVGbnNcbiAgICApXG4gIH0pO1xufTtcbmV4cG9ydCB7XG4gIENvbXBsZXRlUHJvY2VkdXJlLFxuICBEZWZhdWx0T21pdHRlZCxcbiAgU2hhcGVFcnJvck5vdFNldCxcbiAgVE9wdHNTb3VyY2UsXG4gIFpTQUVycm9yLFxuICBaU0FSZXNwb25zZU1ldGEsXG4gIFpvZFNhZmVGdW5jdGlvbixcbiAgYWRkVG9OdWxsaXNoQXJyYXksXG4gIGNhbkRhdGFCZVVuZGVmaW5lZEZvclNjaGVtYSxcbiAgY2hhaW5TZXJ2ZXJBY3Rpb25Qcm9jZWR1cmVzLFxuICBjcmVhdGVTZXJ2ZXJBY3Rpb24sXG4gIGNyZWF0ZVNlcnZlckFjdGlvblByb2NlZHVyZSxcbiAgY3JlYXRlWm9kU2FmZUZ1bmN0aW9uLFxuICBmb3JtRGF0YVRvSnNvbixcbiAgaW5zdGFuY2VvZlpvZFR5cGVBcnJheSxcbiAgaW5zdGFuY2VvZlpvZFR5cGVCb29sZWFuLFxuICBpbnN0YW5jZW9mWm9kVHlwZUtpbmQsXG4gIGluc3RhbmNlb2Zab2RUeXBlTGlrZVZvaWQsXG4gIGluc3RhbmNlb2Zab2RUeXBlT2JqZWN0LFxuICBpc0tleUFCb29sZWFuSW5ab2RTY2hlbWEsXG4gIGlzS2V5QW5BcnJheUluWm9kU2NoZW1hLFxuICBtZXJnZUFycmF5c0FuZFJlbW92ZUR1cGxpY2F0ZXMsXG4gIHVud3JhcFpvZFR5cGVcbn07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/zsa/dist/index.mjs\n");

/***/ })

};
;